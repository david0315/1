<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修试着用workerman开发一个在线聊天应用' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>试着用workerman开发一个在线聊天应用</center></div><div class='banquan'>原文出处:本文由博客园博主.Ronin提供。<br/>
原文连接:https://www.cnblogs.com/heyue0117/p/11989232.html</div><br>
    <p>聊天功能是很常见的一种功能，Workerman是一款开源高性能异步PHP socket即时通讯框架。</p>
<p>&nbsp;</p>
<p><strong>什么是Workerman？</strong></p>
<p>Workerman是一款&nbsp;<strong>开源</strong>&nbsp;<strong>高性能异步</strong>&nbsp;<strong>PHP socket即时通讯框架</strong>&nbsp;。支持高并发，超高稳定性，被广泛的用于手机app、移动通讯，微信小程序，手游服务端、网络游戏、PHP聊天室、硬件通讯、智能家居、车联网、物联网等领域的开发。支持TCP长连接，支持Websocket、HTTP等协议，支持自定义协议。拥有异步Mysql、异步Redis、异步Http、MQTT物联网客户端、异步消息队列等众多高性能组件。</p>
<p>&nbsp;</p>
<p><strong>以下我们来搭建与配置一下<strong>Workerman</strong></strong></p>
<p>第一步：先把workerman里需要用到的扩展composer下来。</p>
<p><img src="./images/试着用workerman开发一个在线聊天应用0.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;第二步：到官方网站把demo全部下载下来，然后放到我们项目中的目录，我这里用的是laravel框架</p>
<p><img src="./images/试着用workerman开发一个在线聊天应用1.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>图片中我就把整个项目都放在了HTTP/Controller/Workerman中。</p>
<p>&nbsp;</p>
<p>第三步：我们需要把把以下3个文件的引用部分修改为以下。不然会报路径错误</p>
<pre><code><strong><code>start_businessworker，start_gateway，start_register</code></strong><br /><br /></code></pre>
<p><img src="./images/试着用workerman开发一个在线聊天应用2.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;修改完成后我们就可以在liunx直接运行对应的启动文件</p>
<p><img src="./images/试着用workerman开发一个在线聊天应用3.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>如果你是在window下就双击start_for_win.bat运行</p>
<p>&nbsp;运行成功后，你就应该可以看到以下的界面</p>
<p><img src="./images/试着用workerman开发一个在线聊天应用4.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>到此我们搭建基于workerman的通信环境就已经完成。接下来我们就可以根据自己的项目需求进行开发。在此向大家重点说明。我们所有的聊天是逻辑都在目录中的Events.php进行修改。</p>
<p>&nbsp;</p>
<p><strong>下面给大家贴一下我编写的部分代码。如何实现一个聊天功能</strong></p>
<p>Event.php</p>
<pre><code><code><span><span>&lt;?php<br /><span>/**<br />&nbsp;*&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;workerman.<br />&nbsp;*<br />&nbsp;*&nbsp;Licensed&nbsp;under&nbsp;The&nbsp;MIT&nbsp;License<br />&nbsp;*&nbsp;For&nbsp;full&nbsp;copyright&nbsp;and&nbsp;license&nbsp;information,&nbsp;please&nbsp;see&nbsp;the&nbsp;MIT-LICENSE.txt<br />&nbsp;*&nbsp;Redistributions&nbsp;of&nbsp;files&nbsp;must&nbsp;retain&nbsp;the&nbsp;above&nbsp;copyright&nbsp;notice.<br />&nbsp;*<br />&nbsp;*&nbsp;<span>@author&nbsp;walkor&lt;walkor<span>@workerman.net&gt;<br />&nbsp;*&nbsp;<span>@copyright&nbsp;walkor&lt;walkor<span>@workerman.net&gt;<br />&nbsp;*&nbsp;<span>@link&nbsp;http://www.workerman.net/<br />&nbsp;*&nbsp;<span>@license&nbsp;http://www.opensource.org/licenses/mit-license.php&nbsp;MIT&nbsp;License<br />&nbsp;*/<br /><br /><span>/**<br />&nbsp;*&nbsp;用于检测业务代码死循环或者长时间阻塞等问题<br />&nbsp;*&nbsp;如果发现业务卡死，可以将下面declare打开（去掉//注释），并执行php&nbsp;start.php&nbsp;reload<br />&nbsp;*&nbsp;然后观察一段时间workerman.log看是否有process_timeout异常<br />&nbsp;*/<br /><span>//declare(ticks=1);<br /><br /><span>/**<br />&nbsp;*&nbsp;聊天主逻辑<br />&nbsp;*&nbsp;主要是处理&nbsp;onMessage&nbsp;onClose<br />&nbsp;*/<br /><span>use&nbsp;\<span>GatewayWorker\<span>Lib\<span>Gateway;<br /><br /><span><span>class&nbsp;<span>Events<br />{<br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;当客户端连接上来的时候<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;$client_id&nbsp;此ID为gatewayworker&nbsp;自动生成ID<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span>static&nbsp;<span><span>function&nbsp;<span>onConnect<span>($client_id)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;Gateway::sendToClient($client_id,&nbsp;json_encode(<span>array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'type'&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span>'init',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'client_id'&nbsp;=&gt;&nbsp;$client_id<br />&nbsp;&nbsp;&nbsp;&nbsp;)));<br />&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;有消息时<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;int&nbsp;$client_id<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;mixed&nbsp;$message<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span>static&nbsp;<span><span>function&nbsp;<span>onMessage<span>($client_id,&nbsp;$message)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;debug<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"client:{$_SERVER['REMOTE_ADDR']}:{$_SERVER['REMOTE_PORT']}&nbsp;gateway:{$_SERVER['GATEWAY_ADDR']}:{$_SERVER['GATEWAY_PORT']}&nbsp;client_id:$client_id&nbsp;session:".json_encode($_SESSION).<span>"&nbsp;onMessage:".$message.<span>"\n";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;客户端传递的是json数据<br />&nbsp;&nbsp;&nbsp;&nbsp;$message_data&nbsp;=&nbsp;json_decode($message,&nbsp;<span>true);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(!$message_data)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;根据类型执行不同的业务<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>switch($message_data[<span>'type'])<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;客户端回应服务端的心跳<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'pong':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;客户端登录&nbsp;message格式:&nbsp;{type:login,&nbsp;name:xx,&nbsp;room_id:1}&nbsp;，添加到客户端，广播给所有客户端xx进入聊天室<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'login':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;判断是否有房间号<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(!<span>isset($message_data[<span>'room_id']))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>throw&nbsp;<span>new&nbsp;\<span>Exception(<span>"\$message_data['room_id']&nbsp;not&nbsp;set.&nbsp;client_ip:{$_SERVER['REMOTE_ADDR']}&nbsp;\$message:$message");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;把房间号昵称放到session中<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$room_id&nbsp;=&nbsp;$message_data[<span>'room_id'];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$client_name&nbsp;=&nbsp;htmlspecialchars($message_data[<span>'client_name']);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[<span>'room_id']&nbsp;=&nbsp;$room_id;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[<span>'client_name']&nbsp;=&nbsp;$client_name;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;获取房间内所有用户列表<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$clients_list&nbsp;=&nbsp;Gateway::getClientSessionsByGroup($room_id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>foreach($clients_list&nbsp;as&nbsp;$tmp_client_id=&gt;$item)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$clients_list[$tmp_client_id]&nbsp;=&nbsp;$item[<span>'client_name'];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$clients_list[$client_id]&nbsp;=&nbsp;$client_name;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;转播给当前房间的所有客户端，xx进入聊天室&nbsp;message&nbsp;{type:login,&nbsp;client_id:xx,&nbsp;name:xx}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message&nbsp;=&nbsp;<span>array(<span>'type'=&gt;$message_data[<span>'type'],&nbsp;<span>'client_id'=&gt;$client_id,&nbsp;<span>'client_name'=&gt;htmlspecialchars($client_name),&nbsp;<span>'time'=&gt;date(<span>'Y-m-d&nbsp;H:i:s'),<span>'to'=&gt;$message_data[<span>'to'],<span>'room_id'=&gt;$message_data[<span>'room_id'],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'from'=&gt;$message_data[<span>'from'],<span>'tag'=&gt;$message_data[<span>'tag']);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gateway::sendToGroup($room_id,&nbsp;json_encode($new_message));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gateway::joinGroup($client_id,&nbsp;$room_id);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;给当前用户发送用户列表<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message[<span>'client_list']&nbsp;=&nbsp;$clients_list;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gateway::sendToCurrentClient(json_encode($new_message));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;客户端发言&nbsp;message:&nbsp;{type:say,&nbsp;to_client_id:xx,&nbsp;content:xx}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'say':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;非法请求<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(!<span>isset($_SESSION[<span>'room_id']))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>throw&nbsp;<span>new&nbsp;\<span>Exception(<span>"\$_SESSION['room_id']&nbsp;not&nbsp;set.&nbsp;client_ip:{$_SERVER['REMOTE_ADDR']}");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$room_id&nbsp;=&nbsp;$_SESSION[<span>'room_id'];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$client_name&nbsp;=&nbsp;$_SESSION[<span>'client_name'];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;私聊<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($message_data['to_client_id']&nbsp;!=&nbsp;'all')<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message&nbsp;=&nbsp;array(<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'type'=&gt;'say',<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'from_client_id'=&gt;$client_id,<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'from_client_name'&nbsp;=&gt;$client_name,<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'to_client_id'=&gt;$message_data['to_client_id'],<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'content'=&gt;"&lt;b&gt;对你说:&nbsp;&lt;/b&gt;".nl2br(htmlspecialchars($message_data['content'])),<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'time'=&gt;date('Y-m-d&nbsp;H:i:s'),<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gateway::sendToClient($message_data['to_client_id'],&nbsp;json_encode($new_message));<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message['content']&nbsp;=&nbsp;"&lt;b&gt;你对".htmlspecialchars($message_data['to_client_name'])."说:&nbsp;&lt;/b&gt;".nl2br(htmlspecialchars($message_data['content']));<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Gateway::sendToCurrentClient(json_encode($new_message));<br /><span>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message&nbsp;=&nbsp;<span>array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'type'=&gt;<span>'say',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'from_client_id'=&gt;$client_id,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'from_client_name'&nbsp;=&gt;$client_name,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'to_client_id'=&gt;<span>'all',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'content'=&gt;nl2br(htmlspecialchars($message_data[<span>'content'])),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'time'=&gt;date(<span>'Y-m-d&nbsp;H:i:s'),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;Gateway::sendToGroup($room_id&nbsp;,json_encode($new_message));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;当客户端断开连接时<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;integer&nbsp;$client_id&nbsp;客户端id<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span>static&nbsp;<span><span>function&nbsp;<span>onClose<span>($client_id)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;debug<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"client:{$_SERVER['REMOTE_ADDR']}:{$_SERVER['REMOTE_PORT']}&nbsp;gateway:{$_SERVER['GATEWAY_ADDR']}:{$_SERVER['GATEWAY_PORT']}&nbsp;client_id:$client_id&nbsp;onClose:''\n";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;从房间的客户端列表中删除<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(<span>isset($_SESSION[<span>'room_id']))<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$room_id&nbsp;=&nbsp;$_SESSION[<span>'room_id'];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$new_message&nbsp;=&nbsp;<span>array(<span>'type'=&gt;<span>'logout',&nbsp;<span>'from_client_id'=&gt;$client_id,&nbsp;<span>'from_client_name'=&gt;$_SESSION[<span>'client_name'],&nbsp;<span>'time'=&gt;date(<span>'Y-m-d&nbsp;H:i:s'));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gateway::sendToGroup($room_id,&nbsp;json_encode($new_message));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />}<br /><strong>客户端页面<br /></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<pre><code><code><span>&lt;!DOCTYPE&nbsp;html&gt;<br /><span>&lt;<span>html&nbsp;<span>lang=<span>"en"&gt;<br /><span>&lt;<span>head&gt;<br />&nbsp;&nbsp;<span>&lt;<span>meta&nbsp;<span>charset=<span>"UTF-8"&gt;<br />&nbsp;&nbsp;<span>&lt;<span>title&gt;与{{$to-&gt;name}}的对话<span>&lt;/<span>title&gt;<br />&nbsp;&nbsp;<span>&lt;<span>script&nbsp;<span>type=<span>"text/javascript"&nbsp;<span>src=<span>"{{asset('js')}}/swfobject.js"&gt;&lt;/<span>script&gt;<br />&nbsp;&nbsp;<span>&lt;<span>script&nbsp;<span>type=<span>"text/javascript"&nbsp;<span>src=<span>"{{asset('js')}}/web_socket.js"&gt;&lt;/<span>script&gt;<br />&nbsp;&nbsp;<span>&lt;<span>script&nbsp;<span>type=<span>"text/javascript"&nbsp;<span>src=<span>"{{asset('js')}}/jquery.min.js"&gt;&lt;/<span>script&gt;<br />&nbsp;&nbsp;<span>&lt;<span>link&nbsp;<span>href=<span>"{{asset('css')}}/jquery-sinaEmotion-2.1.0.min.css"&nbsp;<span>rel=<span>"external&nbsp;nofollow"&nbsp;<span>rel=<span>"stylesheet"&gt;<br />&nbsp;&nbsp;<span>&lt;<span>link&nbsp;<span>href=<span>"{{asset('css')}}/bootstrap.min.css"&nbsp;<span>rel=<span>"external&nbsp;nofollow"&nbsp;<span>rel=<span>"stylesheet"&gt;<br />&nbsp;&nbsp;<span>&lt;<span>link&nbsp;<span>href=<span>"{{asset('css')}}/style.css"&nbsp;<span>rel=<span>"external&nbsp;nofollow"&nbsp;<span>rel=<span>"stylesheet"&gt;<br />&nbsp;&nbsp;<span>&lt;<span>script&nbsp;<span>type=<span>"text/javascript"&nbsp;<span>src=<span>"{{asset('js')}}/jquery-sinaEmotion-2.1.0.min.js"&gt;&lt;/<span>script&gt;<br /><br />&nbsp;&nbsp;{{--&lt;script&nbsp;src="https://code.jquery.com/jquery-3.3.1.min.js"&gt;&lt;/script&gt;--}}<br /><br /><span>&lt;/<span>head&gt;<br /><span>&lt;<span>style&gt;<br />&nbsp;&nbsp;<span>#sinaEmotion&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>z-index:&nbsp;<span>999;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>width:&nbsp;<span>373px;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>padding:&nbsp;<span>10px;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>display:&nbsp;none;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>font-size:&nbsp;<span>12px;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>background:&nbsp;<span>#fff;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>overflow:&nbsp;hidden;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>position:&nbsp;absolute;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>border:&nbsp;<span>1px&nbsp;solid&nbsp;<span>#e8e8e8;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>top:&nbsp;<span>100px;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>left:&nbsp;<span>542.5px;<br />&nbsp;&nbsp;}<br />&lt;/<span>style&gt;<br /><span>&lt;<span>body&nbsp;<span>onload=<span>"connect();"&nbsp;<span>style=<span>"margin:&nbsp;auto;&nbsp;text-align:&nbsp;center;"&gt;<br /><span>&lt;<span>div&nbsp;<span>style=<span>"margin:&nbsp;auto;"&gt;<br />&nbsp;&nbsp;<span>&lt;<span>div&nbsp;<span>style=<span>"border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;height:&nbsp;40px;&nbsp;width:&nbsp;500px;&nbsp;margin:&nbsp;auto;"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{{--对话窗口头部--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>div&nbsp;<span>style=<span>"width:&nbsp;80px;&nbsp;height:&nbsp;40px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;blue;&nbsp;float:&nbsp;left"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>img&nbsp;<span>src=<span>"{{$to-&gt;heading}}"&nbsp;<span>width=<span>"80px"&nbsp;<span>height=<span>"40px"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>div&nbsp;<span>style=<span>"width:&nbsp;150px;&nbsp;height:&nbsp;40px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;blue;&nbsp;float:&nbsp;left"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{$to-&gt;name}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{{--//对话窗口内容--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>div&nbsp;<span>class=<span>"content"&nbsp;<span>style=<span>"width:&nbsp;500px;&nbsp;height:&nbsp;400px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;green;&nbsp;margin-top:&nbsp;40px;&nbsp;overflow-y:&nbsp;auto"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--对方的头像与文字--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style="min-height:&nbsp;50px;margin-top:&nbsp;10px;"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;left"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;img&nbsp;src="{{$to-&gt;heading}}"&nbsp;<span>width=<span>"50px"&nbsp;<span>height=<span>"50px"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;left;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;dsadsadsadsadsa&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--我的头像与文字--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style=&nbsp;"min-height:50px;margin-top:&nbsp;10px;"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;right"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;img&nbsp;src="{{$from-&gt;heading}}"&nbsp;<span>width=<span>"50px"&nbsp;<span>height=<span>"50px"&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;right;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;dsadsadsadsadsa&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{--&lt;/div&gt;--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{{--对话发送窗口--}}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>form&nbsp;<span>onsubmit=<span>"return&nbsp;onSubmit();&nbsp;return&nbsp;false;"&nbsp;<span>id=<span>"ajaxfrom"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"hidden"&nbsp;<span>name=<span>"to"&nbsp;<span>value=<span>"{{$to-&gt;id}}"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"hidden"&nbsp;<span>name=<span>"from"&nbsp;<span>value=<span>"{{$from-&gt;id}}"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"hidden"&nbsp;<span>name=<span>"room_id"&nbsp;<span>value=<span>"{{$room}}"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"hidden"&nbsp;<span>name=<span>"tag"&nbsp;<span>value=<span>"{{$tag}}"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>textarea&nbsp;<span>id=<span>"textarea"&nbsp;<span>name=<span>"content"&nbsp;<span>class=<span>"Input_text"&nbsp;<span>style=<span>"margin:&nbsp;0px;&nbsp;width:&nbsp;501px;&nbsp;height:&nbsp;213px;"&gt;&lt;/<span>textarea&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>div&nbsp;<span>class=<span>"say-btn"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"button"&nbsp;<span>class=<span>"btn&nbsp;btn-default&nbsp;face&nbsp;pull-left"&nbsp;<span>value=<span>"表情"&nbsp;/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span>button&nbsp;<span>type=<span>"submit"&nbsp;<span>class=<span>"btn&nbsp;btn-default"&gt;发表<span>&lt;/<span>button&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span>form&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;房间号{{$room}}<br />&nbsp;&nbsp;<span>&lt;/<span>div&gt;<br /><span>&lt;/<span>div&gt;<br /><br /><span>&lt;/<span>body&gt;<br /><span>&lt;/<span>html&gt;<br /><span>&lt;<span>script&nbsp;<span>type=<span>"text/javascript"&gt;<br />&nbsp;&nbsp;<span>if&nbsp;(<span>typeof&nbsp;<span>console&nbsp;==&nbsp;<span>"undefined")&nbsp;{&nbsp;&nbsp;<span>this.console&nbsp;=&nbsp;{&nbsp;<span>log:&nbsp;<span><span>function&nbsp;(<span>msg)&nbsp;{&nbsp;}&nbsp;};}<br />&nbsp;&nbsp;<span>//&nbsp;如果浏览器不支持websocket，会使用这个flash自动模拟websocket协议，此过程对开发者透明<br />&nbsp;&nbsp;WEB_SOCKET_SWF_LOCATION&nbsp;=&nbsp;<span>"/swf/WebSocketMain.swf";<br />&nbsp;&nbsp;<span>//&nbsp;开启flash的websocket&nbsp;debug<br />&nbsp;&nbsp;WEB_SOCKET_DEBUG&nbsp;=&nbsp;<span>true;<br />&nbsp;&nbsp;<span>var&nbsp;ws,&nbsp;name,&nbsp;client_list={};<br />&nbsp;&nbsp;<span>var&nbsp;to_client_id=<span>"";<br /><br />&nbsp;&nbsp;<span>//&nbsp;连接服务端初始化函数<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>connect()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;创建websocket&nbsp;届时可以替换为对应的服务器地址<br />&nbsp;&nbsp;&nbsp;&nbsp;ws&nbsp;=&nbsp;<span>new&nbsp;WebSocket(<span>"ws://"+<span>document.domain+<span>":7272");<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;当socket连接打开时，输入用户名<br />&nbsp;&nbsp;&nbsp;&nbsp;ws.onopen&nbsp;=&nbsp;onopen;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;当有消息时根据消息类型显示不同信息<br />&nbsp;&nbsp;&nbsp;&nbsp;ws.onmessage&nbsp;=&nbsp;onmessage;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//当连接丢失时，调用连接方法尝试重新连接<br />&nbsp;&nbsp;&nbsp;&nbsp;ws.onclose&nbsp;=&nbsp;<span><span>function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"连接关闭，定时重连");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect();<br />&nbsp;&nbsp;&nbsp;&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//当操作报错时，返回异常错误<br />&nbsp;&nbsp;&nbsp;&nbsp;ws.onerror&nbsp;=&nbsp;<span><span>function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"出现错误");<br />&nbsp;&nbsp;&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//发送ajax获取当前房间的通话记录<br />&nbsp;&nbsp;&nbsp;&nbsp;$.post(<span>"/get_record",&nbsp;{&nbsp;<span>"room":<span>"{{$room}}"&nbsp;},<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><span>function(<span>msg){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.each(msg,<span><span>function&nbsp;(<span>v,k)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(k);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//判断<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(k.tag!=<span>"{{$tag}}"){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>".content").append(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="min-height:&nbsp;50px;margin-top:&nbsp;10px;"&gt;'&nbsp;+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;left"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;img&nbsp;src="{{$to-&gt;heading}}"&nbsp;width="50px"&nbsp;height="50px"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;left;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;'+k.content+<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&gt;'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).parseEmotion();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span>else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>".content").append(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="min-height:&nbsp;50px;margin-top:&nbsp;10px;"&gt;'&nbsp;+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;right"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;img&nbsp;src="{{$from-&gt;heading}}"&nbsp;width="50px"&nbsp;height="50px"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;right;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;'+k.content+<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&gt;'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).parseEmotion();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>//&nbsp;连接建立时发送登录信息<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onopen()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;login_data=<span>'{"type":"login","client_name":"{{$from-&gt;name}}","room_id":"{{$room}}","to":"{{$to-&gt;id}}","from":"{{$from-&gt;id}}","tag":"{{$tag}}"}';<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;ws.send(login_data);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>'登录成功')<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>//&nbsp;服务端发来消息时<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onmessage(<span>e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;data&nbsp;=&nbsp;<span>JSON.parse(e.data);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>switch(data[<span>'type']){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;服务端ping客户端心跳<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'ping':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ws.send(<span>'{"type":"pong"}');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;登录&nbsp;更新用户列表<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'login':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//讲需要的发送ID保存到本地to_client_id变量中<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>for(<span>var&nbsp;p&nbsp;<span>in&nbsp;data[<span>'client_list']){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to_client_id=p;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(to_client_id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;发言<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'say':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(data);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say(data[<span>'from_client_id'],&nbsp;data[<span>'from_client_name'],&nbsp;data[<span>'content'],&nbsp;data[<span>'time']);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;用户退出&nbsp;更新用户列表<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'logout':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(data);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>case&nbsp;<span>'init':<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//此处可以发送ajax用于绑定不同的用户ID和client<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(data);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>break;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>//&nbsp;提交对话<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onSubmit()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//先检查当前的对话是否超过20条记录数<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;count=<span>true;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//发送ajax获取当前房间的通话记录<br />&nbsp;&nbsp;&nbsp;&nbsp;$.ajax({<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>url:&nbsp;<span>"/check_count",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>type:&nbsp;<span>"post",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>async:<span>false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;cache:&nbsp;false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;contentType:&nbsp;false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;processData:&nbsp;false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data:{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'room':<span>"1",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>success:&nbsp;<span><span>function&nbsp;(<span>msg)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(msg&gt;<span>10){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(<span>'当前的对话已经超过次数，请购买对应服务')<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count=<span>false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;});<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(count){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;neirong=$(<span>"#textarea").val().replace(<span>/"/g,&nbsp;<span>'\\"').replace(<span>/\n/g,<span>'\\n').replace(<span>/\r/g,&nbsp;<span>'\\r');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//ajax先把对应的内容发送到后台录入,回调成功后才把信息发送<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;fm=$(<span>"#ajaxfrom")[<span>0];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;formData&nbsp;=&nbsp;<span>new&nbsp;FormData(fm);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.ajax({<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>url:&nbsp;<span>"/record",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>type:&nbsp;<span>"post",<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>cache:&nbsp;<span>false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>contentType:&nbsp;<span>false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>processData:&nbsp;<span>false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>data:&nbsp;formData,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>beforeSend:<span><span>function(){<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>success:&nbsp;<span><span>function&nbsp;(<span>msg)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(msg.code==<span>"0"){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ws.send(<span>'{"type":"say","to_client_id":"all","to_client_name":"{{$to-&gt;name}}","content":"'+neirong+<span>'"}');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//清空文本框内容<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>"#textarea").val(<span>"");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//强制定位光标<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>"#textarea").focus();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span>else{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;<span>false;<br /><br /><br />&nbsp;&nbsp;}<br /><br /><br /><br />&nbsp;&nbsp;<span>//&nbsp;发言<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>say(<span>from_client_id,&nbsp;from_client_name,&nbsp;content,&nbsp;time){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//判断当前的用户名称与发送消息的名称是否一致<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(&nbsp;<span>"{{$from-&gt;name}}"&nbsp;==&nbsp;from_client_name){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>".content").append(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="min-height:&nbsp;50px;margin-top:&nbsp;10px;"&gt;'&nbsp;+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;right"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;img&nbsp;src="{{$from-&gt;heading}}"&nbsp;width="50px"&nbsp;height="50px"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;right;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;'+content+<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&gt;'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).parseEmotion();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<span>else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>".content").append(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="min-height:&nbsp;50px;margin-top:&nbsp;10px;"&gt;'&nbsp;+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="width:&nbsp;50px;height:&nbsp;50px;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;margin-left:10px;&nbsp;float:&nbsp;left"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;img&nbsp;src="{{$to-&gt;heading}}"&nbsp;width="50px"&nbsp;height="50px"&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&nbsp;style="border:&nbsp;1px&nbsp;solid&nbsp;red;&nbsp;float:&nbsp;left;&nbsp;min-height:&nbsp;50px"&nbsp;&gt;'+content+<span>'&lt;/div&gt;'+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>'&lt;div&gt;'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).parseEmotion();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;$("#dialog").append('&lt;div&nbsp;class="speech_item"&gt;&lt;img&nbsp;src="http://lorempixel.com/38/38/?'+from_client_id+'"&nbsp;class="user_icon"&nbsp;/&gt;&nbsp;'+from_client_name+'&nbsp;&lt;br&gt;&nbsp;'+time+'&lt;div&nbsp;style="clear:both;"&gt;&lt;/div&gt;&lt;p&nbsp;class="triangle-isosceles&nbsp;top"&gt;'+content+'&lt;/p&gt;&nbsp;&lt;/div&gt;').parseEmotion();<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;$(<span><span>function(){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//全局用户ID<br />&nbsp;&nbsp;&nbsp;&nbsp;select_client_id&nbsp;=&nbsp;<span>'all';<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//如果发送的用户有变化则对应的用户ID进行替换<br />&nbsp;&nbsp;&nbsp;&nbsp;$(<span>"#client_list").change(<span><span>function(){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select_client_id&nbsp;=&nbsp;$(<span>"#client_list&nbsp;option:selected").attr(<span>"value");<br />&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//表情选择<br />&nbsp;&nbsp;&nbsp;&nbsp;$(<span>'.face').click(<span><span>function(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>this).sinaEmotion();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event.stopPropagation();<br />&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;});<br /><br />&nbsp;&nbsp;<span>//&nbsp;document.write('&lt;meta&nbsp;name="viewport"&nbsp;content="width=device-width,initial-scale=1"&gt;');<br />&nbsp;&nbsp;$(<span>"textarea").on(<span>"keydown",&nbsp;<span><span>function(<span>e)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//按enter键自动提交<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(e.keyCode&nbsp;===&nbsp;<span>13&nbsp;&amp;&amp;&nbsp;!e.ctrlKey)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.preventDefault();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>'form').submit();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;<span>false;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//&nbsp;按ctrl+enter组合键换行<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if(e.keyCode&nbsp;===&nbsp;<span>13&nbsp;&amp;&amp;&nbsp;e.ctrlKey)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(<span>this).val(<span><span>function(<span>i,val){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;val&nbsp;+&nbsp;<span>"\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;});<br /><br />&lt;/<span>script&gt;<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><span>&nbsp;</span>这两个代码片段其实就是主要运行的核心片段。其他框架的自带参数需要各位自己去根据文档去调试优化。到此基于workerman的聊天用于功能demo已经搭建完毕。</p>
<ul>
<li>以上是文章全部内容，有需要学习交流的友人请加入Swoole交流群的咱们一起，有问题一起交流，一起进步！前提是你是学技术的。感谢阅读！</li>
</ul>
<p><a class=" wrap external" href="https://link.zhihu.com/?target=https%3A//jq.qq.com/%3F_wv%3D1027%26k%3D5mcCu53" rel="nofollow noreferrer" target="_blank" data-za-detail-view-id="1043">点此加入该群</a></p>
<pre><code><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
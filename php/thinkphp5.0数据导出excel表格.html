<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修thinkphp5.0数据导出excel表格' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>thinkphp5.0数据导出excel表格</center></div><div class='banquan'>原文出处:本文由博客园博主张喜龙提供。<br/>
原文连接:https://www.cnblogs.com/zhangxilong/p/11662931.html</div><br>
    <p>第一步、创建Model类文件（名称自定）</p>
<p><img src="./images/thinkphp5.0数据导出excel表格0.jpg" alt="" /></p>
<p>第二步、在类中写入以下代码</p>
<pre><code>&lt;?php<br /><br />namespace Admin\admin\model;<br /><br />use think\Model;<br /><br />class MarkModel extends Model{<br /><br />    //导出预约信息<br />    public function outExcel1(){<br /><br />        $del=@implode(",",$_POST["del"]);<br /><br />        if($del!=""){<br /><br />            $art = db('messga');<br /><br />            $where['id'] = array('in',$del);<br /><br />            $rs = $art-&gt;where($where)-&gt;order('id desc')-&gt;select();<br /><br />            foreach ($rs as $v){<br />                $excdata[]=array(<br /><br />                    'id'=&gt;$v["id"],<br /><br />                    'names'=&gt;$v["names"],<br /><br />                    'phone'=&gt;$v["phone"],<br /><br />                    'email'=&gt;$v["email"],<br /><br />                    'cid'=&gt;$v["cid"],<br /><br />                    'companynames'=&gt;$v["companynames"],<br /><br />                    'tel'=&gt;$v["tel"],<br /><br />                    'num'=&gt;$v["num"],<br /><br />                    'p_names'=&gt;$v["p_names"],<br /><br />                    'dates'=&gt;date('Y-m-d H:i:s',$v["dates"])<br /><br />                );<br />            }<br /><br /><br />        }else{<br /><br />            $art = db('message');<br /><br />            $rs = $art-&gt;order('id desc')-&gt;select();<br /><br />            foreach($rs as $v){<br />                $excdata[]=array(<br /><br />                    'id'=&gt;$v["id"],<br /><br />                    'names'=&gt;$v["names"],<br /><br /><br />                    'phone'=&gt;$v["phone"],<br /><br />                    'email'=&gt;$v["email"],<br /><br />                    'cid'=&gt;$v["cid"],<br /><br />                    'companynames'=&gt;$v["companynames"],<br /><br />                    'tel'=&gt;$v["tel"],<br /><br /><br />                    'num'=&gt;$v["num"],<br /><br />                    'p_names'=&gt;$v["p_names"],<br /><br />                    'dates'=&gt;date('Y-m-d H:i:s',$v["dates"])<br /><br />                );<br />            }<br /><br />            //echo "&lt;script&gt;alert ('请选中要导出的数据'); history.go(-1);&lt;/script&gt;";<br /><br />        }<br /><br /><br />　　　　//数组信息根据自己项目而定<br />        $expCellName=array(<br /><br />            array('id','序号'),<br /><br />            array('names','姓名'),<br /><br />            array('phone','电话'),<br /><br />            array('email','邮箱'),<br /><br />            array('companynames','公司名称'),<br /><br />            array('num','人数'),<br /><br />            array('cid','公开课'),<br /><br />            array('p_names','职务'),<br /><br />            array('tel','座机'),<br /><br />            array('dates','提交日期')<br /><br />        );<br /><br />        $this-&gt;exportExcel('留言信息',$expCellName,$excdata);<br /><br />        exit;<br /><br /><br />    }<br /><br /><br /><br /><br />    /**<br /><br />     * 导出操作<br /><br />     * 参数1：$expTitle :导出excel的标题<br /><br />     * 参数2：$expCellName:导出到表格中需要显示每一列的标题 如下：<br /><br />     * $expCellName=array(<br /><br />     *  参数三：$expTableData : 需要导出的表中数据<br /><br />     *<br /><br />     *<br /><br />     */<br /><br />    public function exportExcel($expTitle='', $expCellName, $expTableData){<br /><br />　　　　　//引入PHPExcell类<br />        import('PHPExcel.Classes.PHPExcel');<br /><br />        import('PHPExcel.Classes.PHPExcel.IOFactory.PHPExcel_IOFactory');<br /><br />        $xlsTitle = iconv('utf-8', 'gb2312', $expTitle);<br /><br />        //文件名称<br /><br />        $fileName = $expTitle.date('_YmdHis');<br /><br />        //or $xlsTitle 文件名称可根据自己情况设定<br /><br />        $cellNum = count($expCellName);<br /><br />        $dataNum = count($expTableData);<br /><br />        vendor("phpoffice.phpexcel.Classes.PHPExcel");<br /><br />        $objPHPExcel = new \PHPExcel();<br /><br />        $cellName    = array('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');<br /><br />        // 设置水平垂直居中<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getAlignment()-&gt;setHorizontal(\PHPExcel_Style_Alignment::HORIZONTAL_CENTER);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getAlignment()-&gt;setVertical(\PHPExcel_Style_Alignment::VERTICAL_CENTER);<br /><br />        //设置excel表格 从 A1 到 AB1 这一行的字体加粗<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A1:AB1')-&gt;getFont()-&gt;setBold(true);<br /><br />        // 设置某一行的高度 1.2.3<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension('1')-&gt;setRowHeight(20);<br /><br /><br /><br />        //J 、 K列为文本 (输入什么就是什么，不会随着excel系统格式变化)<br /><br />        // $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('J')-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);<br /><br />        // $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('K')-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);<br /><br />        //设置某一列的宽度<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('B')-&gt;setWidth(25);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('C')-&gt;setWidth(25);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('D')-&gt;setWidth(25);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('E')-&gt;setWidth(45);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('F')-&gt;setWidth(105);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('G')-&gt;setWidth(20);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('H')-&gt;setWidth(20);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('I')-&gt;setWidth(20);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('J')-&gt;setWidth(15);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('K')-&gt;setWidth(15);<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('N')-&gt;setWidth(20);<br /><br />        // 设置某一行的高度 1.2.3<br /><br />        $objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension('1')-&gt;setRowHeight(20);<br /><br />        // 隐藏某一列<br /><br />        //$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('A')-&gt;setVisible(false);<br /><br />        //$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('B')-&gt;setVisible(false);<br /><br />        //$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('D')-&gt;setVisible(false);<br /><br />        //$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('E')-&gt;setVisible(false);<br /><br />        //合并单元格<br /><br />        // $objPHPExcel-&gt;getActiveSheet(0)-&gt;mergeCells('A1:' . $cellName[$cellNum - 1] . '1');<br /><br />        // $objPHPExcel-&gt;setActiveSheetIndex(0)-&gt;setCellValue('A1', $expTitle.'  Export time:'.date('Y-m-d H:i:s'));<br /><br />        for ($i = 0; $i &lt; $cellNum; $i++) {<br /><br />            $objPHPExcel-&gt;setActiveSheetIndex(0)-&gt;setCellValue($cellName[$i] . '1', $expCellName[$i][1]);<br /><br />        }<br /><br />        // Miscellaneous glyphs, UTF-8<br /><br />        for ($i = 0; $i &lt; $dataNum; $i++) {<br /><br />            for ($j = 0; $j &lt; $cellNum; $j++) {<br /><br />                $objPHPExcel-&gt;getActiveSheet(0)-&gt;setCellValue($cellName[$j] . ($i + 2), $expTableData[$i][$expCellName[$j][0]]);<br /><br />            }<br /><br />        }<br /><br />        // header('pragma:public');<br /><br />        header('Content-type:application/vnd.ms-excel;charset=utf-8;name="' . $xlsTitle . '.xls"');<br /><br />        header("Content-Disposition:attachment;filename={$fileName}.xls");<br /><br />        //attachment新窗口打印inline本窗口打印<br /><br />        $objWriter = \PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');<br /><br />        $objWriter-&gt;save('php://output');<br /><br />        exit;<br /><br />    }<br /><br /><br /><br />}</code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修PHP全栈学习笔记12' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>PHP全栈学习笔记12</center></div><div class='banquan'>原文出处:本文由博客园博主达达前端小酒馆提供。<br/>
原文连接:https://www.cnblogs.com/dashucoding/p/10780708.html</div><br>
    <p><img src="./images/PHP全栈学习笔记120.jpg" alt="image.png" /></p>
<p>php简介，php历史，php后端工程师职业前景，php技术方向，php后端工程师职业体系介绍。</p>
<p>php是世界上使用最广泛的web开发语言，是超文本预处理器，是一种通用的开源脚本语言，语法吸收了c语言，Java语言，和Perl的特点，利于学习，使用广泛，主要适用于web开发，PHP做出来的动态页面与其他的编程语言相比，PHP是将持续嵌入到HTML文档中去执行，执行效率比完全生成HTML标记的CGI要高许多，PHP还可以执行编译后的代码，编译后可以达到加密和优化代码的目的，让代码运行更快。</p>
<p>PHP是在1994年由Rasmus Lerdorf创建的，开始只是一个简单的用Perl语言编写的程序，用来统计他自己的网站的访问者，后来通过c语言的重写编写，可以访问数据库，1995年开始对外发布第一个版本，名Personal Home Page Tools，随后发布了php 1.0版本。</p>
<p>1995年，php2.0发布了。1997年，php3发布，2004年，PHP5.0发布了。</p>
<p>PHP的使用更加广泛，web3.0的升温，PHP是优秀的web开发语言，linux,apache,mysql黄金组合。</p>
<p>web后端技术，web前端技术与PHP语言，linux操作系统，mysql数据库，各种php开发框架，缓存技术和海量数据优化技术，系统调优和负载均衡技术。</p>
<p>HTML入门，JavaScript入门，PHP语言基础，源码管理工作，mysql数据库。</p>
<p>Linux操作系统，PHP面向对象，语言高级开发技术，常用PHP开发框架，PHP与公共api接口开发，PHP测试工具。</p>
<p>深入学习http协议，PHP环境高级配置，mysql数据库优化技术，静态化和缓存技术，网站安全技术。</p>
<p>深入分析PHP框架源代码，深入学习PHP内核，noSQL型数据库，集群与负载均衡技术。</p>
<p>深入学习Linux操作系统，多级缓存技术，海量数据优化技术，容灾技术，大型系统框架设计方法。</p>
<p>数据库PDO简介：</p>
<p>pdo简介，安装与配置，pdo链接数据库，pdo对象方法介绍以及使用，pdostatement对象方法介绍以及使用，pdo错误处理，pdo参数绑定与预处理，pdo事务处理，pdo实战。</p>
<p>pdo是数据库访问抽象层，统一各种数据库的访问接口。</p>
<p>pdo特性，编码一致性，灵活性，高性能，面向对象特性。</p>
<p><img src="./images/PHP全栈学习笔记121.jpg" alt="image.png" /></p>
<p>开启pdo:</p>
<pre><code><code>extension = php_pdo.dll</code></code></pre>
<pre><code><code>extension = php_pdo_mysql.dll</code></code></pre>
<p>通过参数形式连接，通过uri形式连接，通过配置文件形式连接数据库。</p>
<pre><code><code>&lt;?php
// 通过参数形式连接数据库
try {
 $dsn = &#39;mysql:host=localhost; dbname=dashucoding&#39;;
 $username=‘root’;
 $passwd=&#39;root&#39;;
 $pdo=new PDO($dsn, $username, $passwd);
 var_dump($pdo);
}catch(PDOException $e){
 echo $e -&gt; getMessage();
}</code></code></pre>
<p><img src="./images/PHP全栈学习笔记122.jpg" alt="image.png" /></p>
<pre><code><code>&lt;?php
// 通过uri的形式连接数据库
try {
 $dsn=&#39;uri:file//文件路径\dsn.txt&#39;;
 $username=&#39;root&#39;;
 $passwd=&#39;root&#39;;
 $pdo = new PDO($dsn, $username, $password);
 var_dump($pdo);
}catch(PDOException $e){
 echo $e-&gt;getMessage();
}</code></code></pre>
<pre><code><code>mysql:dbname=dashucoding; host=localhost</code></code></pre>
<p><img src="./images/PHP全栈学习笔记123.jpg" alt="image.png" /></p>
<p>插入记录操作</p>
<pre><code><code>&lt;?php
try{
$pdo = new PDO(&#39;mysql:host=localhost;dbname=&#39;dashucoding&#39;,&#39;root&#39;,&#39;root&#39;);
// exec对select没有作用
// exec()执行一条语句并返回其受影响的记录条数
$sql = &lt;&lt;&lt;EOF
 CREATE TABLE IF NOT EXISTS user(
 id INT UNSIGNED AUT_INCREMENT key,
 username varchar(20) not null unique,
 password CHAR(32) not null,
 email varchar(30) not null
 );
EOF;
 $res = $pdo -&gt; exec($sql);
 var_dump($res);

 $sql=&#39;insert user(username,password,email) values (&#39;dashu&#39;,&quot;&#39;.md5(&#39;dashu&#39;).&#39;&quot;,&quot;23@qq.com&quot;)&#39;));
}catch(PDOException $e){
 echo $e -&gt; getMessage();
}</code></code></pre>
<p>errorCode()和errorInfo()方法查看错误信息</p>
<pre><code><code>&lt;?php
header(&#39;content-type:text/html; charset=utf-8&#39;);

try{
$pdo = new PDO(&#39;mysql:host=localhost; dbname=dashucoding&#39;, &#39;root&#39;, &#39;root&#39;);
$res = $pdo-&gt;exec($sql);
var_dump($res);
 if($res === false){
  echo $pdo -&gt; errorCode();
  echo &#39;&lt;br/&gt;&#39;;
  echo $pdo -&gt; errorInfo();
  print_r($errInfo);
  }
}catch(PDOException $e){
echo $e-&gt;getMessage();
}</code></code></pre>
<blockquote>
<p>query()方法执行查询语句</p>
</blockquote>
<pre><code><code>&lt;?php
header(&#39;content-type:text/html; charset=utf-8&#39;);
try{
 $pdo = new PDO(&#39;mysql:host=localhost; dbname=dashucoding&#39;, &#39;root&#39;, &#39;root&#39;);
 $sql = &#39;select * from user where id = 3&#39;;
 $stmt = $pdo -&gt; query($sql);
 var_dump($stmt);
 foreach($stmt as $row){
 }

}catch(PDOException $e){
 echo $e -&gt; getMessage();
}</code></code></pre>
<p><img src="./images/PHP全栈学习笔记124.jpg" alt="image.png" /></p>
<p>了解pdo，连接数据库的方法，pdo中执行sql语句的方法，pdo中获取结果集的方法，掌握pdo中获取sql语句中的错误，错误处理的方法，事务处理，pdo中存储过程。</p>
<blockquote>
<p>pdo是PHP数据对象。</p>
</blockquote>
<p>pdo是一个数据库访问抽象层，可以统一各种数据库的访问接口。</p>
<p>安装pdo，linux环境下，要使用mysql数据库configure命令：</p>
<pre><code><code>--with-pdo-mysql=/path/to/mysql/installation</code></code></pre>
<p>pdo连接数据库：</p>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$dbName = &#39;db_database&#39;;
$user = &#39;root&#39;;
$pwd = &#39;root&#39;;
$host = &#39;localhost&#39;;
$dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
try{
 $pdo = new PDO($dsn, $user, $pwd);
 echo &quot;pdo连接mysql成功&quot;;
}catch(Exception $e){
echo $e -&gt; getMessage().&quot;&lt;br&gt;&quot;;
}
?&gt;</code></code></pre>
<p>dsn:数据源名称<br />
username:连接数据库的用户名<br />
password:连接数据库的密码<br />
driver_options:连接数据库的其他选项</p>
<pre><code><code>&lt;?php
header(&#39;Content-Type:text/html; charset=utf-8&quot;);
$dbms=&#39;mysql&#39;;
$dbName=&#39;db_database&#39;;
$user=&#39;root&#39;;
$pwd=&#39;root&#39;;
$host=&#39;localhost&#39;;
$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
try{
 $pdo=new PDO($dsn, $uer, $pwd);
 echo &quot;PDO连接Mysql成功&quot;;
}catch(Exception $e){
 echo $e-&gt;getMessage().&quot;&lt;br&gt;&quot;;
}
?&gt;</code></code></pre>
<p>dsn为数据源，提供连接数据库需要的信息。</p>
<p>pdo执行sql语句：</p>
<pre><code><code>exec()方法
exec 方法返回执行sql语句后受影响的行数
int PDO::exec(string statement)
参数statement要执行的sql语句</code></code></pre>
<p>通用insert,delete和update</p>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$dbName=&#39;db_database&#39;;
$user=&#39;root&#39;;
$pwd=&#39;root&#39;;
$host=&#39;localhost&#39;;
$dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
$query=&quot;delete from tb_da where id=2&quot;; // sql语句
try{
$pdo = new PDO($dsn, $user, $pwd);
$affCount=$pdo -&gt; exec($query);
echo &quot;删除条数&quot;.$affCount;
}catch(Exception $e){
echo &quot;&quot;.$e-&gt;getMessage().&quot;&lt;br&gt;&quot;;
}
?&gt;</code></code></pre>
<p>query()方法</p>
<p>query()方法通常用于返回执行查询后的结果集</p>
<pre><code><code>PDOStatement PDO::query(string statement)</code></code></pre>
<pre><code><code>&lt;table width=&quot;200&quot; border=&quot;0&quot; bgcolor=&quot;#FF3377&quot;&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;/tr&gt;
&lt;/table&gt;

&lt;?php
$dbms = &#39;mysql&#39;;
$dbName=&#39;db_database&#39;;
$user=&#39;root&#39;
$pwd=&#39;root&#39;;
$dsn=&quot;$dbms:host=$host; dbname=$dbName&quot;;
$query = &quot;select * from tb_da&quot;;
try{
$pdo = new PDO($dsn, $user, $pwd);
$result=$pdo-&gt;query($query); // 输出结果集中的数据
foreach($result as $row){ // 输出结果集中的数据

}catch(Exception $e){
echo $e-&gt;getMessage().&quot;&lt;br&gt;&quot;;
}
?&gt;</code></code></pre>
<p>预处理语句:prepare()和execute()<br />
prepare()方法做查询的准备工作，execute()方法执行查询，bindParam()方法来绑定参数提供给execute()方法</p>
<pre><code><code>PDOStatement PDO::prepare(string statement [, array driver_options])
bool PDOStatement::execute([array input_parameters])</code></code></pre>
<p>prepare()和execute()方法：</p>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$host = &#39;localhost&#39;;
$dbName = &#39;db_da&#39;;
$user=&#39;root&#39;;
$pass=&#39;root&#39;;
$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
try{
$pdo=new PDO($dsn, $user, $pass);
$query = &quot;select * from tb_mysql&quot;;
$result = $pdo-&gt;prepare($query);
$result-&gt;execute();
while($res = $result-&gt;fetch(PDO::FETCH_ASSOC)){

}catch(PDOException $e){
die($e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<blockquote>
<p>php中获取结果集的方法</p>
</blockquote>
<p>fetch()方法获取结果集中的下一行数据<br />
fetchAll()方法获取结果集中的所有行<br />
fetchColumn()方法获取结果集中下一行指定的列的值</p>
<p>fetch()方法：参数</p>
<pre><code><code>mixed PDOStatement::fetch( fetch_style, cursor_orientation, int_cursor_offset)</code></code></pre>
<p>PDO::FETCH_ASSOC关联数组形式<br />
PDO::FETCH_NUM数字索引数组形式<br />
PDO::FETCH_BOTH两者数组形式都有<br />
PDO::FETCH_OBJ按照对象的形式<br />
PDO::FETCH_BOUND以布尔值的形式返回结果<br />
PDO::FETCH_LAZY 以关联数组，数字索引，和对象三种形式返回</p>
<p>cursor_orientation:PDOStatement对象的一个滚动游标<br />
cursor_offset:游标的偏移量</p>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$host=&#39;localhost&#39;;
$dbName=&#39;db_database&#39;;
$user=&#39;root&#39;;
$pass=&#39;root&#39;;
$dsn = &quot;$dbms:host=$host;dbname=$dbName&quot;;
try{
$pdo = new PDO($dsn, $user, $pass);
$query = &quot;select * from tb_pdo_mysql&quot;;
$result = $pdo-&gt;prepare($query);
$result-&gt;execute();
while($res=$result-&gt;fetch(PDO::FETCH_ASSOC)){
}catch(PDOException $e){
die( $e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<pre><code><code>&lt;?php
$dbms=&#39;mysql&#39;; // 数据库类型，对于开发者来说，使用不同的数据库，只要该这个就行
$host=&#39;localhost&#39;;
$dbName=&#39;db_database&#39;;
$user = &#39;root&#39;;
$pass = &#39;root&#39;;
$dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
try{
 $pdo = new PDO($dsn,$user,$pass);
 $query = &quot;select * from tb_pdo_mysql&quot;;
 $result=$pdo-&gt;prepare($query);
 $result-&gt;execute();
 while($res=$result-&gt;fetch(PDO::FETCH_ASSOC){

}catch(PDOException $e){
die( $e -&gt; getMessage() );
}
?&gt;</code></code></pre>
<p>fetchAll()方法获取结果集中的所有行</p>
<pre><code><code>array PDOStatement::fetchAll();
参数fetch_style:控制结果集中数据的返回方式
参数column_index:字段的索引
返回的是包含结果集中所有数据的二维数组</code></code></pre>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$host = &#39;localhost&#39;;
$dbName = &#39;db_database&#39;;
$user = &#39;root&#39;;
$pass = &#39;root&#39;;
$dsn = &quot;$dbmms:host=$host; dbname = $dbName&quot;;
try{
$pdo = new PDO($dsn, $user, $pass);
$query = &quot;select * from tb_pdo_mysql&quot;;
$result=$pdo -&gt; prepare($query);
$result-&gt;execute();
$res=$result-&gt;fetchAll(PDO::FETCH_ASSOC);
for($i=0;$i&lt;count($res);$i++){
?&gt;
&lt;tr&gt;
&lt;td height=&quot;22&quot; align=&quot;center&quot; valign=&quot;middle&quot;&gt;&lt;?php echo $res[$i][&#39;id&#39;];?&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;&lt;?php echo $res[$i][&#39;pdo_type&#39;];?&lt;/td&gt;
&lt;/tr&gt;
&lt;?php
}
}catch(PDOException $e){
 die(&quot;Error!:&quot;.$e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<p>fetchColumn()方法</p>
<p>获取结果集中下一行指定列的值：</p>
<pre><code><code>string PDOStatement::fetchColumn()</code></code></pre>
<p>参数column_number设置行中列到的索引值，该值从0开始，省略该参数将从第1列开始取值。</p>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$host = &#39;localhost&#39;;
$dbName = &#39;db_database&#39;;
$user = &#39;root&#39;;
$pass = &#39;root&#39;;
$dsn = &quot;$dbms:host=$host;dbname=$dbName&quot;;
try{
$pdo = new PDO($dsn, $user, $pass);
$query = &quot; select * from tb_pdo_mysql&quot;;
$result = $pdo -&gt; prepare($query); // 准备查询语句
$result -&gt; execute(); // 执行查询语句
?&gt;
&lt;tr&gt;
&lt;td&gt;&lt;?php echo $result-&gt;fetchColumn(0);?&gt;&lt;/td&gt;
&lt;td&gt;&lt;?php echo $result-&gt;fetchColumn(0);?&gt;&lt;/td&gt;
&lt;td&gt;&lt;?php echo $result-&gt;fetchColumn(0);?&gt;&lt;/td&gt;
&lt;td&gt;&lt;?php echo $result-&gt;fetchColumn(0);?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php
 }catch(PDOException $e) {
 die(&quot;Error!:&quot;.$e-&gt;getMessae().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<blockquote>
<p>pdo中捕获sql语句中的错误</p>
</blockquote>
<p>使用默认模式<br />
PDO::ERRMODE_SILENT<br />
pdo::errmode_silent</p>
<p>使用警告模式<br />
PDO::ERROMODE_WARNING<br />
pdo::erromode_warning</p>
<p>使用异常模式<br />
PDO::ERRMODE_EXCEPTION<br />
pdo::errmode_exception</p>
<pre><code><code>// pdo连接数据库mysql，通过预处理prepare()和execute()方法执行insert添加操作
&lt;?php
if($_POST[&#39;Submit&#39;]==&quot;提交&quot;&amp;&amp;$_POST[&#39;pdo&#39;]!=&quot;&quot;){
$dbms = &#39;mysql&#39;;// 数据库类型
$host = &#39;localhost&#39;; // 数据库主机名
$dbName = &#39;db_database&#39;; // 使用的数据库
$user = &#39;root&#39;; // 数据库的连接用户名
$pass = &#39;root&#39;; // 对应的密码
$dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
$pdo = new PDO($dsn, $user, $pass);
$query = &quot;insert into tb_pdo_mysql(pdo_type, database_name,dates) values (&quot;&quot;, $_POST[&#39;pdo&#39;].&quot;, &quot;.$_POST[&#39;databases&#39;].&quot;,&quot;.$_POST[&#39;dates&#39;].&quot;)&quot;;
$result = $pdo-&gt;prepare($query);
$result -&gt; execute();
$code = $result-&gt;errorCode();
if(empty($code)){
echo &quot;数据添加成功!&quot;&#39;
}else{
echo &quot;数据添加错误:&lt;br/&gt;&quot;;
echo &#39;sql query:&#39;.$query;
echo &#39;&lt;pre&gt;&#39;;
var dump($result-&gt;errorInfo());
echo &#39;&lt;/pre&gt;&#39;;
}}
?&gt;</code></code></pre>
<pre><code><code>// 设置警告模式，通过prepare()和execute()方法读取数据库中数据
// setAttribute()方法设置为警告模式
&lt;?php
$dbms = &#39;mysql&#39;; // 数据库类型
$host = &#39;localhost&#39;; // 数据库主机名
$dbName = &#39;db_database&#39;; // 数据库连接用户名
$user = &#39;root&#39;;
$pass = &#39;root&#39;;
$dsn=&quot;$dbms:host=$host; dbname=$dbName&quot;;
try{
 $pdo = new PDO($dsn, $user, $pass);
 $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING); // 设置为警告模式

$query = &quot;select * from tb_pdo_mysqls&quot;; // 定义sql语句
$result = $pdo -&gt; prepare($query); // 准备查询语句
$result-&gt;execute(); // 执行查询语句，并返回结果集
while($res=$result-&gt;fetch(PDO::FETCH_ASSOC)){
?&gt;
&lt;tr&gt;
 &lt;td&gt;&lt;?php echo $res[&#39;id&#39;];?&gt;&lt;/td&gt;
 &lt;td&gt;&lt;?php echo $res[&#39;date&#39;];?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php
 } 
 }catch(PDOException $e){
 die(&quot;Error!:&quot;.$e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<pre><code><code>// 异常模式
&lt;?php
heder(&quot;Content-type: text/html; charset=&quot;utf-8&quot;); // 设置文件编码格式
if($_GET[&#39;conn_id&#39;]!=&quot;&quot;){
 $dbms = &#39;mysql&#39;;//数据库类型
 $host = &#39;localhost&#39;;
 $dbName=&#39;db_database&#39;;
 $user=&#39;root&#39;;
 $pass=&#39;root&#39;;
 $dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
 try {
 $pdo = new PDO($dsn, $user, $pass);
 $pdo -&gt; setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
 $query=&quot;delete from tb_pdo_mysqls where Id=:id&quot;;
 $result = $pdo-&gt;prepare($query); // 预准备语句
 $result = bindParam(&#39;:id&#39;, $_GET[&#39;conn_id&#39;]); // 绑定更新的数据
 $result -&gt; execute();
}catch(PDOException $e) {
echo &#39;PDO Exception Caught.&#39;;
echo &#39;Error with the database:&lt;br/&gt;&#39;;
echo &#39;SQL Query:&#39;.$query;
echo &#39;&lt;pre&gt;&#39;;
echo &quot;Erro:&quot;.$e-&gt;getMessage().&quot;&lt;br/&gt;&quot;;
echo &quot;File:&quot;.$e-&gt;getCode().&quot;&lt;br/&gt;&quot;;
echo &quot;Line:&quot;.$e-&gt;getFile().&quot;&lt;br/&gt;&quot;;
echo &quot;Trace:&quot;.$e-&gt;getTranceAsString().&quot;&lt;br/&gt;&quot;;
echo &#39;&lt;/pre&gt;&#39;;
}}
?&gt;</code></code></pre>
<p>pdo中错误处理：<br />
errorCode()方法和errorInfo()方法</p>
<p>errorCode()方法用于获取在操作数据库句柄时所发生的错误代码。</p>
<pre><code><code>int PDOStatement::errorCode(void)</code></code></pre>
<p>errorCode()方法返回一个sqlstate代码。</p>
<pre><code><code>&lt;?php
$dbms=&#39;mysql&#39;; // 数据库类型
$host=&#39;localhost&#39;; // 数据库主机名
$dbName = &#39;db_database&#39;; // 使用的数据库
$user = &#39;root&#39;; // 数据库连接用户名
$pass = &#39;root&#39; 对应的密码
$dsn = &quot;dbms:host = $host; dbname = $dbName&quot;;
try{
$pdo = new PDO($dsn, $user, $pass);
$query = &quot;select * from tb_pdo_mysqls&quot;; // 定义sql语句
$result = $pdo -&gt; query($query); // 执行查询语句，并返回结果集
echo &quot;errorCode为: &quot;.$pdo-&gt;errorCode();
foreach($result as $items){
?&gt;
&lt;tr&gt;
&lt;td&gt;&lt;?php echo $items[&#39;id&#39;];?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php
 }
}catch(PDOException $e){
die(&quot;Error!:&quot; . $e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<p>errorInfo()方法用于获取操作数据库句柄时所发生的错误的信息。</p>
<pre><code><code>array PDOStatement::errorInfo(void)</code></code></pre>
<pre><code><code>&lt;?php
$dbms = &#39;mysql&#39;;
$host = &#39;localhost&#39;;
$dbName = &#39;db_database&#39;;
$user = &#39;root&#39;;
$pass = &#39;root&#39;;
$dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
try{
$pdo = new PDO($dsn, $user, $pass); // 初始化一个pdo对象，创建数据库连接对象$pdo
$query = &quot;select * from tb_pdo_mysqls&quot;; // 定义sql语句
$result = $pdo -&gt; query($query); // 执行查询语句
print_r($pdo-&gt;errorInfo());
foreach($result as $items){
?&gt;
&lt;tr&gt;
&lt;td&gt;&lt;?php echo $items[&#39;id&#39;];?&gt;&lt;/td&gt;
&lt;td&gt;&lt;?php echo $items[&#39;pdo_type&#39;];?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php
}
}catch(PDOException $e){
die(&quot;Error!:&quot;.$e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
}
?&gt;</code></code></pre>
<p>pdo中事务处理：</p>
<p>开启事务：beginTransaction()方法<br />
beginTransaction()方法将关闭自动提交autocommit模式，直到事务提交或者回滚以后才恢复</p>
<p>提交事务：commit()方法<br />
commit()方法完成事务的提交操作，成功返回true,否则为false</p>
<p>事务回滚：rollBack()方法<br />
通过prepare和execute()方法向数据库中添加数据，并且通过事务处理机制确保数据能够正确地添加到数据库中</p>
<p>通过beginTransaction()方法开启事务<br />
通过$_POST[] 方法获取表单中提交的数据<br />
通过prepare()和execute()方法向数据库中添加数据<br />
通过commit()方法完成事务的提交操作<br />
rollBack()方法执行事务的回滚操作</p>
<pre><code><code>&lt;?php
if($_POST[&#39;Submit&#39;]==&quot;提交&quot; &amp;&amp; $_POST[&#39;pdo&#39;]!=&quot;&quot;){
 $dbms = &#39;mysql&#39;; //数据库类型
 $host = &#39;localhost&#39;; // 数据库主机名
 $dbName = &#39;db_database&#39;&#39;; // 数据库
 $user=&#39;root&#39;;
 $pass=&#39;root&#39;;
 $dsn = &quot;$dbms:host=$host; dbname=$dbName&quot;;
 try{
 $pdo=new PDO($dsn, $user, $pass);
 $pdo -&gt; beginTransaction(); // 开启事务
 $query=&quot;insert into tb_pdo_mysql(pdo_type, database_name, dates) values (&quot;&quot;, $_POST[&#39;pdo&#39;].&quot;,&quot;.$_POST[&#39;databases&#39;].&quot;,&quot;.$_POST[&#39;dates&#39;].&quot;)&quot;;
  $result = $pdo-&gt;prepare($query);
 if($result-&gt;execute()){
  echo &quot;数据添加成功&quot;;
 }else{
  echo &quot;数据添加失败&quot;;
}
 $pdo-&gt;commit(); // 执行事务的提交操作
 }catch(PDOException $e){
 die(&quot;Error!:&quot;.$e-&gt;getMessage().&quot;&lt;br/&gt;&quot;);
 $pdo-&gt;rollBack();
 }
}
?&gt;</code></code></pre>
<blockquote>
<p>pdo中存储过程</p>
</blockquote>
<p>pdo中调用存储过程：</p>
<pre><code><code>drop procedure if exists pro_reg;
delimiter // 
create procedure pro_reg(in nc varchar(80), in pwd varchar(80), in email varchar(80), in address varchar(50))
begin
insert into ...
end;
// </code></code></pre>
<p>用户注册：用户昵称，注册密码，e-mail，家庭地址。</p>
<pre><code><code>&lt;title&gt;用户注册&lt;/title&gt;
&lt;form name=&quot;form1&quot; method=&quot;post&quot; action=&quot;index.php&quot;  onsubmit=&quot;return chkinput(this)&quot;&gt;

&lt;/form&gt;

&lt;?php
 if($_POST[&#39;submit&#39;]!=&quot;&quot;){
    $dbms=&#39;mysql&#39;;                      //数据库类型
    $host=&#39;localhost&#39;;                  //数据库主机名
    $dbName=&#39;db_database&#39;;          //使用的数据库
    $user=&#39;root&#39;;                       //数据库连接用户名
    $pass=&#39;root&#39;;                       //对应的密码
    $dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
    try {
        $pdo = new PDO($dsn, $user, $pass);     //初始化一个PDO对象
        $pdo-&gt;query(&quot;set names utf8&quot;);          //设置数据库编码格式
        $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);
        $nc=$_POST[&#39;nc&#39;];
        $pwd=md5($_POST[&#39;pwd&#39;]);
        $email=$_POST[&#39;email&#39;];
        $address=$_POST[&#39;address&#39;];
        $query=&quot;call pro_reg(&#39;$nc&#39;,&#39;$pwd&#39;,&#39;$email&#39;,&#39;$address&#39;)&quot;;//call调用存储过程
        $result=$pdo-&gt;prepare($query);
        if($result-&gt;execute()){
            echo &quot;数据添加成功！&quot;;
        }else{
            echo &quot;数据添加失败！&quot;;
        }
    } catch (PDOException $e) {
        echo &#39;PDO Exception Caught.&#39;;
        echo &#39;Error with the database:&lt;br/&gt;&#39;;
        echo  &#39;SQL Query: &#39;.$query;
        echo &#39;&lt;pre&gt;&#39;;
        echo &quot;Error: &quot; . $e-&gt;getMessage(). &quot;&lt;br/&gt;&quot;;     
        echo &quot;Code: &quot; . $e-&gt;getCode(). &quot;&lt;br/&gt;&quot;;
        echo &quot;File: &quot; . $e-&gt;getFile(). &quot;&lt;br/&gt;&quot;;
        echo &quot;Line: &quot; . $e-&gt;getLine(). &quot;&lt;br/&gt;&quot;;
        echo &quot;Trace: &quot; . $e-&gt;getTraceAsString(). &quot;&lt;br/&gt;&quot;;
        echo &#39;&lt;/pre&gt;&#39;;

    }
 }

?&gt;

&lt;script language=&quot;javascript&quot;&gt;
  function chkinput(form){
  
    if(form.nc.value==&quot;&quot;){
      alert(&quot;请输入用户昵称!&quot;);
      form.nc.select();
      return(false);
    }
   if(form.pwd.value==&quot;&quot;){
      alert(&quot;请输入注册密码!&quot;);
      form.pwd.select();
      return(false);
    }
     if(form.email.value==&quot;&quot;){
      alert(&quot;请输入E-mail地址!&quot;);
      form.email.select();
      return(false);
    }
    
    if(form.address.value==&quot;&quot;){
      alert(&quot;请输入家庭地址!&quot;);
      form.address.select();
      return(false);
    }
   return(true);
  }

&lt;/script&gt;</code></code></pre>
<pre><code><code>&lt;?php 
    header(&quot;Content-Type:text/html;charset=utf-8&quot;);
    $dbms=&#39;mysql&#39;;
    $dbName=&#39;db_database&#39;;
    $user=&#39;root&#39;;
    $pwd=&#39;root&#39;;
    $host=&#39;localhost&#39;;
    $dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
?&gt;

    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
    &lt;div&gt;
    &lt;span&gt;PDO插入数据&lt;/span&gt;&lt;br&gt;
        用户名：&lt;input class=&quot;one&quot; type=&quot;text&quot; name=&quot;text&quot; &gt;&lt;br&gt;
        密&amp;nbsp;&amp;nbsp;码：&lt;input class=&quot;one&quot;type=&quot;password&quot; name=&quot;pwd&quot;&gt;&lt;br&gt;
        &lt;input class=&quot;two&quot; type=&quot;submit&quot; name=&quot;sub&quot; value=&quot;确定&quot;&gt;
        &lt;input class=&quot;two&quot; type=&quot;reset&quot; name=&quot;res&quot; value=&quot;重置&quot;&gt;
&lt;?php
    if(isset($_POST[sub])){
        if($_POST[text]==&quot;&quot;&amp;&amp;$_POST[pwd]==&quot;&quot;){
            echo &quot;文本框内容不能为空&quot;;
        }else{
            try {
                $pdo=new PDO($dsn,$user,$pwd);
                $sql=&quot;insert into tb_pdo values(&#39;&#39;,&#39;$_POST[text]&#39;,&#39;$_POST[pwd]&#39;,now())&quot;;
                $result=$pdo-&gt;exec($sql);
                echo &quot;插入数据成功，影响条数为&quot;.$result;
            } catch (Exception $e) {
                echo &quot;ERROR!!&quot;.$e-&gt;getMessage().&quot;&lt;br&gt;&quot;;
            }       
        }
    }
?&gt;
    &lt;/div&gt;
    &lt;/form&gt; </code></code></pre>
<pre><code><code>&lt;form action=&#39;&#39;method=&quot;post&quot;&gt;
&lt;?php 
        }
        if(isset($_GET[id])){
            $sql1=&quot;select * from tb_pdo where id=&#39;$_GET[id]&#39;&quot;;
            $resul=$pdo-&gt;query($sql1);
                foreach ($resul as $value){
                    
                
?&gt;
    &lt;tr&gt;
            &lt;td class=&quot;one&quot;&gt;&lt;input readonly type=&#39;text&#39; name=&#39;id&#39; value=&#39;&lt;?php echo $value[id];?&gt;&#39;&gt;&lt;/td&gt;
            &lt;td class=&quot;one&quot;&gt;&lt;input type=&#39;text&#39; name=&#39;user&#39; value=&#39;&lt;?php echo $value[1];?&gt;&#39;&gt;&lt;/td&gt;
            &lt;td class=&quot;one&quot;&gt;&lt;input type=&#39;password&#39; name=&#39;pwd&#39; value=&#39;&lt;?php echo $value[2];?&gt;&#39;&gt;&lt;/td&gt;
            &lt;td class=&quot;one&quot;&gt;&lt;input type=&#39;text&#39; name=&#39;date&#39; value=&#39;&lt;?php echo $value[3];?&gt;&#39;&gt;&lt;/td&gt;
            &lt;td class=&quot;one&quot;&gt;&lt;input class=&quot;two&quot; type=&#39;submit&#39; name=&#39;sub1&#39; value=&#39;确定&#39;&gt;&lt;/td&gt;
    &lt;/tr&gt;
    
&lt;?php 
            }
        }
?&gt;
    &lt;/form&gt;
&lt;?php 
        if($_POST[sub1]==&quot;确定&quot;){
            $sql2=&quot;update tb_pdo set username=&#39;$_POST[user]&#39;,userpwd=&#39;$_POST[pwd]&#39;,date=&#39;$_POST[date]&#39; where id=&#39;$_POST[id]&#39;&quot;;
            $resu=$pdo-&gt;exec($sql2);
            if($resu==1){
                echo &quot;&lt;script&gt;alert(&#39;更新数据成功&#39;);window.location.href=&#39;index.php&#39;&lt;/script&gt;&quot;;
            }   
        }   
    } catch (Exception $e) {
        echo &quot;ERROR!!!&quot;.$e-&gt;getMessage().&quot;&lt;br&gt;&quot;;
    }
?&gt;</code></code></pre>
<h2 id="结言">结言</h2>
<p>好了，欢迎在留言区留言，与大家分享你的经验和心得。</p>
<p>感谢你学习今天的内容，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友，感谢。</p>
<p>感谢！承蒙关照！您真诚的赞赏是我前进的最大动力！</p>
<p><img src="//upload-images.jianshu.io/upload_images/11158618-da750878d19e7fa1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image" /></p>
<p><img src="//upload-images.jianshu.io/upload_images/11158618-826395d4148483a1?imageMogr2/auto-orient/strip" alt="image" /></p>


</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
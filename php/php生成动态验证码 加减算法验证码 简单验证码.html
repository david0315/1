<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修php生成动态验证码 加减算法验证码 简单验证码' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>php生成动态验证码 加减算法验证码 简单验证码</center></div><div class='banquan'>原文出处:本文由博客园博主穷帅哥依然纵横一方提供。<br/>
原文连接:https://www.cnblogs.com/yx520zhao/p/11646600.html</div><br>
    <p>预览效果： <img src="./images/php生成动态验证码 加减算法验证码 简单验证码0.jpg" alt="" /></p>
<src class="cnblogs_code">
<pre><code>&lt;?<span style="color: #000000;">php
</span><span style="color: #008000;">/*</span><span style="color: #008000;">*
*ImageCode 生成包含验证码的GIF图片的函数
*@param $string 字符串
*@param $width 宽度
*@param $height 高度
*</span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">function</span> ImageCode(<span style="color: #800080;">$string</span>='',<span style="color: #800080;">$width</span>=75,<span style="color: #800080;">$height</span>=25<span style="color: #000000;">){
    </span><span style="color: #800080;">$authstr</span>=<span style="color: #800080;">$string</span>?<span style="color: #800080;">$string</span>:((<span style="color: #008080;">time</span>()%2==0)?<span style="color: #008080;">mt_rand</span>(1000,9999):<span style="color: #008080;">mt_rand</span>(10000,99999<span style="color: #000000;">));
    </span><span style="color: #800080;">$board_width</span>=<span style="color: #800080;">$width</span><span style="color: #000000;">;
    </span><span style="color: #800080;">$board_height</span>=<span style="color: #800080;">$height</span><span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 生成一个32帧的GIF动画</span>
    <span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0;<span style="color: #800080;">$i</span>&lt;32;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
        </span><span style="color: #008080;">ob_start</span><span style="color: #000000;">();
        </span><span style="color: #800080;">$image</span>=imagecreate(<span style="color: #800080;">$board_width</span>,<span style="color: #800080;">$board_height</span><span style="color: #000000;">);
        imagecolorallocate(</span><span style="color: #800080;">$image</span>,0,0,0<span style="color: #000000;">);
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 设定文字颜色数组 </span>
         <span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,15,73,210<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,64,0<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,64<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,128,128<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,27,52,47<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,51,0,102<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,145<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,113<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,51,51<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,158,180,35<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,59,59,59<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,0<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,1,128,180<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,153,51<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,60,131,1<span style="color: #000000;">);
         </span><span style="color: #800080;">$colorList</span>[]=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,0<span style="color: #000000;">);
         </span><span style="color: #800080;">$fontcolor</span>=ImageColorAllocate(<span style="color: #800080;">$image</span>,0,0,0<span style="color: #000000;">);
         </span><span style="color: #800080;">$gray</span>=ImageColorAllocate(<span style="color: #800080;">$image</span>,245,245,245<span style="color: #000000;">);
        </span><span style="color: #800080;">$color</span>=imagecolorallocate(<span style="color: #800080;">$image</span>,255,255,255<span style="color: #000000;">);
        </span><span style="color: #800080;">$color2</span>=imagecolorallocate(<span style="color: #800080;">$image</span>,255,0,0<span style="color: #000000;">);
        imagefill(</span><span style="color: #800080;">$image</span>,0,0,<span style="color: #800080;">$gray</span><span style="color: #000000;">);
        </span><span style="color: #800080;">$space</span>=15;<span style="color: #008000;">//</span><span style="color: #008000;"> 字符间距</span>
        <span style="color: #0000ff;">if</span>(<span style="color: #800080;">$i</span>&gt;0){<span style="color: #008000;">//</span><span style="color: #008000;"> 屏蔽第一帧</span>
            <span style="color: #800080;">$top</span>=0<span style="color: #000000;">;
            </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$k</span>=0;<span style="color: #800080;">$k</span>&lt;<span style="color: #008080;">strlen</span>(<span style="color: #800080;">$authstr</span>);<span style="color: #800080;">$k</span>++<span style="color: #000000;">){ 
                </span><span style="color: #800080;">$colorRandom</span>=<span style="color: #008080;">mt_rand</span>(0,<span style="color: #008080;">sizeof</span>(<span style="color: #800080;">$colorList</span>)-1<span style="color: #000000;">);
                </span><span style="color: #800080;">$float_top</span>=<span style="color: #008080;">rand</span>(0,4<span style="color: #000000;">);
                </span><span style="color: #800080;">$float_left</span>=<span style="color: #008080;">rand</span>(0,3<span style="color: #000000;">);
                imagestring(</span><span style="color: #800080;">$image</span>,6,<span style="color: #800080;">$space</span>*<span style="color: #800080;">$k</span>,<span style="color: #800080;">$top</span>+<span style="color: #800080;">$float_top</span>,<span style="color: #008080;">substr</span>(<span style="color: #800080;">$authstr</span>,<span style="color: #800080;">$k</span>,1),<span style="color: #800080;">$colorList</span>[<span style="color: #800080;">$colorRandom</span><span style="color: #000000;">]);
            }
       }
        </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$k</span>=0;<span style="color: #800080;">$k</span>&lt;20;<span style="color: #800080;">$k</span>++<span style="color: #000000;">){ 
            </span><span style="color: #800080;">$colorRandom</span>=<span style="color: #008080;">mt_rand</span>(0,<span style="color: #008080;">sizeof</span>(<span style="color: #800080;">$colorList</span>)-1<span style="color: #000000;">);
             imagesetpixel(</span><span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>()%70,<span style="color: #008080;">rand</span>()%15,<span style="color: #800080;">$colorList</span>[<span style="color: #800080;">$colorRandom</span><span style="color: #000000;">]);
    
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 添加干扰线</span>
        <span style="color: #0000ff;">for</span>(<span style="color: #800080;">$k</span>=0;<span style="color: #800080;">$k</span>&lt;3;<span style="color: #800080;">$k</span>++<span style="color: #000000;">){
            </span><span style="color: #800080;">$colorRandom</span>=<span style="color: #008080;">mt_rand</span>(0,<span style="color: #008080;">sizeof</span>(<span style="color: #800080;">$colorList</span>)-1<span style="color: #000000;">);
            </span><span style="color: #800080;">$todrawline</span>=1<span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span>(<span style="color: #800080;">$todrawline</span><span style="color: #000000;">){
                imageline(</span><span style="color: #800080;">$image</span>,<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_width</span>),<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_height</span>),<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_width</span>),<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_height</span>),<span style="color: #800080;">$colorList</span>[<span style="color: #800080;">$colorRandom</span><span style="color: #000000;">]);
            }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
                </span><span style="color: #800080;">$w</span>=<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_width</span><span style="color: #000000;">);
                </span><span style="color: #800080;">$h</span>=<span style="color: #008080;">mt_rand</span>(0,<span style="color: #800080;">$board_width</span><span style="color: #000000;">);
                imagearc(</span><span style="color: #800080;">$image</span>,<span style="color: #800080;">$board_width</span>-<span style="color: #008080;">floor</span>(<span style="color: #800080;">$w</span> / 2),<span style="color: #008080;">floor</span>(<span style="color: #800080;">$h</span> / 2),<span style="color: #800080;">$w</span>,<span style="color: #800080;">$h</span>, <span style="color: #008080;">rand</span>(90,180),<span style="color: #008080;">rand</span>(180,270),<span style="color: #800080;">$colorList</span>[<span style="color: #800080;">$colorRandom</span><span style="color: #000000;">]);
            }
        }
        imagegif(</span><span style="color: #800080;">$image</span><span style="color: #000000;">);
        imagedestroy(</span><span style="color: #800080;">$image</span><span style="color: #000000;">);
        </span><span style="color: #800080;">$imagedata</span>[]=<span style="color: #008080;">ob_get_contents</span><span style="color: #000000;">();
        </span><span style="color: #008080;">ob_clean</span><span style="color: #000000;">();
        </span>++<span style="color: #800080;">$i</span><span style="color: #000000;">;
    }
    </span><span style="color: #800080;">$gif</span>=<span style="color: #0000ff;">new</span> GIFEncoder(<span style="color: #800080;">$imagedata</span><span style="color: #000000;">);
    </span><span style="color: #008080;">Header</span>('Content-type:image/gif'<span style="color: #000000;">);
    </span><span style="color: #0000ff;">echo</span> <span style="color: #800080;">$gif</span>-&gt;<span style="color: #000000;">GetAnimation();
}


</span><span style="color: #008000;">/*</span><span style="color: #008000;">*
*GIFEncoder类
*</span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">Class</span><span style="color: #000000;"> GIFEncoder{
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$GIF</span>="GIF89a";              <span style="color: #008000;">/*</span><span style="color: #008000;"> GIF header 6 bytes       </span><span style="color: #008000;">*/</span>  
    <span style="color: #0000ff;">var</span> <span style="color: #800080;">$VER</span>="GIFEncoder V2.06";      <span style="color: #008000;">/*</span><span style="color: #008000;"> Encoder version            </span><span style="color: #008000;">*/</span>  
    <span style="color: #0000ff;">var</span> <span style="color: #800080;">$BUF</span>=<span style="color: #0000ff;">Array</span><span style="color: #000000;">();
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$LOP</span>=0<span style="color: #000000;">;
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$DIS</span>=2<span style="color: #000000;">;
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$COL</span>=-1<span style="color: #000000;">;
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$IMG</span>=-1<span style="color: #000000;">;
    </span><span style="color: #0000ff;">var</span> <span style="color: #800080;">$ERR</span>=<span style="color: #0000ff;">Array</span><span style="color: #000000;">(
        </span>'ERR00'=&gt;"Does not supported function for only one image!", 
        'ERR01'=&gt;"Source is not a GIF image!", 
        'ERR02'=&gt;"Unintelligible flag ", 
        'ERR03'=&gt;"Could not make animation from animated GIF source",<span style="color: #000000;"> 
   );
    </span><span style="color: #0000ff;">function</span> GIFEncoder(<span style="color: #800080;">$GIF_src</span>,<span style="color: #800080;">$GIF_dly</span>=100,<span style="color: #800080;">$GIF_lop</span>=0,<span style="color: #800080;">$GIF_dis</span>=0, <span style="color: #800080;">$GIF_red</span>=0,<span style="color: #800080;">$GIF_grn</span>=0,<span style="color: #800080;">$GIF_blu</span>=0,<span style="color: #800080;">$GIF_mod</span>='bin'<span style="color: #000000;">){
        </span><span style="color: #0000ff;">if</span>(!<span style="color: #008080;">is_array</span>(<span style="color: #800080;">$GIF_src</span>)&amp;&amp;!<span style="color: #008080;">is_array</span>(<span style="color: #800080;">$GIF_tim</span><span style="color: #000000;">)){
            </span><span style="color: #008080;">printf</span>("%s: %s",<span style="color: #800080;">$this</span>-&gt;VER,<span style="color: #800080;">$this</span>-&gt;ERR['ERR00'<span style="color: #000000;">]);
            </span><span style="color: #0000ff;">exit</span>(0<span style="color: #000000;">);
        }  
        </span><span style="color: #800080;">$this</span>-&gt;LOP=(<span style="color: #800080;">$GIF_lop</span>&gt;-1)?<span style="color: #800080;">$GIF_lop</span>:0<span style="color: #000000;">;
        </span><span style="color: #800080;">$this</span>-&gt;DIS=(<span style="color: #800080;">$GIF_dis</span>&gt;-1)?((<span style="color: #800080;">$GIF_dis</span>&lt;3)?<span style="color: #800080;">$GIF_dis</span>:3):2<span style="color: #000000;">;
        </span><span style="color: #800080;">$this</span>-&gt;COL=(<span style="color: #800080;">$GIF_red</span>&gt;-1&amp;&amp;<span style="color: #800080;">$GIF_grn</span>&gt;-1&amp;&amp;<span style="color: #800080;">$GIF_blu</span>&gt;-1)?(<span style="color: #800080;">$GIF_red</span> |(<span style="color: #800080;">$GIF_grn</span>&lt;&lt;8)|(<span style="color: #800080;">$GIF_blu</span>&lt;&lt;16)):-1<span style="color: #000000;">;

        </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0,<span style="color: #800080;">$src_count</span>=<span style="color: #008080;">count</span>(<span style="color: #800080;">$GIF_src</span>);<span style="color: #800080;">$i</span>&lt;<span style="color: #800080;">$src_count</span>;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
            </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">strToLower</span>(<span style="color: #800080;">$GIF_mod</span>)=="url"<span style="color: #000000;">){
                </span><span style="color: #800080;">$this</span>-&gt;BUF[]=<span style="color: #008080;">fread</span>(<span style="color: #008080;">fopen</span>(<span style="color: #800080;">$GIF_src</span> [<span style="color: #800080;">$i</span>],"rb"),<span style="color: #008080;">filesize</span>(<span style="color: #800080;">$GIF_src</span> [<span style="color: #800080;">$i</span><span style="color: #000000;">]));
           }</span><span style="color: #0000ff;">elseif</span>(<span style="color: #008080;">strToLower</span>(<span style="color: #800080;">$GIF_mod</span>)=="bin"<span style="color: #000000;">){
                </span><span style="color: #800080;">$this</span>-&gt;BUF [ ]=<span style="color: #800080;">$GIF_src</span> [ <span style="color: #800080;">$i</span><span style="color: #000000;"> ];
           }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
                </span><span style="color: #008080;">printf</span>("%s: %s(%s)!",<span style="color: #800080;">$this</span>-&gt;VER,<span style="color: #800080;">$this</span>-&gt;ERR [ 'ERR02' ],<span style="color: #800080;">$GIF_mod</span><span style="color: #000000;">);
                </span><span style="color: #0000ff;">exit</span>(0<span style="color: #000000;">);
           }  
            </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>],0,6)!="GIF87a"&amp;&amp;<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF [<span style="color: #800080;">$i</span>],0,6)!="GIF89a"<span style="color: #000000;">){
                </span><span style="color: #008080;">printf</span>("%s: %d %s",<span style="color: #800080;">$this</span>-&gt;VER,<span style="color: #800080;">$i</span>,<span style="color: #800080;">$this</span>-&gt;ERR ['ERR01'<span style="color: #000000;">]);
                </span><span style="color: #0000ff;">exit</span>(0<span style="color: #000000;">);
           }  
            </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$j</span>=(13+3*(2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07))),<span style="color: #800080;">$k</span>=<span style="color: #0000ff;">TRUE</span>;<span style="color: #800080;">$k</span>;<span style="color: #800080;">$j</span>++<span style="color: #000000;">){
                </span><span style="color: #0000ff;">switch</span>(<span style="color: #800080;">$this</span>-&gt;BUF [<span style="color: #800080;">$i</span>]{<span style="color: #800080;">$j</span><span style="color: #000000;">}){
                    </span><span style="color: #0000ff;">case</span> "!":  
                        <span style="color: #0000ff;">if</span>((<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>],(<span style="color: #800080;">$j</span>+3),8))=="NETSCAPE"<span style="color: #000000;">){
                                </span><span style="color: #008080;">printf</span>("%s: %s(%s source)!",<span style="color: #800080;">$this</span>-&gt;VER,<span style="color: #800080;">$this</span>-&gt;ERR ['ERR03'],(<span style="color: #800080;">$i</span>+1<span style="color: #000000;">));
                                </span><span style="color: #0000ff;">exit</span>(0<span style="color: #000000;">);
                       }  
                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                    </span><span style="color: #0000ff;">case</span> ";":  
                        <span style="color: #800080;">$k</span>=<span style="color: #0000ff;">FALSE</span><span style="color: #000000;">;
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
               }  
           }  
        }  
        GIFEncoder</span>::<span style="color: #000000;">GIFAddHeader();
        </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0,<span style="color: #800080;">$count_buf</span>=<span style="color: #008080;">count</span>(<span style="color: #800080;">$this</span>-&gt;BUF);<span style="color: #800080;">$i</span>&lt;<span style="color: #800080;">$count_buf</span>;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
            GIFEncoder</span>::GIFAddFrames(<span style="color: #800080;">$i</span>,<span style="color: #800080;">$GIF_dly</span>[<span style="color: #800080;">$i</span><span style="color: #000000;">]);
       }  
        GIFEncoder</span>::<span style="color: #000000;">GIFAddFooter();
    }  
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> GIFAddHeader(){
        </span><span style="color: #800080;">$cmap</span>=0<span style="color: #000000;">;
        </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[0]{10})&amp;0x80<span style="color: #000000;">){
            </span><span style="color: #800080;">$cmap</span>=3*(2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF [0]{10})&amp;0x07<span style="color: #000000;">));
            </span><span style="color: #800080;">$this</span>-&gt;GIF.=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF [0],6,7<span style="color: #000000;">);
            </span><span style="color: #800080;">$this</span>-&gt;GIF.=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF [0],13,<span style="color: #800080;">$cmap</span><span style="color: #000000;">);
            </span><span style="color: #800080;">$this</span>-&gt;GIF.="!\377\13NETSCAPE2.0\3\1".GIFEncoder::GIFWord(<span style="color: #800080;">$this</span>-&gt;LOP)."\0"<span style="color: #000000;">;
        }  
    }  
    </span><span style="color: #0000ff;">function</span> GIFAddFrames(<span style="color: #800080;">$i</span>,<span style="color: #800080;">$d</span><span style="color: #000000;">){
        </span><span style="color: #800080;">$Locals_str</span>=13+3*(2 &lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07<span style="color: #000000;">));
        </span><span style="color: #800080;">$Locals_end</span>=<span style="color: #008080;">strlen</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>])-<span style="color: #800080;">$Locals_str</span>-1<span style="color: #000000;">;
        </span><span style="color: #800080;">$Locals_tmp</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>],<span style="color: #800080;">$Locals_str</span>,<span style="color: #800080;">$Locals_end</span><span style="color: #000000;">);
        </span><span style="color: #800080;">$Global_len</span>=2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF [0]{10})&amp;0x07<span style="color: #000000;">);
        </span><span style="color: #800080;">$Locals_len</span>=2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07<span style="color: #000000;">);
        </span><span style="color: #800080;">$Global_rgb</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF[0],13,3*(2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[0]{10})&amp;0x07<span style="color: #000000;">)));
        </span><span style="color: #800080;">$Locals_rgb</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>],13,3*(2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07<span style="color: #000000;">)));
        </span><span style="color: #800080;">$Locals_ext</span>="!\xF9\x04".<span style="color: #008080;">chr</span>((<span style="color: #800080;">$this</span>-&gt;DIS&lt;&lt;2)+0).<span style="color: #008080;">chr</span>((<span style="color: #800080;">$d</span>&gt;&gt;0)&amp;0xFF).<span style="color: #008080;">chr</span>((<span style="color: #800080;">$d</span>&gt;&gt;8)&amp;0xFF)."\x0\x0"<span style="color: #000000;">;
        </span><span style="color: #0000ff;">if</span>(<span style="color: #800080;">$this</span>-&gt;COL&gt;-1&amp;&amp;<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x80<span style="color: #000000;">){
            </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$j</span>=0;<span style="color: #800080;">$j</span>&lt;(2&lt;&lt;(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07));<span style="color: #800080;">$j</span>++<span style="color: #000000;">){
                </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$Locals_rgb</span>{3*<span style="color: #800080;">$j</span>+0})==(<span style="color: #800080;">$this</span>-&gt;COL&gt;&gt; 0)&amp;0xFF&amp;&amp;<span style="color: #008080;">ord</span>(<span style="color: #800080;">$Locals_rgb</span>{3*<span style="color: #800080;">$j</span>+1})==(<span style="color: #800080;">$this</span>-&gt;COL&gt;&gt; 8)&amp;0xFF&amp;&amp;<span style="color: #008080;">ord</span>(<span style="color: #800080;">$Locals_rgb</span>{3*<span style="color: #800080;">$j</span>+2})==(<span style="color: #800080;">$this</span>-&gt;COL&gt;&gt;16)&amp;0xFF<span style="color: #000000;">){
                    </span><span style="color: #800080;">$Locals_ext</span>="!\xF9\x04".<span style="color: #008080;">chr</span>((<span style="color: #800080;">$this</span>-&gt;DIS&lt;&lt;2)+1).<span style="color: #008080;">chr</span>((<span style="color: #800080;">$d</span>&gt;&gt;0)&amp;0xFF).<span style="color: #008080;">chr</span>((<span style="color: #800080;">$d</span>&gt;&gt;8)&amp;0xFF).<span style="color: #008080;">chr</span>(<span style="color: #800080;">$j</span>)."\x0"<span style="color: #000000;">;
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
               }  
           }  
        }  
        </span><span style="color: #0000ff;">switch</span>(<span style="color: #800080;">$Locals_tmp</span>{0<span style="color: #000000;">}){
            </span><span style="color: #0000ff;">case</span> "!":  
                <span style="color: #800080;">$Locals_img</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$Locals_tmp</span>,8,10<span style="color: #000000;">);
                </span><span style="color: #800080;">$Locals_tmp</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$Locals_tmp</span>,18,<span style="color: #008080;">strlen</span>(<span style="color: #800080;">$Locals_tmp</span>)-18<span style="color: #000000;">);
                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">case</span> ",":  
                <span style="color: #800080;">$Locals_img</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$Locals_tmp</span>,0,10<span style="color: #000000;">);
                </span><span style="color: #800080;">$Locals_tmp</span>=<span style="color: #008080;">substr</span>(<span style="color: #800080;">$Locals_tmp</span>,10,<span style="color: #008080;">strlen</span>(<span style="color: #800080;">$Locals_tmp</span>)-10<span style="color: #000000;">);
                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
        }  
        </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x80&amp;&amp;<span style="color: #800080;">$this</span>-&gt;IMG&gt;-1<span style="color: #000000;">){
            </span><span style="color: #0000ff;">if</span>(<span style="color: #800080;">$Global_len</span>==<span style="color: #800080;">$Locals_len</span><span style="color: #000000;">){
                </span><span style="color: #0000ff;">if</span>(GIFEncoder::GIFBlockCompare(<span style="color: #800080;">$Global_rgb</span>,<span style="color: #800080;">$Locals_rgb</span>,<span style="color: #800080;">$Global_len</span><span style="color: #000000;">)){
                    </span><span style="color: #800080;">$this</span>-&gt;GIF.=(<span style="color: #800080;">$Locals_ext</span>.<span style="color: #800080;">$Locals_img</span>.<span style="color: #800080;">$Locals_tmp</span><span style="color: #000000;">);
                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
                    </span><span style="color: #800080;">$byte</span>=<span style="color: #008080;">ord</span>(<span style="color: #800080;">$Locals_img</span>{9<span style="color: #000000;">});
                    </span><span style="color: #800080;">$byte</span>|=0x80<span style="color: #000000;">;
                    </span><span style="color: #800080;">$byte</span>&amp;=0xF8<span style="color: #000000;">;
                    </span><span style="color: #800080;">$byte</span>|=(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF [0]{10})&amp;0x07<span style="color: #000000;">);
                    </span><span style="color: #800080;">$Locals_img</span>{9}=<span style="color: #008080;">chr</span>(<span style="color: #800080;">$byte</span><span style="color: #000000;">);
                    </span><span style="color: #800080;">$this</span>-&gt;GIF.=(<span style="color: #800080;">$Locals_ext</span>.<span style="color: #800080;">$Locals_img</span>.<span style="color: #800080;">$Locals_rgb</span>.<span style="color: #800080;">$Locals_tmp</span><span style="color: #000000;">);
                }  
            }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
                </span><span style="color: #800080;">$byte</span>=<span style="color: #008080;">ord</span>(<span style="color: #800080;">$Locals_img</span>{9<span style="color: #000000;">});
                </span><span style="color: #800080;">$byte</span>|=0x80<span style="color: #000000;">;
                </span><span style="color: #800080;">$byte</span>&amp;=0xF8<span style="color: #000000;">;
                </span><span style="color: #800080;">$byte</span>|=(<span style="color: #008080;">ord</span>(<span style="color: #800080;">$this</span>-&gt;BUF[<span style="color: #800080;">$i</span>]{10})&amp;0x07<span style="color: #000000;">);
                </span><span style="color: #800080;">$Locals_img</span> {9}=<span style="color: #008080;">chr</span>(<span style="color: #800080;">$byte</span><span style="color: #000000;">);
                </span><span style="color: #800080;">$this</span>-&gt;GIF.=(<span style="color: #800080;">$Locals_ext</span>.<span style="color: #800080;">$Locals_img</span>.<span style="color: #800080;">$Locals_rgb</span>.<span style="color: #800080;">$Locals_tmp</span><span style="color: #000000;">);
            }  
        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
            </span><span style="color: #800080;">$this</span>-&gt;GIF.=(<span style="color: #800080;">$Locals_ext</span>.<span style="color: #800080;">$Locals_img</span>.<span style="color: #800080;">$Locals_tmp</span><span style="color: #000000;">);
        }  
        </span><span style="color: #800080;">$this</span>-&gt;IMG=1<span style="color: #000000;">;
    }  
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> GIFAddFooter(){
        </span><span style="color: #800080;">$this</span>-&gt;GIF.=";"<span style="color: #000000;">;
    }  
    </span><span style="color: #0000ff;">function</span> GIFBlockCompare(<span style="color: #800080;">$GlobalBlock</span>,<span style="color: #800080;">$LocalBlock</span>,<span style="color: #800080;">$Len</span><span style="color: #000000;">){
        </span><span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0;<span style="color: #800080;">$i</span>&lt;<span style="color: #800080;">$Len</span>;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
            </span><span style="color: #0000ff;">if</span>(<span style="color: #800080;">$GlobalBlock</span>{3*<span style="color: #800080;">$i</span>+0}!=<span style="color: #800080;">$LocalBlock</span>{3*<span style="color: #800080;">$i</span>+0}||<span style="color: #800080;">$GlobalBlock</span>{3*<span style="color: #800080;">$i</span>+1}!=<span style="color: #800080;">$LocalBlock</span>{3*<span style="color: #800080;">$i</span>+1}||<span style="color: #800080;">$GlobalBlock</span>{3*<span style="color: #800080;">$i</span>+2}!=<span style="color: #800080;">$LocalBlock</span>{3*<span style="color: #800080;">$i</span>+2<span style="color: #000000;">}){
                </span><span style="color: #0000ff;">return</span>(0<span style="color: #000000;">);
           }  
       }  
        </span><span style="color: #0000ff;">return</span>(1<span style="color: #000000;">);
    }  
    </span><span style="color: #0000ff;">function</span> GIFWord(<span style="color: #800080;">$int</span><span style="color: #000000;">){
       </span><span style="color: #0000ff;">return</span>(<span style="color: #008080;">chr</span>(<span style="color: #800080;">$int</span>&amp;0xFF).<span style="color: #008080;">chr</span>((<span style="color: #800080;">$int</span>&gt;&gt;8)&amp;0xFF<span style="color: #000000;">));
    }  
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> GetAnimation(){
        </span><span style="color: #0000ff;">return</span>(<span style="color: #800080;">$this</span>-&gt;<span style="color: #000000;">GIF);
    }  
}</span></code></pre>

<p>加减验证：<img src="./images/php生成动态验证码 加减算法验证码 简单验证码1.jpg" alt="" /></p>
<src class="cnblogs_code">
<pre><code>&lt;?<span style="color: #000000;">php
namespace mobile\components;
</span><span style="color: #008000;">/*</span><span style="color: #008000;">* 
 * @author fenghuo 
 * 
 * 改造的加减法验证类 
 * 使用示例 VerifyCode::get(1,2); 
 * 验证示例 VerifyCode::check($code); 
 </span><span style="color: #008000;">*/</span> 
<span style="color: #0000ff;">class</span><span style="color: #000000;"> VerifyCode 
{ 
  </span><span style="color: #008000;">/*</span><span style="color: #008000;">* 
   * php验证码 
   </span><span style="color: #008000;">*/</span> 
  <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">function</span> get(<span style="color: #800080;">$one</span>,<span style="color: #800080;">$two</span>,<span style="color: #800080;">$prefix</span> = '', <span style="color: #800080;">$font_size</span> = 28<span style="color: #000000;">) 
  { 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">文件头... </span>
    <span style="color: #008080;">ob_get_clean</span><span style="color: #000000;">();
    </span><span style="color: #008080;">header</span>("Content-type: image/png;charset=utf-8;"<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">创建真彩色白纸 </span>
    <span style="color: #800080;">$width</span>      = <span style="color: #800080;">$font_size</span>*5<span style="color: #000000;">; 
    </span><span style="color: #800080;">$height</span>      = <span style="color: #800080;">$font_size</span>+1<span style="color: #000000;">; 
    </span><span style="color: #800080;">$im</span>        = @imagecreatetruecolor(<span style="color: #800080;">$width</span>, <span style="color: #800080;">$height</span>) or <span style="color: #0000ff;">die</span>("建立图像失败"<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取背景颜色 </span>
    <span style="color: #800080;">$background_color</span> = imagecolorallocate(<span style="color: #800080;">$im</span>, 255, 255, 255<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">填充背景颜色 </span>
    imagefill(<span style="color: #800080;">$im</span>, 0, 0, <span style="color: #800080;">$background_color</span><span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取边框颜色 </span>
    <span style="color: #800080;">$border_color</span>   = imagecolorallocate(<span style="color: #800080;">$im</span>, 200, 200, 200<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">画矩形，边框颜色200,200,200 </span>
    imagerectangle(<span style="color: #800080;">$im</span>,0,0,<span style="color: #800080;">$width</span> - 1, <span style="color: #800080;">$height</span> - 1,<span style="color: #800080;">$border_color</span><span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">逐行炫耀背景，全屏用1或0 </span>
    <span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span> = 2;<span style="color: #800080;">$i</span> &lt; <span style="color: #800080;">$height</span> - 2;<span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
      </span><span style="color: #008000;">//</span><span style="color: #008000;">获取随机淡色 </span>
      <span style="color: #800080;">$line_color</span> = imagecolorallocate(<span style="color: #800080;">$im</span>, <span style="color: #008080;">rand</span>(200,255), <span style="color: #008080;">rand</span>(200,255), <span style="color: #008080;">rand</span>(200,255<span style="color: #000000;">)); 
      </span><span style="color: #008000;">//</span><span style="color: #008000;">画线 </span>
      imageline(<span style="color: #800080;">$im</span>, 2, <span style="color: #800080;">$i</span>, <span style="color: #800080;">$width</span> - 1, <span style="color: #800080;">$i</span>, <span style="color: #800080;">$line_color</span><span style="color: #000000;">); 
    } 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">设置印上去的文字 </span>
    <span style="color: #800080;">$firstNum</span> = <span style="color: #800080;">$one</span><span style="color: #000000;">; 
    </span><span style="color: #800080;">$secondNum</span> = <span style="color: #800080;">$two</span><span style="color: #000000;">; 
    </span><span style="color: #800080;">$actionStr</span> = <span style="color: #800080;">$firstNum</span> &gt; <span style="color: #800080;">$secondNum</span> ? '-' : '+'<span style="color: #000000;">; 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取第1个随机文字 </span>
    <span style="color: #800080;">$imstr</span>[0]["s"] = <span style="color: #800080;">$firstNum</span><span style="color: #000000;">; 
    </span><span style="color: #800080;">$imstr</span>[0]["x"] = <span style="color: #008080;">rand</span>(2, 5<span style="color: #000000;">); 
    </span><span style="color: #800080;">$imstr</span>[0]["y"] = <span style="color: #008080;">rand</span>(1, 4<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取第2个随机文字 </span>
    <span style="color: #800080;">$imstr</span>[1]["s"] = <span style="color: #800080;">$actionStr</span><span style="color: #000000;">; 
    </span><span style="color: #800080;">$imstr</span>[1]["x"] = <span style="color: #800080;">$imstr</span>[0]["x"] + <span style="color: #800080;">$font_size</span> - 1 + <span style="color: #008080;">rand</span>(0, 1<span style="color: #000000;">); 
    </span><span style="color: #800080;">$imstr</span>[1]["y"] = <span style="color: #008080;">rand</span>(1,5<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取第3个随机文字 </span>
    <span style="color: #800080;">$imstr</span>[2]["s"] = <span style="color: #800080;">$secondNum</span><span style="color: #000000;">; 
    </span><span style="color: #800080;">$imstr</span>[2]["x"] = <span style="color: #800080;">$imstr</span>[1]["x"] + <span style="color: #800080;">$font_size</span> - 1 + <span style="color: #008080;">rand</span>(0, 1<span style="color: #000000;">); 
    </span><span style="color: #800080;">$imstr</span>[2]["y"] = <span style="color: #008080;">rand</span>(1, 5<span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取第3个随机文字 </span>
    <span style="color: #800080;">$imstr</span>[3]["s"] = '='<span style="color: #000000;">; 
    </span><span style="color: #800080;">$imstr</span>[3]["x"] = <span style="color: #800080;">$imstr</span>[2]["x"] + <span style="color: #800080;">$font_size</span> - 1 + <span style="color: #008080;">rand</span>(0, 1<span style="color: #000000;">); 
    </span><span style="color: #800080;">$imstr</span>[3]["y"] = 3<span style="color: #000000;">; 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取第3个随机文字 </span>
    <span style="color: #800080;">$imstr</span>[4]["s"] = '?'<span style="color: #000000;">; 
    </span><span style="color: #800080;">$imstr</span>[4]["x"] = <span style="color: #800080;">$imstr</span>[3]["x"] + <span style="color: #800080;">$font_size</span> - 1 + <span style="color: #008080;">rand</span>(0, 1<span style="color: #000000;">); 
    </span><span style="color: #800080;">$imstr</span>[4]["y"] = 3<span style="color: #000000;">; 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">文字 </span>
    <span style="color: #800080;">$text</span> = ''<span style="color: #000000;">; 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">写入随机字串 </span>
    <span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span> = 0; <span style="color: #800080;">$i</span> &lt; 5; <span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
      </span><span style="color: #008000;">//</span><span style="color: #008000;">获取随机较深颜色 </span>
      <span style="color: #800080;">$text_color</span> = imagecolorallocate(<span style="color: #800080;">$im</span>, <span style="color: #008080;">rand</span>(50, 180), <span style="color: #008080;">rand</span>(50, 180), <span style="color: #008080;">rand</span>(50, 180<span style="color: #000000;">)); 
      </span><span style="color: #800080;">$text</span> .= <span style="color: #800080;">$imstr</span>[<span style="color: #800080;">$i</span>]["s"<span style="color: #000000;">]; 
      </span><span style="color: #008000;">//</span><span style="color: #008000;">画文字 </span>
      imagechar(<span style="color: #800080;">$im</span>, <span style="color: #800080;">$font_size</span>, <span style="color: #800080;">$imstr</span>[<span style="color: #800080;">$i</span>]["x"], <span style="color: #800080;">$imstr</span>[<span style="color: #800080;">$i</span>]["y"], <span style="color: #800080;">$imstr</span>[<span style="color: #800080;">$i</span>]["s"], <span style="color: #800080;">$text_color</span><span style="color: #000000;">); 
    } 
    </span><span style="color: #008080;">session_start</span><span style="color: #000000;">();
    </span><span style="color: #800080;">$_SESSION</span>[<span style="color: #800080;">$prefix</span>.'verifycode'] = <span style="color: #800080;">$firstNum</span> &gt; <span style="color: #800080;">$secondNum</span> ? (<span style="color: #800080;">$firstNum</span> - <span style="color: #800080;">$secondNum</span>) : (<span style="color: #800080;">$firstNum</span> + <span style="color: #800080;">$secondNum</span><span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">显示图片 </span>
    ImagePng(<span style="color: #800080;">$im</span><span style="color: #000000;">); 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">销毁图片 </span>
    ImageDestroy(<span style="color: #800080;">$im</span><span style="color: #000000;">); 
  } 
  </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">function</span> check(<span style="color: #800080;">$code</span><span style="color: #000000;">) 
  { 
    </span><span style="color: #0000ff;">if</span>(<span style="color: #008080;">trim</span>(<span style="color: #800080;">$_SESSION</span>[<span style="color: #800080;">$prefix</span>.'verifycode']) == <span style="color: #008080;">trim</span>(<span style="color: #800080;">$code</span><span style="color: #000000;">)) { 
      </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">; 
    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> { 
      </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">; 
    } 
  } 
}</span></code></pre>

<p>&nbsp;yi 简单验证码：<img src="./images/php生成动态验证码 加减算法验证码 简单验证码2.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>1.验证码为全自动区分计算机和人类的图灵测试的缩写。是一种区分用户是计算机和人的公共全自动程序。<br /><br />2.验证码主要应用场景：登录、注册确定前，发布、回复信息前，疑似机器请求时，做人/机器校验。<br /><br />3.实现步骤：<br /><br />（1）生成底图；<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 依赖php图片处理库GD,http://php.net/manual/zh/book.image.php<br /><br />（2）生成验证内容；<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 产生随机数,使用php函数rand（）；<br /><br />（3）生成验证码图片;<br /><br />（4）校验验证内容<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 需要php操作SESSION基础，将验证内容保存在服务器端；前端Ajax基础<br /><br />4.开发前的准备：</p>
<p>（1）php运行环境</p>
<p>（2）检查PHP是否支持GD，通过在php文件中使用函数 phpinfo（）输出查看即可。<br />&nbsp;&nbsp; </p>
<p>1.新建一个captcha.php文件，写入下列代码。实现验证码图片</p>
<src class="cnblogs_code">
<pre><code>&lt;?<span style="color: #000000;">php
 
</span><span style="color: #008000;">//</span><span style="color: #008000;">必须至于顶部,多服务器端记录验证码信息，便于用户输入后做校验</span>
     <span style="color: #008080;">session_start</span><span style="color: #000000;">();
 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">默认返回的是黑色的照片</span>
    <span style="color: #800080;">$image</span> = imagecreatetruecolor(100, 30<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;">将背景设置为白色的</span>
    <span style="color: #800080;">$bgcolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>, 255, 255, 255<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;">将白色铺满地图</span>
    imagefill(<span style="color: #800080;">$image</span>, 0, 0, <span style="color: #800080;">$bgcolor</span><span style="color: #000000;">);
 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">空字符串，每循环一次，追加到字符串后面  </span>
    <span style="color: #800080;">$captch_code</span>=''<span style="color: #000000;">;
 
   </span><span style="color: #008000;">//</span><span style="color: #008000;">验证码为随机四个数字</span>
    <span style="color: #0000ff;">for</span> (<span style="color: #800080;">$i</span>=0; <span style="color: #800080;">$i</span> &lt; 4; <span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
        </span><span style="color: #800080;">$fontsize</span>=6<span style="color: #000000;">;
        </span><span style="color: #800080;">$fontcolor</span>=imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(0,120),<span style="color: #008080;">rand</span>(0,120),<span style="color: #008080;">rand</span>(0,120<span style="color: #000000;">));
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">产生随机数字0-9</span>
        <span style="color: #800080;">$fontcontent</span> = <span style="color: #008080;">rand</span>(0,9<span style="color: #000000;">);
        </span><span style="color: #800080;">$captch_code</span>.= <span style="color: #800080;">$fontcontent</span><span style="color: #000000;">;
       </span><span style="color: #008000;">//</span><span style="color: #008000;">数字的位置，0，0是左上角。不能重合显示不完全</span>
        <span style="color: #800080;">$x</span>=(<span style="color: #800080;">$i</span>*100/4)+<span style="color: #008080;">rand</span>(5,10<span style="color: #000000;">);
        </span><span style="color: #800080;">$y</span>=<span style="color: #008080;">rand</span>(5,10<span style="color: #000000;">);
         imagestring(</span><span style="color: #800080;">$image</span>,<span style="color: #800080;">$fontsize</span>,<span style="color: #800080;">$x</span>,<span style="color: #800080;">$y</span>,<span style="color: #800080;">$fontcontent</span>,<span style="color: #800080;">$fontcolor</span><span style="color: #000000;">);
    }
      
 
  
   </span><span style="color: #800080;">$_SESSION</span>['authcode'] = <span style="color: #800080;">$captch_code</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">为验证码增加干扰元素，控制好颜色，
//点   </span>
    <span style="color: #0000ff;">for</span> (<span style="color: #800080;">$i</span>=0; <span style="color: #800080;">$i</span> &lt; 200; <span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
        </span><span style="color: #800080;">$pointcolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(50,200),<span style="color: #008080;">rand</span>(50,200),<span style="color: #008080;">rand</span>(50,200<span style="color: #000000;">));
        imagesetpixel(</span><span style="color: #800080;">$image</span>, <span style="color: #008080;">rand</span>(1,99), <span style="color: #008080;">rand</span>(1,29), <span style="color: #800080;">$pointcolor</span><span style="color: #000000;">);
    }
 
</span><span style="color: #008000;">//</span><span style="color: #008000;">为验证码增加干扰元素线   </span>
    <span style="color: #0000ff;">for</span> (<span style="color: #800080;">$i</span>=0; <span style="color: #800080;">$i</span> &lt; 3; <span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
        </span><span style="color: #800080;">$linecolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(80,220),<span style="color: #008080;">rand</span>(80,220),<span style="color: #008080;">rand</span>(80,220<span style="color: #000000;">));
        imageline(</span><span style="color: #800080;">$image</span>, <span style="color: #008080;">rand</span>(1,99), <span style="color: #008080;">rand</span>(1,29),<span style="color: #008080;">rand</span>(1,99), <span style="color: #008080;">rand</span>(1,29) ,<span style="color: #800080;">$linecolor</span><span style="color: #000000;">);
    }
 
    </span><span style="color: #008080;">header</span>('content-type:image/png'<span style="color: #000000;">);
    imagepng(</span><span style="color: #800080;">$image</span><span style="color: #000000;">);
 
    </span><span style="color: #008000;">//</span><span style="color: #008000;">销毁</span>
    imagedestroy(<span style="color: #800080;">$image</span>);<br /><br /><span style="color: #008000;"><br /></span>查看效果如下：刷新一次，内容或会变化一次;<br /><br /></code></pre>

<p>2.新建一个form.php文件，写入下列代码。实现校验：</p>
<src class="cnblogs_code">
<pre><code>&lt;?<span style="color: #000000;">php
 
    </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">isset</span>(<span style="color: #800080;">$_REQUEST</span>['authcode'<span style="color: #000000;">])) {
        </span><span style="color: #008080;">session_start</span><span style="color: #000000;">();
 
        </span><span style="color: #0000ff;">if</span> (<span style="color: #008080;">strtolower</span>(<span style="color: #800080;">$_REQUEST</span>['authcode'])==<span style="color: #800080;">$_SESSION</span>['authcode'<span style="color: #000000;">]) {
            </span><span style="color: #0000ff;">echo</span>'&lt;font color ="#0000CC"&gt; 输出正确&lt;/font&gt;'<span style="color: #000000;">;
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> code...</span>
        }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
            </span><span style="color: #0000ff;">echo</span> <span style="color: #800080;">$_REQUEST</span>['authcode'<span style="color: #000000;">];
            </span><span style="color: #0000ff;">echo</span> <span style="color: #800080;">$_SESSION</span>['authcode'<span style="color: #000000;">];
            </span><span style="color: #0000ff;">echo</span>'&lt;font color ="#CC0000"&gt; 输出错误&lt;/font&gt;'<span style="color: #000000;">;
        }
 
        </span><span style="color: #0000ff;">exit</span><span style="color: #000000;">();
 
    }
</span>?&gt;
 
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;确认验证码&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form method="" ="post" action="./form.php"&gt;
            &lt;p&gt;<span style="color: #000000;">验证码图片：
                </span>&lt;img  id="captcha_img" border="1" src="./captcha.php?r=&lt;?php echo rand(); ?&gt;" alt="" width="100" height="30"&gt;
                
                &lt;a href="javascript:void(0)" &omicron;nclick="document.getElementById('captcha_img').src='./captcha.php?r='+Math.random() "&gt;换一个?&lt;/a&gt;
            &lt;/p&gt;
 
            &lt;p&gt;<span style="color: #000000;">请输入图片中的内容：
                </span>&lt;input type="text" name="authcode" value="" /&gt;
            &lt;/p&gt;
 
            &lt;p&gt;
                &lt;input type="submit" value="提交" style="padding: 6px 20px;"&gt;
            &lt;/p&gt;
 
        &lt;/form&gt;
    &lt;/body&gt;
 
&lt;/html&gt;</code></pre>

<p>实现结果如下，点击换一个，会换一个验证码。 输入图片中内容，如果正确，提示输入正确，如果错误，提示输入错误。样式自行修改。</p>
<p><img src="./images/php生成动态验证码 加减算法验证码 简单验证码3.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;er 数字字母验证码：</p>
<p>1.生成验证码图片，只需将产生随机数字的代码换成产生随机数字字母的代码，其他代码与二中保持一致</p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">验证码为随机四个字符，数字和字母</span>
   <span style="color: #0000ff;">for</span> (<span style="color: #800080;">$i</span>=0; <span style="color: #800080;">$i</span> &lt;4 ; <span style="color: #800080;">$i</span>++<span style="color: #000000;">) { 
       </span><span style="color: #800080;">$fontsize</span>=6<span style="color: #000000;">;
       </span><span style="color: #800080;">$fontcolor</span>=imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(0,120),<span style="color: #008080;">rand</span>(0,120),<span style="color: #008080;">rand</span>(0,120<span style="color: #000000;">));
       </span><span style="color: #008000;">//</span><span style="color: #008000;">子典。因为o和0，l和1冲突，所以我们字典中不包括易混淆的</span>
    <span style="color: #800080;">$data</span>='abcdefghijkmnpqrstuvwxy3456789'<span style="color: #000000;">;
    </span><span style="color: #800080;">$fontcontent</span> = <span style="color: #008080;">substr</span>(<span style="color: #800080;">$data</span>,<span style="color: #008080;">rand</span>(0,<span style="color: #008080;">strlen</span>(<span style="color: #800080;">$data</span>)) ,1<span style="color: #000000;">);
    </span><span style="color: #800080;">$captch_code</span>.= <span style="color: #800080;">$fontcontent</span><span style="color: #000000;">;
 
    </span><span style="color: #800080;">$x</span>=(<span style="color: #800080;">$i</span>*100/4)+<span style="color: #008080;">rand</span>(5,10<span style="color: #000000;">);
    </span><span style="color: #800080;">$y</span>=<span style="color: #008080;">rand</span>(5,10<span style="color: #000000;">);
 
    imagestring(</span><span style="color: #800080;">$image</span>,<span style="color: #800080;">$fontsize</span>,<span style="color: #800080;">$x</span>,<span style="color: #800080;">$y</span>,<span style="color: #800080;">$fontcontent</span>,<span style="color: #800080;">$fontcolor</span><span style="color: #000000;">);
   }
</span></code></pre>

<p>效果如下：</p>
<p><img src="./images/php生成动态验证码 加减算法验证码 简单验证码4.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;san：汉字验证码</p>
<src class="cnblogs_code">
<pre><code>&lt;?<span style="color: #000000;">php
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置session,必须处于脚本最顶部</span>
<span style="color: #008080;">session_start</span><span style="color: #000000;">();
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置验证码图片大小的函数</span>
<span style="color: #800080;">$image</span> = imagecreatetruecolor(200, 60<span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置验证码颜色 imagecolorallocate(int im, int red, int green, int blue);</span>
<span style="color: #800080;">$bgcolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>,255,255,255); <span style="color: #008000;">//</span><span style="color: #008000;">#ffffff
//区域填充 int imagefill(int im, int x, int y, int col) (x,y) 所在的区域着色,col 表示欲涂上的颜色</span>
imagefill(<span style="color: #800080;">$image</span>, 0, 0, <span style="color: #800080;">$bgcolor</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置ttf字体</span>
<span style="color: #800080;">$fontface</span> = 'FZYTK.TTF'<span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置字库，实现简单的数字储备</span>
<span style="color: #800080;">$str</span>='天地不仁以万物为刍狗圣人不仁以百姓为刍狗这句经常出现在控诉暴君暴政上地残暴不仁把万物都当成低贱的猪狗来看待而那些高高在上的所谓圣人们也没两样还不是把我们<br />老百姓也当成猪狗不如的东西但实在正取的解读是地不情感用事对万物一视同仁圣人不情感用事对百姓一视同仁执子之手与子偕老当男女主人公含情脉脉看着对方说了句执子之手与子<br />偕老女方泪眼朦胧含羞地回一句讨厌啦这样的情节我们是不是见过很多但是我们来看看这句的原句死生契阔与子成说执子之手与子偕老于嗟阔兮不我活兮于嗟洵兮不我信兮意思是说<br />战士之间的约定说要一起死现在和我约定的人都走了我怎么活啊赤裸裸的兄弟江湖战友友谊啊形容好基友的基情比男女之间的爱情要合适很多吧'<span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">str_split()切割字符串为一个数组,一个中文在utf_8为3个字符</span>
<span style="color: #800080;">$strdb</span> = <span style="color: #008080;">str_split</span>(<span style="color: #800080;">$str</span>,3<span style="color: #000000;">);
</span><span style="color: #008000;">//</span>
<span style="color: #800080;">$captcha_code</span> = ''<span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">生成随机的汉子</span>
<span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0;<span style="color: #800080;">$i</span>&lt;4;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置字体颜色，随机颜色</span>
<span style="color: #800080;">$fontcolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>, <span style="color: #008080;">rand</span>(0,120),<span style="color: #008080;">rand</span>(0,120), <span style="color: #008080;">rand</span>(0,120)); <span style="color: #008000;">//</span><span style="color: #008000;">0-120深颜色
//随机选取中文</span>
<span style="color: #800080;">$in</span> = <span style="color: #008080;">rand</span>(0,<span style="color: #008080;">count</span>(<span style="color: #800080;">$strdb</span><span style="color: #000000;">));
</span><span style="color: #800080;">$cn</span> = <span style="color: #800080;">$strdb</span>[<span style="color: #800080;">$in</span><span style="color: #000000;">];
</span><span style="color: #008000;">//</span><span style="color: #008000;">将中文记录到将保存到session的字符串中</span>
<span style="color: #800080;">$captcha_code</span> .= <span style="color: #800080;">$cn</span><span style="color: #000000;">;
</span><span style="color: #008000;">/*</span><span style="color: #008000;">imagettftext (resource $image ,float $size ,float $angle ,int $x ,int $y,int $color,
string $fontfile ,string $text ) 幕布 ，尺寸，角度，坐标，颜色，字体路径，文本字符串
mt_rand()生成更好的随机数,比rand()快四倍</span><span style="color: #008000;">*/</span><span style="color: #000000;">
imagettftext(</span><span style="color: #800080;">$image</span>, <span style="color: #008080;">mt_rand</span>(20,24),<span style="color: #008080;">mt_rand</span>(-60,60),(40*<span style="color: #800080;">$i</span>+20),<span style="color: #008080;">mt_rand</span>(30,35),<span style="color: #800080;">$fontcolor</span>,<span style="color: #800080;">$fontface</span>,<span style="color: #800080;">$cn</span><span style="color: #000000;">);
}
</span><span style="color: #008000;">//</span><span style="color: #008000;">存到session</span>
<span style="color: #800080;">$_SESSION</span>['authcode'] = <span style="color: #800080;">$captcha_code</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">增加干扰元素，设置点</span>
<span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0;<span style="color: #800080;">$i</span>&lt;200;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置点的颜色，50-200颜色比数字浅，不干扰阅读</span>
<span style="color: #800080;">$pointcolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(50,200), <span style="color: #008080;">rand</span>(50,200), <span style="color: #008080;">rand</span>(50,200<span style="color: #000000;">));
</span><span style="color: #008000;">//</span><span style="color: #008000;">imagesetpixel &mdash; 画一个单一像素</span>
imagesetpixel(<span style="color: #800080;">$image</span>, <span style="color: #008080;">rand</span>(1,199), <span style="color: #008080;">rand</span>(1,59), <span style="color: #800080;">$pointcolor</span><span style="color: #000000;">);
}
</span><span style="color: #008000;">//</span><span style="color: #008000;">增加干扰元素，设置线</span>
<span style="color: #0000ff;">for</span>(<span style="color: #800080;">$i</span>=0;<span style="color: #800080;">$i</span>&lt;4;<span style="color: #800080;">$i</span>++<span style="color: #000000;">){
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置线的颜色</span>
<span style="color: #800080;">$linecolor</span> = imagecolorallocate(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(80,220), <span style="color: #008080;">rand</span>(80,220),<span style="color: #008080;">rand</span>(80,220<span style="color: #000000;">));
</span><span style="color: #008000;">//</span><span style="color: #008000;">设置线，两点一线</span>
imageline(<span style="color: #800080;">$image</span>,<span style="color: #008080;">rand</span>(1,199), <span style="color: #008080;">rand</span>(1,59),<span style="color: #008080;">rand</span>(1,199), <span style="color: #008080;">rand</span>(1,59),<span style="color: #800080;">$linecolor</span><span style="color: #000000;">);
}

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置头部，image/png</span>
<span style="color: #008080;">header</span>('Content-Type: image/png'<span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">imagepng() 建立png图形函数</span>
imagepng(<span style="color: #800080;">$image</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">imagedestroy() 结束图形函数 销毁$image</span>
imagedestroy(<span style="color: #800080;">$image</span><span style="color: #000000;">);
</span></code></pre>

<src class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">接着就是静态页的代码了：</span>
<span style="color: #000000;">
doctype html</span>&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;确认验证码&lt;/title&gt;<span style="color: #000000;">
&lt;/head</span>&gt;
&lt;body&gt;
&lt;form method="post" action="./form.php"&gt;
&lt;p&gt;验证码: &lt;img id="captcha_img" border='1' src='./captcha.php?r=echo rand(); ?&gt;' style="width:100px; height:30px" /&gt;
　　&lt;a href="javascript：void(0)" onclick="document.getElementById('captcha_img').src='./captcha.php?r='+Math.random()"&gt;换一个?&lt;/a&gt;<br />&lt;/<span style="color: #000000;">p</span>&gt;
&lt;P&gt;请输入验证码:&lt;input type="text" name='authcode' value=''/&gt;&lt;/p&gt;
&lt;p&gt;&lt;input type='submit' value='提交' style='padding:6px 5px;'/&gt;&lt;/p&gt;<span style="color: #000000;">
&lt;/body</span>&gt;<span style="color: #000000;">
&lt;/html</span>&gt;

 

<span style="color: #008000;">//</span><span style="color: #008000;">从html可以看到，提交的表单是到php的，所以还要有一个判断的php代码：</span>

&lt;?<span style="color: #000000;">php
</span><span style="color: #008080;">header</span>("Content-Type:text/html;charset=utf-8"); <span style="color: #008000;">//</span><span style="color: #008000;">设置头部信息
//isset()检测变量是否设置</span>
<span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">isset</span>(<span style="color: #800080;">$_REQUEST</span>['authcode'<span style="color: #000000;">])){
　　</span><span style="color: #008080;">session_start</span><span style="color: #000000;">();
   </span><span style="color: #008000;">//</span><span style="color: #008000;">strtolower()小写函数</span>
　　<span style="color: #0000ff;">if</span>(<span style="color: #008080;">strtolower</span>(<span style="color: #800080;">$_REQUEST</span>['authcode'])== <span style="color: #800080;">$_SESSION</span>['authcode'<span style="color: #000000;">]){
　　　　</span><span style="color: #008000;">//</span><span style="color: #008000;">跳转页面</span>
　　　　<span style="color: #0000ff;">echo</span> "&lt;script language=\"javascript\"&gt;"<span style="color: #000000;">;
　　　　</span><span style="color: #0000ff;">echo</span> "document.location=\"./php\""<span style="color: #000000;">;
　　　　</span><span style="color: #0000ff;">echo</span> "&lt;/script&gt;"<span style="color: #000000;">;
　　}</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
　　　　</span><span style="color: #008000;">//</span><span style="color: #008000;">提示以及跳转页面</span>
　　　　<span style="color: #0000ff;">echo</span> "&lt;script language=\"javascript\"&gt;"<span style="color: #000000;">;
　　　　</span><span style="color: #0000ff;">echo</span> "alert('输入错误!');"<span style="color: #000000;">;
　　　　</span><span style="color: #0000ff;">echo</span> "document.location=\"./php\""<span style="color: #000000;">;
　　　　</span><span style="color: #0000ff;">echo</span> "&lt;/script&gt;"<span style="color: #000000;">;
}
</span><span style="color: #0000ff;">exit</span><span style="color: #000000;">();
}

php</span>?&gt;</code></pre>

<p>&nbsp;</p>
<p><img src="./images/php生成动态验证码 加减算法验证码 简单验证码5.jpg" alt="" /></p>
<p>&nbsp;</p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
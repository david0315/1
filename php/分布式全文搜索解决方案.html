<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修分布式全文搜索解决方案' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>分布式全文搜索解决方案</center></div><div class='banquan'>原文出处:本文由博客园博主行走的阳光提供。<br/>
原文连接:https://www.cnblogs.com/shineguang/p/11291800.html</div><br>
    <p><span style="font-size: 18px;"><strong>1.安装JDK</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp; &nbsp; &nbsp;ElasticSearch是用JAVA语言开发的，其运行需要安装JDK。</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp; &nbsp; &nbsp;JDK (Java Development Kit) ，是整个Java的核心，包括了Java运行环境（Java Runtime Envirnment），一堆Java工具和Java基础的类库(rt.jar)。</strong></span></p>
<p><span style="font-size: 18px;"><strong>2.安装</strong></span><span style="font-size: 18px;"><strong><span class="md-expand">Elasticsearch</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp;安装好后，配置环境变量。</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp;然后打开命令行窗口 执行命令 elasticsearch -d 启动elasticsearch</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp;注：该命令行窗口 不要关闭。</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand"><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp;浏览器打开 <span class="md-expand"><a href="http://localhost:9200">http://localhost:9200</a></span></span></span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand"><span class="md-expand"><span class="md-expand"><img src="./images/分布式全文搜索解决方案0.jpg" alt="" /></span></span></span></strong></span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 18px;"><strong>出现以上界面，则启动成功&nbsp; &nbsp;&nbsp;</strong></span></p>
<p><span style="font-size: 18px;"><strong>2.1</strong></span><span style="font-size: 18px;"><strong><span class="md-expand">（选装）安装Elasticsearch-Head</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp; </span></strong></span><strong><span style="font-size: 18px;"><span class="md-expand">&nbsp;</span><span class="md-line md-end-block md-focus"><span class="md-expand">elasticsearch-head是一个用于浏览ElasticSearch集群并与其进行交互的Web项目</span></span></span></strong></p>
<p><strong><span class="md-line md-end-block" style="font-size: 18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GitHub托管地址：<span class="md-expand"><a href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></span></span></strong></p>
<p><strong><span class="md-line md-end-block" style="font-size: 18px;"><span class="md-expand">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 安装：打开命令行，切换到Elasticsearch-Head目录，执行以下命令&nbsp;</span></span></strong></p>
<src class="cnblogs_code">
<pre><code>npm install</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 18px;"><strong> &nbsp;启动：打开命令行，切换到Elasticsearch-Head目录，执行以下命令</strong></span></p>
<src class="cnblogs_code">
<pre><code>npm run start</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="font-size: 18px;"><strong>由于跨域（Elasticsearch位于9200端口），需要添加配置： E:\elasticsearch-7.1.0\config\elasticsearch.yml中</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;">新添加的配置行</span>
http.cors.enabled: <span style="color: #0000ff;">true</span><span style="color: #000000;">
http</span>.cors.allow-origin: "*"</code></pre>

<p><span style="font-size: 18px;"><strong>2.2<span class="md-expand">安装Elasticsearch-php</span></strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </strong></span><strong><span style="font-size: 18px;">&nbsp;<span class="md-line md-end-block md-focus"><span class="md-expand">使用composer安装：</span></span><span class="md-line md-end-block">在项目目录下，执行以下命令</span></span></strong></p>
<src class="cnblogs_code">
<pre><code>composer <span style="color: #0000ff;">require</span> elasticsearch/elasticsearch</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-size: 18px;"><strong>&nbsp; &nbsp;配置php.ini的sys_temp_dir</strong></span></p>
<p><span style="font-size: 18px;"><strong><img src="./images/分布式全文搜索解决方案1.jpg" alt="" /></strong></span></p>
<h2 class="md-end-block md-heading md-focus"><span class="md-expand">3.ElasticSearch基本使用</span></h2>
<h3 class="md-end-block md-heading md-focus"><span style="font-size: 18px;"><strong><span class="md-expand">3.1 基本概念</span></strong></span></h3>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 18px;"><strong> &nbsp;<span class="md-expand">3.1.1 节点与集群</span></strong></span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<strong><span class="md-line md-end-block md-focus" style="font-size: 18px;"><span class="md-expand">Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。</span></span></strong></p>
<p><strong><span class="md-line md-end-block md-focus" style="font-size: 18px;">&nbsp; &nbsp; &nbsp; &nbsp; 单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。</span></strong></p>
<p><strong><span class="md-line md-end-block md-focus" style="font-size: 18px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="md-expand" style="font-size: 18px;">3.1.2 索引</span></strong></p>
<p><strong><span class="md-expand" style="font-size: 18px;">&nbsp; &nbsp; </span><span style="font-size: 18px;"><span class="md-expand">&nbsp; &nbsp;</span><span class="md-line md-end-block md-focus"><span class="md-expand">在Elasticsearch中存储数据的行为就叫做索引(indexing)</span></span></span></strong></p>
<p><span style="font-size: 18px;"><strong><span class="md-line md-end-block">&nbsp; &nbsp; &nbsp; &nbsp;在Elasticsearch中，文档归属于一种类型(type),而这些类型存在于索引(index)中</span><span class="md-line md-end-block">类比传统关系型数据库：</span></strong></span></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code>Relational DB -&gt; Databases -&gt; Tables -&gt; Rows -&gt;<span style="color: #000000;"> Columns
Elasticsearch </span>-&gt; Indices   -&gt; Types  -&gt; Documents -&gt; Fields</code></pre>

<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="font-size: 18px;"><strong><span class="md-line md-end-block md-focus"><span class="md-expand">Elasticsearch集群可以包含多个索引(indices)（数据库）</span></span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-line md-end-block">&nbsp; &nbsp; &nbsp; &nbsp; 每一个索引可以包含多个类型(types)（表）</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-line md-end-block">&nbsp; &nbsp; &nbsp; &nbsp; 每一个类型包含多个文档(documents)（行）</span></strong></span></p>
<p><span style="font-size: 18px;"><strong><span class="md-line md-end-block">&nbsp; &nbsp; &nbsp; &nbsp; 然后每个文档包含多个字段(Fields)（列）。</span></strong></span></p>
<h3 class="md-end-block md-heading md-focus"><span style="font-size: 18px;"><strong><span class="md-expand">3.2 基本使用</span></strong></span></h3>
<p><strong><span class="md-line md-end-block md-focus" style="font-size: 18px;">&nbsp; &nbsp; &nbsp; </span><span class="md-line md-end-block md-focus" style="font-size: 18px;">&nbsp;</span><span class="md-expand" style="font-size: 18px;">3.2.1 创建索引</span></strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$es</span> = \Elasticsearch\ClientBuilder::create()-&gt;setHosts(['127.0.0.1:9200'])-&gt;<span style="color: #000000;">build();
</span><span style="color: #800080;">$params</span> =<span style="color: #000000;"> [
    </span>'index' =&gt; 'test_index'<span style="color: #000000;">
];
</span><span style="color: #800080;">$r</span> = <span style="color: #800080;">$es</span>-&gt;indices()-&gt;create(<span style="color: #800080;">$params</span><span style="color: #000000;">);
dump(</span><span style="color: #800080;">$r</span>);<span style="color: #0000ff;">die</span>;</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 18px;"><strong> 预期结果：&nbsp;</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">array</span>(3<span style="color: #000000;">) {
  [</span>"acknowledged"] =&gt; bool(<span style="color: #0000ff;">true</span><span style="color: #000000;">)
  [</span>"shards_acknowledged"] =&gt; bool(<span style="color: #0000ff;">true</span><span style="color: #000000;">)
  [</span>"index"] =&gt; <span style="color: #0000ff;">string</span>(10) "test_index"<span style="color: #000000;">
}</span></code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-size: 18px;"><strong>&nbsp; 3<span class="md-expand">.2.2 添加文档（索引文档）</span></strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$es</span> = \Elasticsearch\ClientBuilder::create()-&gt;setHosts(['127.0.0.1:9200'])-&gt;<span style="color: #000000;">build();
</span><span style="color: #800080;">$params</span> =<span style="color: #000000;"> [
    </span>'index' =&gt; 'test_index',
    'type' =&gt; 'test_type',
    'id' =&gt; 100,
    'body' =&gt; ['id'=&gt;100, 'title'=&gt;'PHP从入门到精通', 'author' =&gt; '张三'<span style="color: #000000;">]
];

</span><span style="color: #800080;">$r</span> = <span style="color: #800080;">$es</span>-&gt;index(<span style="color: #800080;">$params</span><span style="color: #000000;">);
dump(</span><span style="color: #800080;">$r</span>);<span style="color: #0000ff;">die</span>;</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 18px;"><strong>预期结果：</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">array</span>(8<span style="color: #000000;">) {
  [</span>"_index"] =&gt; <span style="color: #0000ff;">string</span>(10) "test_index"<span style="color: #000000;">
  [</span>"_type"] =&gt; <span style="color: #0000ff;">string</span>(9) "test_type"<span style="color: #000000;">
  [</span>"_id"] =&gt; <span style="color: #0000ff;">string</span>(3) "100"<span style="color: #000000;">
  [</span>"_version"] =&gt; int(1<span style="color: #000000;">)
  [</span>"result"] =&gt; <span style="color: #0000ff;">string</span>(7) "created"<span style="color: #000000;">
  [</span>"_shards"] =&gt; <span style="color: #0000ff;">array</span>(3<span style="color: #000000;">) {
    [</span>"total"] =&gt; int(2<span style="color: #000000;">)
    [</span>"successful"] =&gt; int(1<span style="color: #000000;">)
    [</span>"failed"] =&gt; int(0<span style="color: #000000;">)
  }
  [</span>"_seq_no"] =&gt; int(0<span style="color: #000000;">)
  [</span>"_primary_term"] =&gt; int(1<span style="color: #000000;">)
}</span></code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-size: 18px;"><strong><span class="md-expand">3.2.3 修改文档</span></strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$es</span> = \Elasticsearch\ClientBuilder::create()-&gt;setHosts(['127.0.0.1:9200'])-&gt;<span style="color: #000000;">build();
</span><span style="color: #800080;">$params</span> =<span style="color: #000000;"> [
    </span>'index' =&gt; 'test_index',
    'type' =&gt; 'test_type',
    'id' =&gt; 100,
    'body' =&gt;<span style="color: #000000;"> [
        </span>'doc' =&gt; ['id'=&gt;100, 'title'=&gt;'ES从入门到精通', 'author' =&gt; '张三'<span style="color: #000000;">]
    ]
];

</span><span style="color: #800080;">$r</span> = <span style="color: #800080;">$es</span>-&gt;update(<span style="color: #800080;">$params</span><span style="color: #000000;">);
dump(</span><span style="color: #800080;">$r</span>);<span style="color: #0000ff;">die</span>;</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="font-size: 18px;"><strong>&nbsp;预期结果：</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">array</span>(8<span style="color: #000000;">) {
  [</span>"_index"] =&gt; <span style="color: #0000ff;">string</span>(10) "test_index"<span style="color: #000000;">
  [</span>"_type"] =&gt; <span style="color: #0000ff;">string</span>(9) "test_type"<span style="color: #000000;">
  [</span>"_id"] =&gt; <span style="color: #0000ff;">string</span>(3) "100"<span style="color: #000000;">
  [</span>"_version"] =&gt; int(2<span style="color: #000000;">)
  [</span>"result"] =&gt; <span style="color: #0000ff;">string</span>(7) "updated"<span style="color: #000000;">
  [</span>"_shards"] =&gt; <span style="color: #0000ff;">array</span>(3<span style="color: #000000;">) {
    [</span>"total"] =&gt; int(2<span style="color: #000000;">)
    [</span>"successful"] =&gt; int(1<span style="color: #000000;">)
    [</span>"failed"] =&gt; int(0<span style="color: #000000;">)
  }
  [</span>"_seq_no"] =&gt; int(1<span style="color: #000000;">)
  [</span>"_primary_term"] =&gt; int(1<span style="color: #000000;">)
}</span></code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-size: 18px;"><strong><span class="md-expand">3.2.4 删除文档</span></strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$es</span> = \Elasticsearch\ClientBuilder::create()-&gt;setHosts(['127.0.0.1:9200'])-&gt;<span style="color: #000000;">build();
</span><span style="color: #800080;">$params</span> =<span style="color: #000000;"> [
    </span>'index' =&gt; 'test_index',
    'type' =&gt; 'test_type',
    'id' =&gt; 100,<span style="color: #000000;">
];

</span><span style="color: #800080;">$r</span> = <span style="color: #800080;">$es</span>-&gt;delete(<span style="color: #800080;">$params</span><span style="color: #000000;">);
dump(</span><span style="color: #800080;">$r</span>);<span style="color: #0000ff;">die</span>;</code></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="font-size: 18px;"><strong>预期结果：</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">array</span>(8<span style="color: #000000;">) {
  [</span>"_index"] =&gt; <span style="color: #0000ff;">string</span>(10) "test_index"<span style="color: #000000;">
  [</span>"_type"] =&gt; <span style="color: #0000ff;">string</span>(9) "test_type"<span style="color: #000000;">
  [</span>"_id"] =&gt; <span style="color: #0000ff;">string</span>(3) "100"<span style="color: #000000;">
  [</span>"_version"] =&gt; int(3<span style="color: #000000;">)
  [</span>"result"] =&gt; <span style="color: #0000ff;">string</span>(7) "deleted"<span style="color: #000000;">
  [</span>"_shards"] =&gt; <span style="color: #0000ff;">array</span>(3<span style="color: #000000;">) {
    [</span>"total"] =&gt; int(2<span style="color: #000000;">)
    [</span>"successful"] =&gt; int(1<span style="color: #000000;">)
    [</span>"failed"] =&gt; int(0<span style="color: #000000;">)
  }
  [</span>"_seq_no"] =&gt; int(2<span style="color: #000000;">)
  [</span>"_primary_term"] =&gt; int(1<span style="color: #000000;">)
}</span></code></pre>

<p>&nbsp;</p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
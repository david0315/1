<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修PHP抓取远程图片教程（包含不带后缀图片）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>PHP抓取远程图片教程（包含不带后缀图片）</center></div><div class='banquan'>原文出处:本文由博客园博主.Ronin提供。<br/>
原文连接:https://www.cnblogs.com/heyue0117/p/11812210.html</div><br>
    <p>之前做微信登录开发时候，发现微信头像图片没有后缀名，传统的图片抓取方式不奏效，需要特殊的抓取处理。所以，后来将各种情况结合起来，封装成一个类，分享出来。</p>
<p>&nbsp;</p>
<p><strong>创建项目</strong></p>
<p>作为演示，我们在www根目录创建项目grabimg，创建一个类GrabImage.php和一个index.php。</p>
<p><strong>编写类代码</strong></p>
<p>我们定义一个和文件名相同的类：GrabImage</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php keyword">class</code> <code class="php plain">GrabImage{</code></p>
<p class="line number2 index1 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p><strong>属性</strong></p>
<p>接下来定义几个需要使用的属性。</p>
<p>1、首先定义一个需要抓取的图片地址：$img_url</p>
<p>2、再定义一个$file_name用来存储文件的名称，但是不携带拓展名，因为可能涉及到拓展名更换，所以这里拆开定义</p>
<p>3、紧接着就是拓展名$extension</p>
<p>4、然后我们定义一个$file_dir，该属性的作用是，远程图片抓取到本地后所存储的目录，一般相对于PHP入口文件所在的位置作为起始。但是该路径一般不保存到数据库。</p>
<p>5、最后我们定义一个$save_dir，顾名思义，该路径是用来直接保存的数据库的目录。这里说明下，我们不直接存储文件保存路径到数据库，一般是为了之后如果系统迁移，方便更换路径做准备。我们这里的$save_dir一般为日期 + 文件名，如果需要使用时候取出，在前方拼上所需要的路径。</p>
<p><strong>方法</strong></p>
<p>属性弄完了，接下来我们正式开始抓取工作。</p>
<p>首先我们定义一个对外开放的方法getInstances用来获取一些数据，比如抓取图片地址，和本地保存路径。同时将其放入属性中。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">getInstances(</code><code class="php variable">$img_url</code> <code class="php plain">, </code><code class="php variable">$base_dir</code><code class="php plain">)</code></p>
<p class="line number2 index1 alt1"><code class="php plain">{</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url = </code><code class="php variable">$img_url</code><code class="php plain">;</code></p>
<p class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;save_dir = </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"Ym"</code><code class="php plain">).</code><code class="php string">'/'</code><code class="php plain">.</code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"d"</code><code class="php plain">).</code><code class="php string">'/'</code><code class="php plain">; </code><code class="php comments">// 比如：201610/19/</code></p>
<p class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir = </code><code class="php variable">$base_dir</code><code class="php plain">.</code><code class="php string">'/'</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;save_dir.</code><code class="php string">'/'</code><code class="php plain">; </code><code class="php comments">// 比如：./uploads/image/2016/10/19/</code></p>
<p class="line number6 index5 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p>图片保存路径拼接完成，下面我们要注意一个问题，目录是否存在。日期在一天天走，但是目录并不会自动创建。所以，在保存图片之前，首先需要检查一下，如果当前目录不存在我们需要即时创建。</p>
<p>我们创建设置目录方法setDir。属性我们设置了private，安全</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
<p class="line number8 index7 alt1">8</p>
<p class="line number9 index8 alt2">9</p>
<p class="line number10 index9 alt1">10</p>
<p class="line number11 index10 alt2">11</p>
<p class="line number12 index11 alt1">12</p>
<p class="line number13 index12 alt2">13</p>
<p class="line number14 index13 alt1">14</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php comments">/**</code></p>
<p class="line number2 index1 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">* 检查图片需要保持的目录是否存在</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* 如果不存在，则立即创建一个目录</code></p>
<p class="line number4 index3 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">* @return bool</code></p>
<p class="line number5 index4 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number6 index5 alt1"><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">setDir()</code></p>
<p class="line number7 index6 alt2"><code class="php plain">{</code></p>
<p class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(!</code><code class="php functions">file_exists</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir))</code></p>
<p class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">mkdir</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir,0777,TRUE);</code></p>
<p class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name = uniqid().rand(10000,99999);</code><code class="php comments">// 文件名，这里只是演示，实际项目中请使用自己的唯一文件名生成方法</code></p>
<p class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">true;</code></p>
<p class="line number14 index13 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p>接下来就是抓取核心代码</p>
<p>第一步，解决一个问题，我们需要抓取的图片可能没有后缀名。按照传统的抓取方法，先抓取图片，然后截取后缀名的方案不可行。</p>
<p>我们必须通过其它方法来获得图片类型。办法就是从文件流信息中获取文件头信息，从而判断文件mime信息，就可以知道文件后缀名。</p>
<p>为了方便，先定义一个mime和文件拓展名映射。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php variable">$mimes</code><code class="php plain">=</code><code class="php keyword">array</code><code class="php plain">(</code></p>
<p class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/bmp'</code><code class="php plain">=&gt;</code><code class="php string">'bmp'</code><code class="php plain">,</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/gif'</code><code class="php plain">=&gt;</code><code class="php string">'gif'</code><code class="php plain">,</code></p>
<p class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/jpeg'</code><code class="php plain">=&gt;</code><code class="php string">'jpg'</code><code class="php plain">,</code></p>
<p class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/png'</code><code class="php plain">=&gt;</code><code class="php string">'png'</code><code class="php plain">,</code></p>
<p class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/x-icon'</code><code class="php plain">=&gt;</code><code class="php string">'ico'</code></p>
<p class="line number7 index6 alt2"><code class="php plain">);</code></p>

</td>
</tr>
</tbody>
</table>
<p>这样，当我获取了类型是image/gif的时候，我就可以知道是.gif图片了。</p>
<p>利用php函数get_headers，获取文件流头信息。当其值不为false时候我们将其赋值给变量$headers</p>
<p>取出Content-Type的值即为mime的值。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php keyword">if</code><code class="php plain">((</code><code class="php variable">$headers</code><code class="php plain">=get_headers(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url, 1))!==false){</code></p>
<p class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取响应的类型</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$type</code><code class="php plain">=</code><code class="php variable">$headers</code><code class="php plain">[</code><code class="php string">'Content-Type'</code><code class="php plain">];</code></p>
<p class="line number4 index3 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p>使用上面我们定义的映射表，我们可以很轻松的获取后缀名。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;extension=</code><code class="php variable">$mimes</code><code class="php plain">[</code><code class="php variable">$type</code><code class="php plain">];</code></p>

</td>
</tr>
</tbody>
</table>
<p>当然上面获取的$type，可能不存在我们的映射表中，说明这种类型文件并不是我们想要的，直接抛弃就好了，不用管它。</p>
<p>下面的步骤就和传统抓取文件一样。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
<p class="line number8 index7 alt1">8</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php variable">$file_path</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number2 index1 alt1"><code class="php comments">// 获取数据并保存</code></p>
<p class="line number3 index2 alt2"><code class="php variable">$contents</code><code class="php plain">=</code><code class="php functions">file_get_contents</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url);</code></p>
<p class="line number4 index3 alt1"><code class="php keyword">if</code><code class="php plain">(</code><code class="php functions">file_put_contents</code><code class="php plain">(</code><code class="php variable">$file_path</code> <code class="php plain">, </code><code class="php variable">$contents</code><code class="php plain">))</code></p>
<p class="line number5 index4 alt2"><code class="php plain">{</code></p>
<p class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 这里返回出去的值是直接保存到数据库的路径 + 文件名，形如：201610/19/57feefd7e2a7aY5p7LsPqaI-lY1BF.jpg</code></p>
<p class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;save_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number8 index7 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p>首先获取本地保图片存完整路径$file_path，接下来使用file_get_contents抓取数据，然后使用file_put_contents保存到刚刚的文件路径。</p>
<p>最后我们返回一个可以直接保存到数据库中的路径，而不是文件存储路径。</p>
<p>该抓取方法完整版是：</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
<p class="line number8 index7 alt1">8</p>
<p class="line number9 index8 alt2">9</p>
<p class="line number10 index9 alt1">10</p>
<p class="line number11 index10 alt2">11</p>
<p class="line number12 index11 alt1">12</p>
<p class="line number13 index12 alt2">13</p>
<p class="line number14 index13 alt1">14</p>
<p class="line number15 index14 alt2">15</p>
<p class="line number16 index15 alt1">16</p>
<p class="line number17 index16 alt2">17</p>
<p class="line number18 index17 alt1">18</p>
<p class="line number19 index18 alt2">19</p>
<p class="line number20 index19 alt1">20</p>
<p class="line number21 index20 alt2">21</p>
<p class="line number22 index21 alt1">22</p>
<p class="line number23 index22 alt2">23</p>
<p class="line number24 index23 alt1">24</p>
<p class="line number25 index24 alt2">25</p>
<p class="line number26 index25 alt1">26</p>
<p class="line number27 index26 alt2">27</p>
<p class="line number28 index27 alt1">28</p>
<p class="line number29 index28 alt2">29</p>
<p class="line number30 index29 alt1">30</p>
<p class="line number31 index30 alt2">31</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">getRemoteImg()</code></p>
<p class="line number2 index1 alt1"><code class="php plain">{</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// mime 和 扩展名 的映射</code></p>
<p class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$mimes</code><code class="php plain">=</code><code class="php keyword">array</code><code class="php plain">(</code></p>
<p class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/bmp'</code><code class="php plain">=&gt;</code><code class="php string">'bmp'</code><code class="php plain">,</code></p>
<p class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/gif'</code><code class="php plain">=&gt;</code><code class="php string">'gif'</code><code class="php plain">,</code></p>
<p class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/jpeg'</code><code class="php plain">=&gt;</code><code class="php string">'jpg'</code><code class="php plain">,</code></p>
<p class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/png'</code><code class="php plain">=&gt;</code><code class="php string">'png'</code><code class="php plain">,</code></p>
<p class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/x-icon'</code><code class="php plain">=&gt;</code><code class="php string">'ico'</code></p>
<p class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">);</code></p>
<p class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取响应头</code></p>
<p class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">((</code><code class="php variable">$headers</code><code class="php plain">=get_headers(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url, 1))!==false)</code></p>
<p class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取响应的类型</code></p>
<p class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$type</code><code class="php plain">=</code><code class="php variable">$headers</code><code class="php plain">[</code><code class="php string">'Content-Type'</code><code class="php plain">];</code></p>
<p class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 如果符合我们要的类型</code></p>
<p class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(isset(</code><code class="php variable">$mimes</code><code class="php plain">[</code><code class="php variable">$type</code><code class="php plain">]))</code></p>
<p class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;extension=</code><code class="php variable">$mimes</code><code class="php plain">[</code><code class="php variable">$type</code><code class="php plain">];</code></p>
<p class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$file_path</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取数据并保存</code></p>
<p class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$contents</code><code class="php plain">=</code><code class="php functions">file_get_contents</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url);</code></p>
<p class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php functions">file_put_contents</code><code class="php plain">(</code><code class="php variable">$file_path</code> <code class="php plain">, </code><code class="php variable">$contents</code><code class="php plain">))</code></p>
<p class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 这里返回出去的值是直接保存到数据库的路径 + 文件名，形如：201610/19/57feefd7e2a7aY5p7LsPqaI-lY1BF.jpg</code></p>
<p class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;save_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></p>
<p class="line number31 index30 alt2"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p>最后，为了简单，我们想在其他地方只要调用其中一个方法就可以完成抓取。所以，我们将抓取动作直接放入到getInstances中，在配置完路径后，直接抓取，所以，在初始化配置方法getInstances里新增代码。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
<p class="line number8 index7 alt1">8</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;setDir())</code></p>
<p class="line number2 index1 alt1"><code class="php plain">{</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;getRemoteImg();</code></p>
<p class="line number4 index3 alt1"><code class="php plain">}</code></p>
<p class="line number5 index4 alt2"><code class="php keyword">else</code></p>
<p class="line number6 index5 alt1"><code class="php plain">{</code></p>
<p class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></p>
<p class="line number8 index7 alt1"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p><strong>测试</strong></p>
<p>我们去刚刚创建的index.php文件内试试。</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></p>
<p class="line number2 index1 alt1"><code class="php keyword">require_once</code> <code class="php string">'GrabImage.php'</code><code class="php plain">;</code></p>
<p class="line number3 index2 alt2"><code class="php variable">$object</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">GrabImage();</code></p>
<p class="line number4 index3 alt1"><code class="php variable">$img_url</code> <code class="php plain">= </code><code class="php string">"http://www.bidianer.com/img/icon_mugs.jpg"</code><code class="php plain">; // 需要抓取的远程图片</code></p>
<p class="line number5 index4 alt2"><code class="php variable">$base_dir</code> <code class="php plain">= </code><code class="php string">"./uploads/image"</code><code class="php plain">; </code><code class="php comments">// 本地保存的路径</code></p>
<p class="line number6 index5 alt1"><code class="php functions">echo</code> <code class="php variable">$object</code><code class="php plain">-&gt;getInstances(</code><code class="php variable">$img_url</code> <code class="php plain">, </code><code class="php variable">$base_dir</code><code class="php plain">);</code></p>
<p class="line number7 index6 alt2"><code class="php plain">?&gt;</code></p>

</td>
</tr>
</tbody>
</table>
<p>惹，的确抓取过来了</p>
<p>&nbsp;</p>
<p><strong>完整代码</strong></p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<p class="line number1 index0 alt2">1</p>
<p class="line number2 index1 alt1">2</p>
<p class="line number3 index2 alt2">3</p>
<p class="line number4 index3 alt1">4</p>
<p class="line number5 index4 alt2">5</p>
<p class="line number6 index5 alt1">6</p>
<p class="line number7 index6 alt2">7</p>
<p class="line number8 index7 alt1">8</p>
<p class="line number9 index8 alt2">9</p>
<p class="line number10 index9 alt1">10</p>
<p class="line number11 index10 alt2">11</p>
<p class="line number12 index11 alt1">12</p>
<p class="line number13 index12 alt2">13</p>
<p class="line number14 index13 alt1">14</p>
<p class="line number15 index14 alt2">15</p>
<p class="line number16 index15 alt1">16</p>
<p class="line number17 index16 alt2">17</p>
<p class="line number18 index17 alt1">18</p>
<p class="line number19 index18 alt2">19</p>
<p class="line number20 index19 alt1">20</p>
<p class="line number21 index20 alt2">21</p>
<p class="line number22 index21 alt1">22</p>
<p class="line number23 index22 alt2">23</p>
<p class="line number24 index23 alt1">24</p>
<p class="line number25 index24 alt2">25</p>
<p class="line number26 index25 alt1">26</p>
<p class="line number27 index26 alt2">27</p>
<p class="line number28 index27 alt1">28</p>
<p class="line number29 index28 alt2">29</p>
<p class="line number30 index29 alt1">30</p>
<p class="line number31 index30 alt2">31</p>
<p class="line number32 index31 alt1">32</p>
<p class="line number33 index32 alt2">33</p>
<p class="line number34 index33 alt1">34</p>
<p class="line number35 index34 alt2">35</p>
<p class="line number36 index35 alt1">36</p>
<p class="line number37 index36 alt2">37</p>
<p class="line number38 index37 alt1">38</p>
<p class="line number39 index38 alt2">39</p>
<p class="line number40 index39 alt1">40</p>
<p class="line number41 index40 alt2">41</p>
<p class="line number42 index41 alt1">42</p>
<p class="line number43 index42 alt2">43</p>
<p class="line number44 index43 alt1">44</p>
<p class="line number45 index44 alt2">45</p>
<p class="line number46 index45 alt1">46</p>
<p class="line number47 index46 alt2">47</p>
<p class="line number48 index47 alt1">48</p>
<p class="line number49 index48 alt2">49</p>
<p class="line number50 index49 alt1">50</p>
<p class="line number51 index50 alt2">51</p>
<p class="line number52 index51 alt1">52</p>
<p class="line number53 index52 alt2">53</p>
<p class="line number54 index53 alt1">54</p>
<p class="line number55 index54 alt2">55</p>
<p class="line number56 index55 alt1">56</p>
<p class="line number57 index56 alt2">57</p>
<p class="line number58 index57 alt1">58</p>
<p class="line number59 index58 alt2">59</p>
<p class="line number60 index59 alt1">60</p>
<p class="line number61 index60 alt2">61</p>
<p class="line number62 index61 alt1">62</p>
<p class="line number63 index62 alt2">63</p>
<p class="line number64 index63 alt1">64</p>
<p class="line number65 index64 alt2">65</p>
<p class="line number66 index65 alt1">66</p>
<p class="line number67 index66 alt2">67</p>
<p class="line number68 index67 alt1">68</p>
<p class="line number69 index68 alt2">69</p>
<p class="line number70 index69 alt1">70</p>
<p class="line number71 index70 alt2">71</p>
<p class="line number72 index71 alt1">72</p>
<p class="line number73 index72 alt2">73</p>
<p class="line number74 index73 alt1">74</p>
<p class="line number75 index74 alt2">75</p>
<p class="line number76 index75 alt1">76</p>
<p class="line number77 index76 alt2">77</p>
<p class="line number78 index77 alt1">78</p>
<p class="line number79 index78 alt2">79</p>
<p class="line number80 index79 alt1">80</p>
<p class="line number81 index80 alt2">81</p>
<p class="line number82 index81 alt1">82</p>
<p class="line number83 index82 alt2">83</p>
<p class="line number84 index83 alt1">84</p>
<p class="line number85 index84 alt2">85</p>
<p class="line number86 index85 alt1">86</p>
<p class="line number87 index86 alt2">87</p>
<p class="line number88 index87 alt1">88</p>
<p class="line number89 index88 alt2">89</p>
<p class="line number90 index89 alt1">90</p>
<p class="line number91 index90 alt2">91</p>
<p class="line number92 index91 alt1">92</p>
<p class="line number93 index92 alt2">93</p>
<p class="line number94 index93 alt1">94</p>
<p class="line number95 index94 alt2">95</p>
<p class="line number96 index95 alt1">96</p>
<p class="line number97 index96 alt2">97</p>
<p class="line number98 index97 alt1">98</p>
<p class="line number99 index98 alt2">99</p>
<p class="line number100 index99 alt1">100</p>
<p class="line number101 index100 alt2">101</p>
<p class="line number102 index101 alt1">102</p>
<p class="line number103 index102 alt2">103</p>
<p class="line number104 index103 alt1">104</p>
<p class="line number105 index104 alt2">105</p>
<p class="line number106 index105 alt1">106</p>
<p class="line number107 index106 alt2">107</p>
<p class="line number108 index107 alt1">108</p>
<p class="line number109 index108 alt2">109</p>
<p class="line number110 index109 alt1">110</p>
<p class="line number111 index110 alt2">111</p>
<p class="line number112 index111 alt1">112</p>
<p class="line number113 index112 alt2">113</p>
<p class="line number114 index113 alt1">114</p>
<p class="line number115 index114 alt2">115</p>
<p class="line number116 index115 alt1">116</p>
<p class="line number117 index116 alt2">117</p>
<p class="line number118 index117 alt1">118</p>
<p class="line number119 index118 alt2">119</p>
<p class="line number120 index119 alt1">120</p>
<p class="line number121 index120 alt2">121</p>
</td>
<td class="code">
<src class="container">
<p class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></p>
<p class="line number2 index1 alt1"><code class="php comments">/**</code></p>
<p class="line number3 index2 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* 抓取远程图片到本地，可以抓取不带有后缀的图片</code></p>
<p class="line number4 index3 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">* @author YanYing &lt;yanyinghq@163.com&gt;</code></p>
<p class="line number5 index4 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* @link bidianer.com</code></p>
<p class="line number6 index5 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number7 index6 alt2"><code class="php keyword">class</code> <code class="php plain">GrabImage{</code></p>
<p class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @var string 需要抓取的远程图片的地址</code></p>
<p class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 例如：http://www.bidianer.com/img/icon_mugs.jpg</code></p>
<p class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 有一些远程文件路径可能不带拓展名</code></p>
<p class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 形如：http://www.xxx.com/img/icon_mugs/q/0</code></p>
<p class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$img_url</code><code class="php plain">;</code></p>
<p class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @var string 需要保存的文件名称</code></p>
<p class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 抓取到本地的文件名会重新生成名称</code></p>
<p class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 但是，不带拓展名</code></p>
<p class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 例如：57feefd7e2a7aY5p7LsPqaI-lY1BF</code></p>
<p class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$file_name</code><code class="php plain">;</code></p>
<p class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @var string 文件的拓展名</code></p>
<p class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 这里直接使用远程图片拓展名</code></p>
<p class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 对于没有拓展名的远程图片，会从文件流中获取</code></p>
<p class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 例如：.jpg</code></p>
<p class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$extension</code><code class="php plain">;</code></p>
<p class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @var string 文件保存在本地的目录</code></p>
<p class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 这里的路径是PHP保存文件的路径</code></p>
<p class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 一般相对于入口文件保存的路径</code></p>
<p class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 比如：./uploads/image/201610/19/</code></p>
<p class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 但是该路径一般不直接存储到数据库</code></p>
<p class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$file_dir</code><code class="php plain">;</code></p>
<p class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @var string 数据库保存的文件目录</code></p>
<p class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 这个路径是直接保存到数据库的图片路径</code></p>
<p class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 一般直接保存日期 + 文件名，需要使用的时候拼上前面路径</code></p>
<p class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 这样做的目的是为了迁移系统时候方便更换路径</code></p>
<p class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 例如：201610/19/</code></p>
<p class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$save_dir</code><code class="php plain">;</code></p>
<p class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @param string $img_url 需要抓取的图片地址</code></p>
<p class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @param string $base_dir 本地保存的路径，比如：./uploads/image，最后不带斜杠"/"</code></p>
<p class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @return bool|int</code></p>
<p class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">getInstances(</code><code class="php variable">$img_url</code> <code class="php plain">, </code><code class="php variable">$base_dir</code><code class="php plain">)</code></p>
<p class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url = </code><code class="php variable">$img_url</code><code class="php plain">;</code></p>
<p class="line number53 index52 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;save_dir = </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"Ym"</code><code class="php plain">).</code><code class="php string">'/'</code><code class="php plain">.</code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"d"</code><code class="php plain">).</code><code class="php string">'/'</code><code class="php plain">; </code><code class="php comments">// 比如：201610/19/</code></p>
<p class="line number54 index53 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir = </code><code class="php variable">$base_dir</code><code class="php plain">.</code><code class="php string">'/'</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;save_dir.</code><code class="php string">'/'</code><code class="php plain">; </code><code class="php comments">// 比如：./uploads/image/2016/10/19/</code></p>
<p class="line number55 index54 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;start();</code></p>
<p class="line number56 index55 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number57 index56 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number58 index57 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 开始抓取图片</code></p>
<p class="line number59 index58 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number60 index59 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">start()</code></p>
<p class="line number61 index60 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number62 index61 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;setDir())</code></p>
<p class="line number63 index62 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number64 index63 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;getRemoteImg();</code></p>
<p class="line number65 index64 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number66 index65 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">else</code></p>
<p class="line number67 index66 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number68 index67 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></p>
<p class="line number69 index68 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number70 index69 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number71 index70 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number72 index71 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 检查图片需要保持的目录是否存在</code></p>
<p class="line number73 index72 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 如果不存在，则立即创建一个目录</code></p>
<p class="line number74 index73 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @return bool</code></p>
<p class="line number75 index74 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number76 index75 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">setDir()</code></p>
<p class="line number77 index76 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number78 index77 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(!</code><code class="php functions">file_exists</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir))</code></p>
<p class="line number79 index78 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number80 index79 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">mkdir</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir,0777,TRUE);</code></p>
<p class="line number81 index80 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number82 index81 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name = uniqid().rand(10000,99999);</code><code class="php comments">// 文件名，这里只是演示，实际项目中请使用自己的唯一文件名生成方法</code></p>
<p class="line number83 index82 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">true;</code></p>
<p class="line number84 index83 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number85 index84 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></p>
<p class="line number86 index85 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* 抓取远程图片核心方法，可以同时抓取有后缀名的图片和没有后缀名的图片</code></p>
<p class="line number87 index86 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*</code></p>
<p class="line number88 index87 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* @return bool|int</code></p>
<p class="line number89 index88 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></p>
<p class="line number90 index89 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">getRemoteImg()</code></p>
<p class="line number91 index90 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number92 index91 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// mime 和 扩展名 的映射</code></p>
<p class="line number93 index92 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$mimes</code><code class="php plain">=</code><code class="php keyword">array</code><code class="php plain">(</code></p>
<p class="line number94 index93 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/bmp'</code><code class="php plain">=&gt;</code><code class="php string">'bmp'</code><code class="php plain">,</code></p>
<p class="line number95 index94 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/gif'</code><code class="php plain">=&gt;</code><code class="php string">'gif'</code><code class="php plain">,</code></p>
<p class="line number96 index95 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/jpeg'</code><code class="php plain">=&gt;</code><code class="php string">'jpg'</code><code class="php plain">,</code></p>
<p class="line number97 index96 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/png'</code><code class="php plain">=&gt;</code><code class="php string">'png'</code><code class="php plain">,</code></p>
<p class="line number98 index97 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'image/x-icon'</code><code class="php plain">=&gt;</code><code class="php string">'ico'</code></p>
<p class="line number99 index98 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">);</code></p>
<p class="line number100 index99 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取响应头</code></p>
<p class="line number101 index100 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">((</code><code class="php variable">$headers</code><code class="php plain">=get_headers(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url, 1))!==false)</code></p>
<p class="line number102 index101 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number103 index102 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取响应的类型</code></p>
<p class="line number104 index103 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$type</code><code class="php plain">=</code><code class="php variable">$headers</code><code class="php plain">[</code><code class="php string">'Content-Type'</code><code class="php plain">];</code></p>
<p class="line number105 index104 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 如果符合我们要的类型</code></p>
<p class="line number106 index105 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(isset(</code><code class="php variable">$mimes</code><code class="php plain">[</code><code class="php variable">$type</code><code class="php plain">]))</code></p>
<p class="line number107 index106 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number108 index107 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;extension=</code><code class="php variable">$mimes</code><code class="php plain">[</code><code class="php variable">$type</code><code class="php plain">];</code></p>
<p class="line number109 index108 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$file_path</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;file_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number110 index109 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 获取数据并保存</code></p>
<p class="line number111 index110 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$contents</code><code class="php plain">=</code><code class="php functions">file_get_contents</code><code class="php plain">(</code><code class="php variable">$this</code><code class="php plain">-&gt;img_url);</code></p>
<p class="line number112 index111 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php functions">file_put_contents</code><code class="php plain">(</code><code class="php variable">$file_path</code> <code class="php plain">, </code><code class="php variable">$contents</code><code class="php plain">))</code></p>
<p class="line number113 index112 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></p>
<p class="line number114 index113 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// 这里返回出去的值是直接保存到数据库的路径 + 文件名，形如：201610/19/57feefd7e2a7aY5p7LsPqaI-lY1BF.jpg</code></p>
<p class="line number115 index114 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;save_dir.</code><code class="php variable">$this</code><code class="php plain">-&gt;file_name.</code><code class="php string">"."</code><code class="php plain">.</code><code class="php variable">$this</code><code class="php plain">-&gt;extension;</code></p>
<p class="line number116 index115 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number117 index116 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number118 index117 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number119 index118 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></p>
<p class="line number120 index119 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></p>
<p class="line number121 index120 alt2"><code class="php plain">}</code></p>

</td>
</tr>
</tbody>
</table>
<p><img src="./images/PHP抓取远程图片教程（包含不带后缀图片）0.jpg" alt="" /></p>
<p>&nbsp; &nbsp; &nbsp;<strong>明确的学习思路能更高效的学习</strong></p>
<p><strong><img src="./images/PHP抓取远程图片教程（包含不带后缀图片）1.jpg" alt="" /></strong></p>
<p>&nbsp;</p>
<p><a href="https://jq.qq.com/?_wv=1027&amp;k=5Spo1ah" target="_blank"><strong>点此加入该群学习</strong></a></p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
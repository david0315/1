<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修thinkphp5ajax分頁&amp;&amp;搜索後分頁' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>thinkphp5ajax分頁&amp;&amp;搜索後分頁</center></div><div class='banquan'>原文出处:本文由博客园博主宋宝提供。<br/>
原文连接:https://www.cnblogs.com/songbao/p/11115269.html</div><br>
    <p>//控制器層</p>
<p> //分頁<br />    public function list_january_table(){</p>
<p>        //設置當前頁<br />        $page = input("post.page") ? input("post.page") : 1;<br />        //設置每頁顯示條數<br />        $size = 3;<br />        //查詢總條數<br />        $num = Db::table("January_table")-&gt;count();<br />        //查詢總頁數<br />        $end = ceil($num/$size);<br />        //計算偏移量<br />        $offset = ($page-1)*$size;<br />        //查詢所有條數<br />        $data = Db::table("January_table")-&gt;limit($offset,$size)-&gt;select();<br />        //手機號碼中獎四位隱藏<br />        foreach ($data as $key=&gt;$val){<br />            $data[$key]['mobile']=substr($val['mobile'],0,3).'****'.substr($val['mobile'],7,4);<br />        }<br />        return view("list_January_table",['list'=&gt;$data,'end'=&gt;$end]);<br />    }</p>
<p>//ajax分頁&amp;搜索后分頁<br />    public function ajax_page_January_table(){<br />        $search = input("post.search");<br />        if ($search==""){<br />            //設置當前頁<br />            $page = input("post.page") ? input("post.page") : 1;<br />            //設置每頁顯示條數<br />            $size = 3;<br />            //查詢總條數<br />            $num = Db::table("January_table")-&gt;count();<br />            //查詢總頁數<br />            $end = ceil($num/$size);<br />            //計算偏移量<br />            $offset = ($page-1)*$size;<br />            //查詢所有條數<br />            $data = Db::table("January_table")-&gt;limit($offset,$size)-&gt;select();<br />        }else{<br />            //設置當前頁<br />            $page = input("post.page") ? input("post.page") : 1;<br />            //設置每頁顯示條數<br />            $size = 3;<br />            //查詢總條數<br />            $num = Db::table("January_table")-&gt;where('username','like',"%$search%")-&gt;count();<br />            //查詢總頁數<br />            $end = ceil($num/$size);<br />            //計算偏移量<br />            $offset = ($page-1)*$size;<br />            //查詢所有條數<br />            $data = Db::table("January_table")-&gt;where('username','like',"%$search%")-&gt;limit($offset,$size)-&gt;select();<br />        }<br />        return json($data);<br />    }</p>
<p>&nbsp;</p>
<p>//視圖層</p>
<p>&lt;!DOCTYPE html&gt;<br />&lt;html lang="en"&gt;<br />&lt;head&gt;<br />    &lt;meta charset="UTF-8"&gt;<br />    &lt;title&gt;展示頁面&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;center&gt;<br />    &lt;h1&gt;展示頁面&lt;/h1&gt;<br />    &lt;input type="text" name="search" id="search"&gt;&lt;input type="button" class="page" value="搜索"&gt;<br />    &lt;table border="1"&gt;<br />        &lt;tr&gt;<br />            &lt;td&gt;選擇&lt;/td&gt;<br />            &lt;td&gt;班名&lt;/td&gt;<br />            &lt;td&gt;年齡&lt;/td&gt;<br />            &lt;td&gt;性別&lt;/td&gt;<br />            &lt;td&gt;簡介&lt;/td&gt;<br />            &lt;td&gt;手機&lt;/td&gt;<br />            &lt;td&gt;頭像&lt;/td&gt;<br />            &lt;td&gt;詳情&lt;/td&gt;<br />            &lt;td&gt;操作&lt;/td&gt;<br />        &lt;/tr&gt;<br />        &lt;tbody id="tb"&gt;<br />        {volist name="list" id="vo"}<br />        &lt;tr id="{$vo.id}"&gt;<br />            &lt;td&gt;&lt;input type="checkbox" name="check" value="{$vo.id}"&gt;{$vo.id}&lt;/td&gt;<br />            &lt;td fd="username" class="cli_up"&gt;{$vo.username}&lt;/td&gt;<br />            &lt;td&gt;{$vo.age}&lt;/td&gt;<br />            &lt;td ida="{$vo.id}" class="up_time"&gt;<br />                {if condition="$vo.sex neq '1'"}男<br />                {else /} 女<br />                {/if}<br />            &lt;/td&gt;<br />            &lt;td&gt;{$vo.desc}&lt;/td&gt;<br />            &lt;td&gt;{$vo.mobile}&lt;/td&gt;<br />            &lt;td&gt;&lt;img src="__STATIC__/uploads/{$vo.photo}" width="80px" alt=""&gt;&lt;/td&gt;<br />            &lt;td&gt;{$vo.content}&lt;/td&gt;<br />            &lt;td&gt;&lt;a href="javascript:void (0)" class="del" id_del="{$vo.id}"&gt;刪除&lt;/a&gt;&lt;/td&gt;<br />        &lt;/tr&gt;<br />        {/volist}<br />        &lt;/tbody&gt;<br />    &lt;/table&gt;<br />    &lt;a href="{:url('Index/add_January_Table')}"&gt;添加&lt;/a&gt;<br />    &lt;input type="button" class="yes" value="全選"&gt;<br />    &lt;input type="button" class="no" value="全不選"&gt;<br />    &lt;input type="button" class="yn" value="反選"&gt;<br />    &lt;input type="button" class="del_all" value="批量刪除"&gt;<br />    &lt;input type="hidden" name="a_page" id="a_page" value="1"&gt;<br />    &lt;input type="hidden" name="last_page" id="last_page" value="{$end}"&gt;<br />    &lt;a href="javascript:void (0)" class="page"&gt;首頁&lt;/a&gt;<br />    &lt;a href="javascript:void (0)" class="page"&gt;上一頁&lt;/a&gt;<br />    &lt;a href="javascript:void (0)" class="page"&gt;下一頁&lt;/a&gt;<br />    &lt;a href="javascript:void (0)" class="page"&gt;尾頁&lt;/a&gt;<br />&lt;/center&gt;<br />&lt;script src="__STATIC__/jquery-3.3.1.min.js"&gt;&lt;/script&gt;<br />&lt;script&gt;<br />    //刪除<br />    $(document).on("click",".del",function () {<br />        var id = $(this).attr("id_del");<br />        $.ajax({<br />            url:"{:url('Index/del_January_table')}",<br />            type:"get",<br />            datatype:"json",<br />            data:{<br />                id:id,<br />            },<br />            success:function (data) {<br />                if (data==1){<br />                    history.go(0);<br />                } else {<br />                    alert("刪除失敗")<br />                }<br />            }<br />        })<br />    })<br />    //批量刪除<br />    $(document).on("click",".del_all",function () {<br />        var check = document.getElementsByName("check");<br />        var str= "";<br />        for (i=0;i&lt;check.length;i++) {<br />            if (check[i].checked == true) {<br />                str += "," + check[i].value;<br />            }<br />        }<br />            var id = str.substr(1);alert(id)<br />            $.ajax({<br />                url:"{:url('Index/del_January_table')}",<br />                type:"get",<br />                datatype:"json",<br />                data:{<br />                    id:id,<br />                },<br />                success:function (data) {<br />                    if (data==1){<br />                        alert("刪除成功");<br />                        history.go(0);<br />                    } else {<br />                        alert("刪除失敗")<br />                    }<br />                }<br />            });<br />    })<br />    //全選<br />    $(document).on("click",".yes",function () {<br />         var check = document.getElementsByName("check");<br />         for (i=0;i&lt;check.length;i++){<br />             if (check[i].checked==false){<br />                 check[i].checked = true;<br />             }<br />         }<br />    })<br />    //全不選<br />    $(document).on("click",".no",function () {<br />        var check = document.getElementsByName("check");<br />        for (i=0;i&lt;check.length;i++){<br />            if (check[i].checked==true){<br />                check[i].checked = false;<br />            }<br />        }<br />    })<br />    //反選<br />    $(document).on("click",".yn",function () {<br />        var check = document.getElementsByName("check");<br />        for (i=0;i&lt;check.length;i++){<br />            if (check[i].checked==true){<br />                check[i].checked = false;<br />            }else {<br />                check[i].checked = true;<br />            }<br />        }<br />    })<br />    //即時更改<br />    $(document).on("click",".up_time",function () {<br />        var id = $(this).attr("ida");<br />        var sex = $(this).text();<br />        var obj = $(this);<br />        $.ajax({<br />            url:"{:url('Index/up_time_January_table')}",<br />            type:"post",<br />            datatype:"json",<br />            data:{<br />                id:id,<br />                sex:sex,<br />            },<br />            success:function (data) {<br />                if (data.code==1){<br />                    obj.html(data.message);<br />                }else {<br />                    obj.html(data.message);<br />                }<br />            }<br />        });<br />    })<br />    //即點即改<br />    $(document).ready(function () {<br />        $(".cli_up").dblclick(function () {<br />            var id = $(this).parent().attr("id");<br />            var fd = $(this).attr("fd");<br />            var text = $(this).text();<br />            var td = $(this);<br />            $(this).html('&lt;input type="text" class="cli'+id+fd+'" value="'+text+'"&gt;');<br />            $(".cli"+id+fd).blur(function () {<br />                var new_val = $(this).val();<br />                $.ajax({<br />                    url:"{:url('Index/update_January_table')}",<br />                    type:"post",<br />                    datatype:"json",<br />                    data:{<br />                        id:id,<br />                        fd:fd,<br />                        new_val:new_val,<br />                    },<br />                    success:function (data) {<br />                        console.log(data);<br />                        if (data==1){<br />                            td.text(new_val);<br />                        } else {<br />                            td.text(text);<br />                        }<br />                    }<br />                })<br />            })<br />        })<br />    })<br />    //ajax分頁&amp;搜索<br />    $(document).on("click",".page",function () {<br />        var search = $("#search").val();<br />        var a_val = $(this).text();<br />        var a_page = $("#a_page").val();<br />        var last_page = $("#last_page").val();<br />        if (a_val=="首頁"){<br />            var page = 1;<br />        } else if (a_val=="上一頁"){<br />            var page = parseInt(a_page)-1 &lt; 1 ? 1 : parseInt(a_page)-1;<br />        } else if (a_val=="下一頁"){<br />            var page = parseInt(a_page)+1 &gt; last_page ? last_page : parseInt(a_page)+1;<br />        } else if (a_val=="尾頁"){<br />            var page = last_page;<br />        }<br />        $.ajax({<br />            url:"{:url('Index/ajax_page_January_table')}",<br />            type:"post",<br />            datatype:"json",<br />            data:{<br />                page:page,<br />                search:search,<br />            },<br />            success:function (data) {<br />                var str = "";<br />                $.each(data,function (key,val) {<br />                    str+='&lt;tr&gt;\n' +<br />                        '            &lt;td&gt;&lt;input type="checkbox" name="check"&gt;'+val.id+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;'+val.username+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;'+val.age+'&lt;/td&gt;\n' +<br />                        '            &lt;td ida="'+val.id+'" class="up_time"&gt;'+val.sex+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;'+val.desc+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;'+val.mobile+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;&lt;img src="__STATIC__/uploads/'+val.photo+'" width="80px" alt=""&gt;&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;'+val.content+'&lt;/td&gt;\n' +<br />                        '            &lt;td&gt;&lt;a href="javascript:void (0)"&gt;刪除&lt;/a&gt;&lt;/td&gt;\n' +<br />                        '        &lt;/tr&gt;';<br />                })<br />                $("#tb").html(str);<br />                $("#a_page").val(page);<br />            }<br />        })<br />    })<br />&lt;/script&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</p>
<p>&nbsp;</p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修微信扫描带参数二维码事件' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>微信扫描带参数二维码事件</center></div><div class='banquan'>原文出处:本文由博客园博主哎呦?不错哦提供。<br/>
原文连接:https://www.cnblogs.com/super-ldc/p/11819437.html</div><br>
    <p><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">用户扫描带场景值二维码时，可能推送以下两种事件：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">如果用户还未关注公众号，则用户可以关注公众号，关注后微信会将带场景值关注事件推送给开发者。</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">如果用户已经关注公众号，则微信会将带场景值扫描事件推送给开发者。</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">1. 用户未关注时，进行关注后的事件推送</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">推送XML数据包示例：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;xml&gt;&lt;ToUserName&gt;&lt;![CDATA[toUser］&gt;&lt;/ToUserName&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;FromUserName&gt;&lt;![CDATA[FromUser］&gt;&lt;/FromUserName&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;CreateTime&gt;123456789&lt;/CreateTime&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;MsgType&gt;&lt;![CDATA[event］&gt;&lt;/MsgType&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;Event&gt;&lt;![CDATA[subscribe］&gt;&lt;/Event&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;EventKey&gt;&lt;![CDATA[qrscene_123123］&gt;&lt;/EventKey&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;Ticket&gt;&lt;![CDATA[TICKET］&gt;&lt;/Ticket&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;/xml&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">参数说明：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">参数	描述</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">ToUserName	开发者微信号</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">FromUserName	发送方帐号（一个OpenID）</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">CreateTime	消息创建时间 （整型）</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">MsgType	消息类型，event</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">Event	事件类型，subscribe</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">EventKey	事件KEY值，qrscene_为前缀，后面为二维码的参数值</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">Ticket	二维码的ticket，可用来换取二维码图片</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">2. 用户已关注时的事件推送</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">推送XML数据包示例：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;xml&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;ToUserName&gt;&lt;![CDATA[toUser］&gt;&lt;/ToUserName&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;FromUserName&gt;&lt;![CDATA[FromUser］&gt;&lt;/FromUserName&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;CreateTime&gt;123456789&lt;/CreateTime&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;MsgType&gt;&lt;![CDATA[event］&gt;&lt;/MsgType&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;Event&gt;&lt;![CDATA[SCAN］&gt;&lt;/Event&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;EventKey&gt;&lt;![CDATA[SCENE_VALUE］&gt;&lt;/EventKey&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;Ticket&gt;&lt;![CDATA[TICKET］&gt;&lt;/Ticket&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&lt;/xml&gt;</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">参数说明：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">参数	描述</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">ToUserName	开发者微信号</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">FromUserName	发送方帐号（一个OpenID）</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">CreateTime	消息创建时间 （整型）</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">MsgType	消息类型，event</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">Event	事件类型，SCAN</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">EventKey	事件KEY值，是一个32位无符号整数，即创建二维码时的二维码scene_id</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">Ticket	二维码的ticket，可用来换取二维码图片</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">案例：</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//1、扫码获取微信post过来的xml数据</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$postArr = $GLOBALS['HTTP_RAW_POST_DATA'];</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$postObj = simplexml_load_string( $postArr );</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//未订阅时 ，EventKey为qrscene_1984；订阅后，EventKey为1984</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( strtolower($postObj-&gt;Event) == 'subscribe'){</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$account_id = substr(trim($postObj-&gt;EventKey), 8);//输出1984</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$account_id = trim($postObj-&gt;EventKey);</span><br style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;" /><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p><span style="color: #111111; font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;">&nbsp;</span></p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的</center></div><div class='banquan'>原文出处:本文由博客园博主.Ronin提供。<br/>
原文连接:https://www.cnblogs.com/heyue0117/p/11911686.html</div><br>
    <p>WebSocket是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。</p>
<p>以前的推送技术使用 Ajax 轮询，浏览器需要不断地向服务器发送http请求来获取最新的数据，浪费很多的带宽等资源。</p>
<p>使用webSocket通讯，客户端和服务端只需要一次握手建立连接，就可以互相发送消息，进行数据传输，更实时地进行通讯。</p>
<p>&nbsp;</p>
<p><strong>一次握手建立WebSocket连接</strong></p>
<p>浏览器先向服务器发送个url以ws://开头的http的GET请求，响应状态码101表示Switching Protocols切换协议，</p>
<p>服务器根据请求头中Upgrade:websocket<code>把</code>客户端的请求切换到对应的协议，即websocket协议。</p>
<p><img src="./images/用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的0.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的1.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;响应头消息中包含Upgrade:websocket，表示它切换到的协议，即websocket协议。</p>
<p><img src="./images/用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的2.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>响应101，握手成功，http协议切换成websocket协议了，连接建立成功，浏览器和服务器可以随时主动发送消息给对方了，并且这个连接一直持续到客户端或服务器一方主动关闭连接。</p>
<p>为了加深理解，用websocket实现简单的在线聊天，先画个时序图，直观感受下流程。</p>
<p><img src="./images/用图解&amp;&amp;实例讲解php是如何实现websocket实时消息推送的3.jpg" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>网上有websocket在线测试工具，可以直接使用还是挺方便的，http://www.blue-zero.com/WebSocket/</p>
<p>&nbsp;</p>
<p><strong>以下是实现的例子，可供参考</strong></p>
<p>SocketService.php</p>
<pre><code><code><span><span>&lt;?php<br /><span>/**<br />&nbsp;*&nbsp;Created&nbsp;by&nbsp;cywu<br />&nbsp;*&nbsp;Date:&nbsp;2019/10/18<br />&nbsp;*&nbsp;Time:&nbsp;14:33<br />&nbsp;*/<br /><br /><span><span>class&nbsp;<span>SocketService<br />{<br />&nbsp;&nbsp;<span>private&nbsp;$address&nbsp;=&nbsp;<span>'0.0.0.0';<br />&nbsp;&nbsp;<span>private&nbsp;$port&nbsp;=&nbsp;<span>8080;<br />&nbsp;&nbsp;<span>private&nbsp;$_sockets;<br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>__construct<span>($address&nbsp;=&nbsp;<span>'',&nbsp;$port=<span>'')<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(!<span>empty($address)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;address&nbsp;=&nbsp;$address;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(!<span>empty($port))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;port&nbsp;=&nbsp;$port;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>service<span>(){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>//获取tcp协议号码。<br />&nbsp;&nbsp;&nbsp;&nbsp;$tcp&nbsp;=&nbsp;getprotobyname(<span>"tcp");<br />&nbsp;&nbsp;&nbsp;&nbsp;$sock&nbsp;=&nbsp;socket_create(AF_INET,&nbsp;SOCK_STREAM,&nbsp;$tcp);<br />&nbsp;&nbsp;&nbsp;&nbsp;socket_set_option($sock,&nbsp;SOL_SOCKET,&nbsp;SO_REUSEADDR,&nbsp;<span>1);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if($sock&nbsp;&lt;&nbsp;<span>0)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>throw&nbsp;<span>new&nbsp;<span>Exception(<span>"failed&nbsp;to&nbsp;create&nbsp;socket:&nbsp;".socket_strerror($sock).<span>"\n");<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;socket_bind($sock,&nbsp;<span>$this-&gt;address,&nbsp;<span>$this-&gt;port);<br />&nbsp;&nbsp;&nbsp;&nbsp;socket_listen($sock,&nbsp;<span>$this-&gt;port);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"listen&nbsp;on&nbsp;$this-&gt;address&nbsp;$this-&gt;port&nbsp;...&nbsp;\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;_sockets&nbsp;=&nbsp;$sock;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>run<span>(){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;service();<br />&nbsp;&nbsp;&nbsp;&nbsp;$clients[]&nbsp;=&nbsp;<span>$this-&gt;_sockets;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>while&nbsp;(<span>true){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$changes&nbsp;=&nbsp;$clients;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$write&nbsp;=&nbsp;<span>NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$except&nbsp;=&nbsp;<span>NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket_select($changes,&nbsp;$write,&nbsp;$except,&nbsp;<span>NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>foreach&nbsp;($changes&nbsp;as&nbsp;$key&nbsp;=&gt;&nbsp;$_sock){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(<span>$this-&gt;_sockets&nbsp;==&nbsp;$_sock){&nbsp;<span>//判断是不是新接入的socket<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(($newClient&nbsp;=&nbsp;socket_accept($_sock))&nbsp;===&nbsp;<span>false){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>die(<span>'failed&nbsp;to&nbsp;accept&nbsp;socket:&nbsp;'.socket_strerror($_sock).<span>"\n");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line&nbsp;=&nbsp;trim(socket_read($newClient,&nbsp;<span>1024));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;handshaking($newClient,&nbsp;$line);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//获取client&nbsp;ip<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket_getpeername&nbsp;($newClient,&nbsp;$ip);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$clients[$ip]&nbsp;=&nbsp;$newClient;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"Client&nbsp;ip:{$ip}&nbsp;&nbsp;\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"Client&nbsp;msg:{$line}&nbsp;\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span>else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket_recv($_sock,&nbsp;$buffer,&nbsp;<span>2048,&nbsp;<span>0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;<span>$this-&gt;message($buffer);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//在这里写你的业务代码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"{$key}&nbsp;clinet&nbsp;msg:",$msg,<span>"\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(STDOUT,&nbsp;<span>'Please&nbsp;input&nbsp;a&nbsp;argument:');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response&nbsp;=&nbsp;trim(fgets(STDIN));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>$this-&gt;send($_sock,&nbsp;$response);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>echo&nbsp;<span>"{$key}&nbsp;response&nbsp;to&nbsp;Client:".$response,<span>"\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;处理握手<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;$newClient&nbsp;socket<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@return&nbsp;int&nbsp;接收到的信息<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>handshaking<span>($newClient,&nbsp;$line){<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;=&nbsp;<span>array();<br />&nbsp;&nbsp;&nbsp;&nbsp;$lines&nbsp;=&nbsp;preg_split(<span>"/\r\n/",&nbsp;$line);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>foreach($lines&nbsp;as&nbsp;$line)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line&nbsp;=&nbsp;chop($line);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if(preg_match(<span>'/\A(\S+):&nbsp;(.*)\z/',&nbsp;$line,&nbsp;$matches))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers[$matches[<span>1]]&nbsp;=&nbsp;$matches[<span>2];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;$secKey&nbsp;=&nbsp;$headers[<span>'Sec-WebSocket-Key'];<br />&nbsp;&nbsp;&nbsp;&nbsp;$secAccept&nbsp;=&nbsp;base64_encode(pack(<span>'H*',&nbsp;sha1($secKey&nbsp;.&nbsp;<span>'258EAFA5-E914-47DA-95CA-C5AB0DC85B11')));<br />&nbsp;&nbsp;&nbsp;&nbsp;$upgrade&nbsp;=&nbsp;<span>"HTTP/1.1&nbsp;101&nbsp;Web&nbsp;Socket&nbsp;Protocol&nbsp;Handshake\r\n"&nbsp;.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>"Upgrade:&nbsp;websocket\r\n"&nbsp;.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>"Connection:&nbsp;Upgrade\r\n"&nbsp;.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>"WebSocket-Origin:&nbsp;$this-&gt;address\r\n"&nbsp;.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>"WebSocket-Location:&nbsp;ws://$this-&gt;address:$this-&gt;port/websocket/websocket\r\n".<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>"Sec-WebSocket-Accept:$secAccept\r\n\r\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;socket_write($newClient,&nbsp;$upgrade,&nbsp;strlen($upgrade));<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;解析接收数据<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;$buffer<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@return&nbsp;null|string<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>message<span>($buffer){<br />&nbsp;&nbsp;&nbsp;&nbsp;$len&nbsp;=&nbsp;$masks&nbsp;=&nbsp;$data&nbsp;=&nbsp;$decoded&nbsp;=&nbsp;<span>null;<br />&nbsp;&nbsp;&nbsp;&nbsp;$len&nbsp;=&nbsp;ord($buffer[<span>1])&nbsp;&amp;&nbsp;<span>127;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if&nbsp;($len&nbsp;===&nbsp;<span>126)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$masks&nbsp;=&nbsp;substr($buffer,&nbsp;<span>4,&nbsp;<span>4);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;substr($buffer,&nbsp;<span>8);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span>else&nbsp;<span>if&nbsp;($len&nbsp;===&nbsp;<span>127)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$masks&nbsp;=&nbsp;substr($buffer,&nbsp;<span>10,&nbsp;<span>4);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;substr($buffer,&nbsp;<span>14);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span>else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$masks&nbsp;=&nbsp;substr($buffer,&nbsp;<span>2,&nbsp;<span>4);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;substr($buffer,&nbsp;<span>6);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>for&nbsp;($index&nbsp;=&nbsp;<span>0;&nbsp;$index&nbsp;&lt;&nbsp;strlen($data);&nbsp;$index++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$decoded&nbsp;.=&nbsp;$data[$index]&nbsp;^&nbsp;$masks[$index&nbsp;%&nbsp;<span>4];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;$decoded;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;发送数据<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;$newClinet&nbsp;新接入的socket<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@param&nbsp;$msg&nbsp;&nbsp;要发送的数据<br />&nbsp;&nbsp;&nbsp;*&nbsp;<span>@return&nbsp;int|string<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>send<span>($newClinet,&nbsp;$msg){<br />&nbsp;&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;<span>$this-&gt;frame($msg);<br />&nbsp;&nbsp;&nbsp;&nbsp;socket_write($newClinet,&nbsp;$msg,&nbsp;strlen($msg));<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>frame<span>($s)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$a&nbsp;=&nbsp;str_split($s,&nbsp;<span>125);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>if&nbsp;(count($a)&nbsp;==&nbsp;<span>1)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;<span>"\x81"&nbsp;.&nbsp;chr(strlen($a[<span>0]))&nbsp;.&nbsp;$a[<span>0];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;$ns&nbsp;=&nbsp;<span>"";<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>foreach&nbsp;($a&nbsp;as&nbsp;$o)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ns&nbsp;.=&nbsp;<span>"\x81"&nbsp;.&nbsp;chr(strlen($o))&nbsp;.&nbsp;$o;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;$ns;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>/**<br />&nbsp;&nbsp;&nbsp;*&nbsp;关闭socket<br />&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;<span>public&nbsp;<span><span>function&nbsp;<span>close<span>(){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;socket_close(<span>$this-&gt;_sockets);<br />&nbsp;&nbsp;}<br />}<br /><br />$sock&nbsp;=&nbsp;<span>new&nbsp;SocketService();<br />$sock-&gt;run();</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>&nbsp;</strong></p>
<p>前端页面：web.html</p>
<pre><code><code><span>&lt;!doctype&nbsp;html&gt;<br /><span>&lt;<span>html&nbsp;<span>lang=<span>"en"&gt;<br />&nbsp;<span>&lt;<span>head&gt;<br />&nbsp;<span>&lt;<span>meta&nbsp;<span>charset=<span>"UTF-8"&gt;<br />&nbsp;<span>&lt;<span>meta&nbsp;<span>name=<span>"viewport"&nbsp;<span>content=<span>"width=device-width,initial-scale=1,&nbsp;maximum-scale=1,&nbsp;user-scalable=no"&gt;<br />&nbsp;<span>&lt;<span>title&gt;websocket<span>&lt;/<span>title&gt;<br />&nbsp;<span>&lt;/<span>head&gt;<br />&nbsp;<span>&lt;<span>body&gt;<br />&nbsp;<span>&lt;<span>input&nbsp;<span>id=<span>"text"&nbsp;<span>value=<span>""&gt;<br />&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"submit"&nbsp;<span>value=<span>"send"&nbsp;<span>onclick=<span>"start()"&gt;<br />&nbsp;<span>&lt;<span>input&nbsp;<span>type=<span>"submit"&nbsp;<span>value=<span>"close"&nbsp;<span>onclick=<span>"close()"&gt;<br /><span>&lt;<span>div&nbsp;<span>id=<span>"msg"&gt;<span>&lt;/<span>div&gt;<br />&nbsp;<span>&lt;<span>script&gt;<span><br />&nbsp;<span>/**<br />&nbsp;0：未连接<br /><br />1：连接成功，可通讯<br /><br />2：正在关闭<br /><br />3：连接已关闭或无法打开<br />*/<br /><br />&nbsp;&nbsp;<span>//创建一个webSocket&nbsp;实例<br />&nbsp;&nbsp;<span>var&nbsp;webSocket&nbsp;=&nbsp;<span>new&nbsp;WebSocket(<span>"ws://192.168.31.152:8083");<br /><br /><br />&nbsp;&nbsp;webSocket.onerror&nbsp;=&nbsp;<span><span>function&nbsp;(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;onError(event);<br />&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;<span>//&nbsp;打开websocket<br />&nbsp;&nbsp;webSocket.onopen&nbsp;=&nbsp;<span><span>function&nbsp;(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;onOpen(event);<br />&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;<span>//监听消息<br />&nbsp;&nbsp;webSocket.onmessage&nbsp;=&nbsp;<span><span>function&nbsp;(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;onMessage(event);<br />&nbsp;&nbsp;};<br /><br /><br />&nbsp;&nbsp;webSocket.onclose&nbsp;=&nbsp;<span><span>function&nbsp;(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;onClose(event);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span>//关闭监听websocket<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onError(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>"msg").innerHTML&nbsp;=&nbsp;<span>"&lt;p&gt;close&lt;/p&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"error"+event.data);<br />&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onOpen(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"open:"+sockState());<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>"msg").innerHTML&nbsp;=&nbsp;<span>"&lt;p&gt;Connect&nbsp;to&nbsp;Service&lt;/p&gt;";<br />&nbsp;&nbsp;};<br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onMessage(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"onMessage");<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>"msg").innerHTML&nbsp;+=&nbsp;<span>"&lt;p&gt;response:"+event.data+<span>"&lt;/p&gt;"<br />&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;<span><span>function&nbsp;<span>onClose(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>"msg").innerHTML&nbsp;=&nbsp;<span>"&lt;p&gt;close&lt;/p&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"close:"+sockState());<br />&nbsp;&nbsp;&nbsp;&nbsp;webSocket.close();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span><span>function&nbsp;<span>sockState(<span>){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;status&nbsp;=&nbsp;[<span>'未连接',<span>'连接成功，可通讯',<span>'正在关闭',<span>'连接已关闭或无法打开'];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return&nbsp;status[webSocket.readyState];<br />&nbsp;&nbsp;}<br /><br /><br />&nbsp;<span><span>function&nbsp;<span>start(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(webSocket);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>var&nbsp;msg&nbsp;=&nbsp;<span>document.getElementById(<span>'text').value;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>'text').value&nbsp;=&nbsp;<span>'';<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"send:"+sockState());<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>console.log(<span>"msg="+msg);<br />&nbsp;&nbsp;&nbsp;&nbsp;webSocket.send(<span>"msg="+msg);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span>document.getElementById(<span>"msg").innerHTML&nbsp;+=&nbsp;<span>"&lt;p&gt;request"+msg+<span>"&lt;/p&gt;"<br />&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;<span><span>function&nbsp;<span>close(<span>event){<br />&nbsp;&nbsp;&nbsp;&nbsp;webSocket.close();<br />&nbsp;&nbsp;}<br />&nbsp;<span>&lt;/<span>script&gt;<br />&nbsp;<span>&lt;/<span>body&gt;<br /><span>&lt;/<span>html&gt;<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>以上是文章全部内容，有需要学习与经验交流的友人请加入Swoole交流群学习与交流的</strong><strong>咱们一起学习，有问题一起交流，一起进步！</strong><strong>前提是你是学技术的。感谢阅读！</strong></p>
<p><a href="https://jq.qq.com/?_wv=1027&amp;k=5mcCu53" target="_blank"><strong>点此加入该群</strong></a></p>
<pre><code><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
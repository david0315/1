<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修PHP常用的自定义函数' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>PHP常用的自定义函数</center></div><div class='banquan'>原文出处:本文由博客园博主蜗牛闪电侠提供。<br/>
原文连接:https://www.cnblogs.com/xssz/p/11620738.html</div><br>
    <src id="cnblogs_post_body" class="blogpost-body ">
<src class="toc">
<p class="toc-title">目录</p>
<src class="toc-list">
<ul>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#php常用自定义函数类下载">php常用自定义函数类下载</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#php-设置字符编码为utf-8">php 设置字符编码为utf-8</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#gb2312和utf8相互转换">GB2312和utf8相互转换</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#路径格式化替换双斜线为单斜线">路径格式化(替换双斜线为单斜线)</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取当前文件的目录">获取当前文件的目录</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#打印输出">打印输出</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#api返回信息">api返回信息</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#字符串截取">字符串截取</a>
<ul>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#方法一">方法一:</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#方法二">方法二:</a></li>
</ul>
</li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#字符串make_by_id转成makebyid">字符串make_by_id转成makeById</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#数组-字符串-对象-json格式的字符串互转">数组 字符串 对象 json格式的字符串互转</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#强制类型转换">强制类型转换</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#php序列化serialize与返回序列化unserialeze">php序列化serialize与返回序列化unserialeze</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#创建日志文件">创建日志文件</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#返回二维数组其中一段的数据">返回二维数组其中一段的数据</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取ip地址">获取ip地址</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#php限制ip访问-只允许指定ip访问-允许号通配符过滤ip">PHP限制IP访问 只允许指定IP访问 允许*号通配符过滤IP</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取地址路径里0到第一个线的部分">获取地址路径里0到第一个\线的部分</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取当前文件所在的文件路径">获取当前文件所在的文件路径</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取随机字符串">获取随机字符串</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#中文字符串反转">中文字符串反转</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#检查目标文件夹是否存在如果不存在则自动创建该目录">检查目标文件夹是否存在，如果不存在则自动创建该目录</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#默认获得文件修改时间">默认获得文件修改时间</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#判断后缀类型">判断后缀类型</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#检查文件类型">检查文件类型</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#获取文件后缀名并判断是否在定义的数组中">获取文件后缀名,并判断是否在定义的数组中</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#判断路径是文件还是目录">判断路径是文件还是目录</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#计算文件或目录字节大小">计算文件或目录字节大小</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#接收异步过来的get消息">接收异步过来的get消息</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#curl之get请求">curl之get请求</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#curl之post请求">curl之post请求</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#curl之post_get请求">curl之post_get请求</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#判断数组类型参数是否含有空元素值">判断数组类型参数是否含有空元素值</a></li>
<li><a href="https://www.cnblogs.com/haima/p/9563582.html#判断是否传入必要参数">判断是否传入必要参数</a></li>
</ul>


<hr />
<h1 id="php常用自定义函数类下载">php常用自定义函数类下载</h1>
<p><a href="https://pan.baidu.com/s/18ZuQm5cx3ynQtQqcQgK0Vw" target="_blank">https://pan.baidu.com/s/18ZuQm5cx3ynQtQqcQgK0Vw</a></p>
<hr />
<h1 id="php-设置字符编码为utf-8">php 设置字符编码为utf-8</h1>
<p><code>header("Content-Type: text/html;charset=utf-8");</code></p>
<hr />
<h1 id="gb2312和utf8相互转换">GB2312和utf8相互转换</h1>
<pre><code><code class="hljs"><span class="hljs-keyword">echo iconv(<span class="hljs-string">'GB2312', <span class="hljs-string">'UTF-8//IGNORE', $str);      <span class="hljs-comment">//将字符串的编码从GB2312转到UTF-8
<span class="hljs-comment">//ignore的意思是忽略转换时的错误，如果没有ignore参数，所有该字符后面的字符串都无法被保存。
iconv(<span class="hljs-string">"UTF-8",<span class="hljs-string">"GB2312//IGNORE",$data);    
print_r(iconv_get_encoding());            <span class="hljs-comment">//得到当前页面编码信息
<span class="hljs-comment">// 转码
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">gbk<span class="hljs-params">($str){<span class="hljs-keyword">return iconv(<span class="hljs-string">'utf-8',<span class="hljs-string">'gbk',$str);}
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">utf8<span class="hljs-params">($str){<span class="hljs-keyword">return iconv(<span class="hljs-string">'gbk',<span class="hljs-string">'utf-8',$str);}
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<h1 id="路径格式化替换双斜线为单斜线">路径格式化(替换双斜线为单斜线)</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">path_formate<span class="hljs-params">($str){
    <span class="hljs-keyword">return str_replace(<span class="hljs-string">'\\\\',<span class="hljs-string">'\\',$str);
}</span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取当前文件的目录">获取当前文件的目录</h1>
<pre><code><code class="hljs">方法一:
define(<span class="hljs-string">'BASE_PATH',rtrim(str_replace(<span class="hljs-string">'\\',<span class="hljs-string">'/',<span class="hljs-keyword">__DIR__).<span class="hljs-string">'/'));
方法二:
define(<span class="hljs-string">'BASE_DIR', rtrim(str_replace(<span class="hljs-string">'\\', <span class="hljs-string">'/', dirname(<span class="hljs-keyword">__FILE__)),<span class="hljs-string">'/').<span class="hljs-string">'/');
</span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="打印输出">打印输出</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">dump<span class="hljs-params">($var)
{
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
    print_r($var);
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;/pre&gt;';
}

<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">vp<span class="hljs-params">($var)
{
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
    var_dump($var);
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;/pre&gt;';
}

<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">dd<span class="hljs-params">($var)
{
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
    var_dump($var);
    <span class="hljs-keyword">echo <span class="hljs-string">'&lt;/pre&gt;';
    <span class="hljs-keyword">die;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="api返回信息">api返回信息</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
*  数据返回
 * <span class="hljs-doctag">@param  [int] $code [结果码 200:正常/4**数据问题/5**服务器问题]
 * <span class="hljs-doctag">@param  [string] $msg  [返回的提示信息]
 * <span class="hljs-doctag">@param  [array]  $data [返回的数据]
 * <span class="hljs-doctag">@return [string]       [最终的json数据]
*/
<span class="hljs-keyword">public <span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">return_msg<span class="hljs-params">($code, $msg = <span class="hljs-string">'', $data = []) {
 
    <span class="hljs-comment">/*********** 组合数据  ***********/
    $return_data[<span class="hljs-string">'code'] = $code;
    $return_data[<span class="hljs-string">'msg']  = $msg;
    $return_data[<span class="hljs-string">'data'] = $data;
 
    <span class="hljs-comment">/*********** 返回信息并终止脚本  ***********/
    <span class="hljs-keyword">echo json_encode($return_data,JSON_UNESCAPED_UNICODE);
    <span class="hljs-keyword">die;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="字符串截取">字符串截取</h1>
<h2 id="方法一">方法一:</h2>
<p>在公共的common.php中</p>
<pre><code><code class="hljs"><span class="hljs-comment">//字符串截取并且超出显示省略号
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">subtext<span class="hljs-params">($text, $length)
{
<span class="hljs-keyword">if(mb_strlen($text, &lsquo;utf8&rsquo;) &gt; $length)
<span class="hljs-keyword">return mb_substr($text,<span class="hljs-number">0,$length,&rsquo;utf8&prime;).&rsquo; &hellip;&rsquo;;
<span class="hljs-keyword">return $text;
}</span></span></span></span></span></span></span></span></span></code></code></pre>
<p>在模版中调用则：<br />{$tops.title | subtext=18}</p>
<h2 id="方法二">方法二:</h2>
<p>在公共的common.php中</p>
<pre><code><code class="hljs"><span class="hljs-comment">//字符串截取

<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">cut_str<span class="hljs-params">($sourcestr,$cutlength)  

{  

   $returnstr=<span class="hljs-string">'';  

   $i=<span class="hljs-number">0;  

   $n=<span class="hljs-number">0;  

   $str_length=strlen($sourcestr);<span class="hljs-comment">//字符串的字节数  

   <span class="hljs-keyword">while (($n&lt;$cutlength) <span class="hljs-keyword">and ($i&lt;=$str_length))  

   {  

      $temp_str=substr($sourcestr,$i,<span class="hljs-number">1);  

      $ascnum=Ord($temp_str);<span class="hljs-comment">//得到字符串中第$i位字符的ascii码  

      <span class="hljs-keyword">if ($ascnum&gt;=<span class="hljs-number">224)    <span class="hljs-comment">//如果ASCII位高与224，  

      {  

$returnstr=$returnstr.substr($sourcestr,$i,<span class="hljs-number">3); <span class="hljs-comment">//根据UTF-8编码规范，将3个连续的字符计为单个字符          

         $i=$i+<span class="hljs-number">3;            <span class="hljs-comment">//实际Byte计为3  

         $n++;            <span class="hljs-comment">//字串长度计1  

      }  

      <span class="hljs-keyword">elseif ($ascnum&gt;=<span class="hljs-number">192) <span class="hljs-comment">//如果ASCII位高与192，  

      {  

         $returnstr=$returnstr.substr($sourcestr,$i,<span class="hljs-number">2); <span class="hljs-comment">//根据UTF-8编码规范，将2个连续的字符计为单个字符  

         $i=$i+<span class="hljs-number">2;            <span class="hljs-comment">//实际Byte计为2  

         $n++;            <span class="hljs-comment">//字串长度计1  

      }  

      <span class="hljs-keyword">elseif ($ascnum&gt;=<span class="hljs-number">65 &amp;&amp; $ascnum&lt;=<span class="hljs-number">90) <span class="hljs-comment">//如果是大写字母，  

      {  

         $returnstr=$returnstr.substr($sourcestr,$i,<span class="hljs-number">1);  

         $i=$i+<span class="hljs-number">1;            <span class="hljs-comment">//实际的Byte数仍计1个  

         $n++;            <span class="hljs-comment">//但考虑整体美观，大写字母计成一个高位字符  

      }  

      <span class="hljs-keyword">else                <span class="hljs-comment">//其他情况下，包括小写字母和半角标点符号，  

      {  

         $returnstr=$returnstr.substr($sourcestr,$i,<span class="hljs-number">1);  

         $i=$i+<span class="hljs-number">1;            <span class="hljs-comment">//实际的Byte数计1个  

         $n=$n+<span class="hljs-number">0.5;        <span class="hljs-comment">//小写字母和半角标点等与半个高位字符宽...  

      }  

   }  

         <span class="hljs-keyword">if ($str_length&gt;$i){  

          $returnstr = $returnstr . <span class="hljs-string">"...";<span class="hljs-comment">//超过长度时在尾处加上省略号  

      }  

    <span class="hljs-keyword">return $returnstr;  

} </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>在模版中调用则：<br />{$brand.brand_description|cut_str=###,10}</p>
<hr />
<h1 id="字符串make_by_id转成makebyid">字符串make_by_id转成makeById</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">changestr<span class="hljs-params">($string){
    <span class="hljs-keyword">if(!is_string($string)){
        <span class="hljs-keyword">die(<span class="hljs-string">'please input string.');
    }
    <span class="hljs-keyword">if(strpos($string,<span class="hljs-string">'_')){
        $stringArr=explode(<span class="hljs-string">'_',$string);
        $str=<span class="hljs-string">'';
        <span class="hljs-keyword">foreach ($stringArr <span class="hljs-keyword">as $v){
            $str .= ucfirst($v);
        }
        <span class="hljs-keyword">return $str;
    }
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="数组-字符串-对象-json格式的字符串互转">数组 字符串 对象 json格式的字符串互转</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 对象 转 数组
 *
 * <span class="hljs-doctag">@param object $obj 对象
 * <span class="hljs-doctag">@return array
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">object2array<span class="hljs-params">(&amp;$object) {
    $object =  json_decode( json_encode( $object),<span class="hljs-keyword">true);
    <span class="hljs-keyword">return  $object;
}


<span class="hljs-comment">/****对象转json数组格式的字符串*****/
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">obj2arr<span class="hljs-params">($object) {
    
    $json_object = json_encode($object);
    <span class="hljs-keyword">echo <span class="hljs-string">"&lt;pre&gt;";
    var_dump($json_object);<span class="hljs-keyword">die;
    $arr = json_decode($json_object, <span class="hljs-number">1);
    <span class="hljs-keyword">return $arr;
}


<span class="hljs-comment">/****json转数组*****/
<span class="hljs-comment">/**
 * [json_to_arr description] json_to_arr 遍历把json转为数组
 * <span class="hljs-doctag">@param  [type]  $jsonstr [description]
 * <span class="hljs-doctag">@return boolean          [description]
 */
 <span class="hljs-comment">//测试数据:$resp='{"jingdong_omnichannel_order_ship_update_responce":{"code":"0","result":"{\\"code\\":\\"400\\",\\"message\\":\\"系统异常:物流组件中为已取消状态\\",\\"success\\":false}"}}';

<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">json_to_arr2<span class="hljs-params">($jsonstr)
{
    <span class="hljs-keyword">if (is_string($jsonstr)&amp;&amp;is_array(json_decode($jsonstr, <span class="hljs-keyword">true))) {
        $arr = json_decode($jsonstr, <span class="hljs-keyword">true);
        <span class="hljs-keyword">foreach ($arr <span class="hljs-keyword">as $k =&gt; $v) {
            <span class="hljs-keyword">if (is_array($v)) {
                <span class="hljs-keyword">foreach ($v <span class="hljs-keyword">as $kk=&gt;$vv){
                    <span class="hljs-keyword">if(is_string($vv) &amp;&amp; is_array(json_decode($vv, <span class="hljs-keyword">true))){
                        $arr[$k][$kk] = json_decode($vv, <span class="hljs-keyword">true);
                    }
                }
            }
            <span class="hljs-keyword">if(is_string($v)&amp;&amp;is_sarray(json_decode($v,<span class="hljs-keyword">true))){
                $arr[$k]=json_decode($v,<span class="hljs-keyword">true);
            }
        }
        <span class="hljs-keyword">return $arr;
    } <span class="hljs-keyword">else {
        <span class="hljs-keyword">die(<span class="hljs-string">'This is not jsonString!');
    }
}



<span class="hljs-comment">/**
 * 数组 转 对象
 *
 * <span class="hljs-doctag">@param array $arr 数组
 * <span class="hljs-doctag">@return object
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">array_to_object<span class="hljs-params">($arr) {
    <span class="hljs-keyword">if (gettype($arr) != <span class="hljs-string">'array') {
        <span class="hljs-keyword">return;
    }
    <span class="hljs-keyword">foreach ($arr <span class="hljs-keyword">as $k =&gt; $v) {
        <span class="hljs-keyword">if (gettype($v) == <span class="hljs-string">'array' || getType($v) == <span class="hljs-string">'object') {
            $arr[$k] = (object)array_to_object($v);
        }
    }
 
    <span class="hljs-keyword">return (object)$arr;
}


$arr = <span class="hljs-keyword">array(
    <span class="hljs-string">'name'=&gt;<span class="hljs-string">'haima',
    <span class="hljs-string">'age'=&gt;<span class="hljs-number">32,
    <span class="hljs-string">'gender'=&gt;<span class="hljs-string">'nan'
);
$a=(Object)($arr); <span class="hljs-comment">//数组转对象
<span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
var_dump($a);

$jsonstring=json_encode($array,JSON_UNESCAPED_UNICODE); <span class="hljs-comment">//对象转json字符串 不转义中文汉字
<span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
var_dump($jsonstring);

$abj=json_decode($array); <span class="hljs-comment">//json转对象
$array=json_decode($array,<span class="hljs-keyword">true); <span class="hljs-comment">//json转数组


<span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
$b=(<span class="hljs-keyword">Array)($a); <span class="hljs-comment">//对象转数组
var_dump($b);</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="强制类型转换">强制类型转换</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 强制类型转换
 * <span class="hljs-doctag">@param string $data
 * <span class="hljs-doctag">@param string $type
 * <span class="hljs-doctag">@return mixed
 */
<span class="hljs-keyword">private <span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">typeCast<span class="hljs-params">(&amp;$data, $type)
{
    <span class="hljs-keyword">switch (strtolower($type)) {
        <span class="hljs-comment">// 数组
        <span class="hljs-keyword">case <span class="hljs-string">'a':
            $data = (<span class="hljs-keyword">array) $data;
            <span class="hljs-keyword">break;
        <span class="hljs-comment">// 数字
        <span class="hljs-keyword">case <span class="hljs-string">'d':
            $data = (int) $data;
            <span class="hljs-keyword">break;
        <span class="hljs-comment">// 浮点
        <span class="hljs-keyword">case <span class="hljs-string">'f':
            $data = (float) $data;
            <span class="hljs-keyword">break;
        <span class="hljs-comment">// 布尔
        <span class="hljs-keyword">case <span class="hljs-string">'b':
            $data = (boolean) $data;
            <span class="hljs-keyword">break;
        <span class="hljs-comment">// 字符串
        <span class="hljs-keyword">case <span class="hljs-string">'s':
        <span class="hljs-keyword">default:
            <span class="hljs-keyword">if (is_scalar($data)) {
                $data = (string) $data;
            } <span class="hljs-keyword">else {
                <span class="hljs-keyword">throw <span class="hljs-keyword">new \InvalidArgumentException(<span class="hljs-string">'variable type error：' . gettype($data));
            }
    }
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><img src="./images/PHP常用的自定义函数0.jpg" alt="" /></p>
<hr />
<h1 id="php序列化serialize与返回序列化unserialeze">php序列化serialize与返回序列化unserialeze</h1>
<p>serialize() 把变量和它们的值编码成文本<br />unserialize() 恢复原先变量</p>
<hr />
<h1 id="创建日志文件">创建日志文件</h1>
<ol>
<li>方法一(适合临时用):</li>

</ol>
<pre><code><code class="hljs"><span class="hljs-comment">//数组/字符串都可以
file_put_contents( <span class="hljs-string">'log.log', date(<span class="hljs-string">'Y-m-d H:i:s',time()) .<span class="hljs-string">' ' . var_export($_REQUEST,<span class="hljs-keyword">true) . <span class="hljs-string">"\r\n", FILE_APPEND);
</span></span></span></span></span></span></code></code></pre>
<ol>
<li>方法二:</li>
</ol>
<p>例: /www.wdmcake.com/data/log/日期/$file文件名</p>
<pre><code><code class="hljs"><span class="hljs-comment">/**
*$str array/str 要写入的内容
*$dir str 日期文件夹里面的新建的文件夹名字  例如 /www.wdmcake.com/data/log/201806/sms_apiaas
*$file string 文件的名字 例:send_log_20180628.log
*/
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">wdmlog<span class="hljs-params">($str,$dir=<span class="hljs-string">'log',$file=<span class="hljs-string">'log')
{
    <span class="hljs-keyword">if (!file_exists(ROOT_PATH . <span class="hljs-string">'data/log/' . date(<span class="hljs-string">'Ym'). <span class="hljs-string">'/' . $dir))
    {
        make_dir(ROOT_PATH . <span class="hljs-string">'data/log/' . date(<span class="hljs-string">'Ym'). <span class="hljs-string">'/' . $dir);
    }
    $str = is_array($str) ? var_export($str,<span class="hljs-keyword">true):$str;
       file_put_contents(ROOT_PATH . <span class="hljs-string">'data/log/' . date(<span class="hljs-string">'Ym'). <span class="hljs-string">'/' . $dir.<span class="hljs-string">'/' . $file .<span class="hljs-string">'_' . date(<span class="hljs-string">'Ymd') . <span class="hljs-string">'.log', local_date(<span class="hljs-string">'Y-m-d H:i:s') .<span class="hljs-string">' ' . $str . <span class="hljs-string">"\r\n", FILE_APPEND);
}    </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>方法三:</li>
</ol>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">create_log<span class="hljs-params">($data,$merchant,$agency,$file=<span class="hljs-string">'')
{
   <span class="hljs-keyword">if(<span class="hljs-keyword">empty($merchant)) <span class="hljs-keyword">die(<span class="hljs-string">"商户code不可为空");
   <span class="hljs-keyword">if(<span class="hljs-keyword">empty($agency)) <span class="hljs-keyword">die(<span class="hljs-string">"平台code不可为空");
   $file_path = ROOT_PATH . <span class="hljs-string">'logdata/'.$merchant.<span class="hljs-string">'/'.$agency;
   <span class="hljs-keyword">if(!is_dir($file_path)){
        mkdir($file_path, <span class="hljs-number">0777, <span class="hljs-keyword">true); 
    }    
    file_put_contents($file_path.<span class="hljs-string">'/'.$agency.<span class="hljs-string">'_' . $file . date(<span class="hljs-string">'Ymd',time()) . <span class="hljs-string">'.log', date(<span class="hljs-string">'Y-m-d H:i:s',time()) .<span class="hljs-string">' ' . var_export($data,<span class="hljs-keyword">true) . <span class="hljs-string">"\r\n", FILE_APPEND);
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="返回二维数组其中一段的数据">返回二维数组其中一段的数据</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * [slice description] 返回二维数组其中一段的数据
 * <span class="hljs-doctag">@param  [type] $arr [description] 传二维关联数组
 * <span class="hljs-doctag">@param  [type] $star [description] 截取的开始位置
 * <span class="hljs-doctag">@param  [type] $length [description] 截取的长度
 * <span class="hljs-doctag">@param  [type] $order [description] 0顺序 -1倒序
 * <span class="hljs-doctag">@param  [type] $preserve [description] 保持索引关系 true - 保留键名 false - 默认。重置键名
 * <span class="hljs-doctag">@return [type]      [description]
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">slice<span class="hljs-params">($arr, $star, $length, $order = <span class="hljs-number">0, $preserve = false)
{
    <span class="hljs-keyword">foreach ($arr <span class="hljs-keyword">as $key =&gt; $value) {
        $arr[$key] = array_slice($value, $star, $length, $preserve);
    }
    <span class="hljs-keyword">if ($order) {
        <span class="hljs-keyword">return array_reverse($arr);
    }
    <span class="hljs-keyword">return $arr;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>例子:</p>
<pre><code><code class="hljs"><span class="hljs-meta">&lt;?php
header(<span class="hljs-string">'Content-Type=text/html;charset:utf8');
$arr = <span class="hljs-keyword">array(
    [
        <span class="hljs-string">'id' =&gt; <span class="hljs-string">'1',
        <span class="hljs-string">'name' =&gt; <span class="hljs-string">'李四',
        <span class="hljs-string">'age' =&gt; <span class="hljs-string">'21',
        <span class="hljs-string">'gender' =&gt; <span class="hljs-string">'男',
    ],
    [
        <span class="hljs-string">'id' =&gt; <span class="hljs-string">'2',
        <span class="hljs-string">'name' =&gt; <span class="hljs-string">'王五',
        <span class="hljs-string">'age' =&gt; <span class="hljs-string">'22',
        <span class="hljs-string">'gender' =&gt; <span class="hljs-string">'男',
    ],

);

<span class="hljs-keyword">echo <span class="hljs-string">'&lt;pre&gt;';
print_r(slice($arr, <span class="hljs-number">0, <span class="hljs-number">2));

<span class="hljs-comment">//打印:
<span class="hljs-comment">// 打印结果:
<span class="hljs-comment">// Array
<span class="hljs-comment">// (
<span class="hljs-comment">//     [0] =&gt; Array
<span class="hljs-comment">//         (
<span class="hljs-comment">//             [id] =&gt; 1
<span class="hljs-comment">//             [name] =&gt; 李四
<span class="hljs-comment">//         )

<span class="hljs-comment">//     [1] =&gt; Array
<span class="hljs-comment">//         (
<span class="hljs-comment">//             [id] =&gt; 2
<span class="hljs-comment">//             [name] =&gt; 王五
<span class="hljs-comment">//         )

<span class="hljs-comment">// )
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取ip地址">获取ip地址</h1>
<ol>
<li>方法一</li>
</ol>
<pre><code><code class="hljs">$_SERVER[<span class="hljs-string">'REMOTE_ADDR']</span></code></code></pre>
<ol>
<li>方法二</li>
</ol>
<pre><code><code class="hljs">    <span class="hljs-comment">/** 
     * 获得访问的IP 
     * Enter description here ... 
     */  
    <span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">getIP<span class="hljs-params">() {  
        <span class="hljs-keyword">return <span class="hljs-keyword">isset($_SERVER[<span class="hljs-string">"HTTP_X_FORWARDED_FOR"])?$_SERVER[<span class="hljs-string">"HTTP_X_FORWARDED_FOR"]  
        :(<span class="hljs-keyword">isset($_SERVER[<span class="hljs-string">"HTTP_CLIENT_IP"])?$_SERVER[<span class="hljs-string">"HTTP_CLIENT_IP"]  
        :$_SERVER[<span class="hljs-string">"REMOTE_ADDR"]);  
    } </span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>方法三</li>
</ol>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 获得用户的真实IP地址
 *
 * <span class="hljs-doctag">@access  public
 * <span class="hljs-doctag">@return  string
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">real_ip<span class="hljs-params">()
{
    <span class="hljs-keyword">static $realip = <span class="hljs-keyword">NULL;

    <span class="hljs-keyword">if ($realip !== <span class="hljs-keyword">NULL)
    {
        <span class="hljs-keyword">return $realip;
    }

    <span class="hljs-keyword">if (<span class="hljs-keyword">isset($_SERVER))
    {
        <span class="hljs-keyword">if (<span class="hljs-keyword">isset($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR']))
        {
            $arr = explode(<span class="hljs-string">',', $_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR']);

            <span class="hljs-comment">/* 取X-Forwarded-For中第一个非unknown的有效IP字符串 */
            <span class="hljs-keyword">foreach ($arr <span class="hljs-keyword">AS $ip)
            {
                $ip = trim($ip);

                <span class="hljs-keyword">if ($ip != <span class="hljs-string">'unknown')
                {
                    $realip = $ip;

                    <span class="hljs-keyword">break;
                }
            }
        }
        <span class="hljs-keyword">elseif (<span class="hljs-keyword">isset($_SERVER[<span class="hljs-string">'HTTP_CLIENT_IP']))
        {
            $realip = $_SERVER[<span class="hljs-string">'HTTP_CLIENT_IP'];
        }
        <span class="hljs-keyword">else
        {
            <span class="hljs-keyword">if (<span class="hljs-keyword">isset($_SERVER[<span class="hljs-string">'REMOTE_ADDR']))
            {
                $realip = $_SERVER[<span class="hljs-string">'REMOTE_ADDR'];
            }
            <span class="hljs-keyword">else
            {
                $realip = <span class="hljs-string">'0.0.0.0';
            }
        }
    }
    <span class="hljs-keyword">else
    {
        <span class="hljs-keyword">if (getenv(<span class="hljs-string">'HTTP_X_FORWARDED_FOR'))
        {
            $realip = getenv(<span class="hljs-string">'HTTP_X_FORWARDED_FOR');
        }
        <span class="hljs-keyword">elseif (getenv(<span class="hljs-string">'HTTP_CLIENT_IP'))
        {
            $realip = getenv(<span class="hljs-string">'HTTP_CLIENT_IP');
        }
        <span class="hljs-keyword">else
        {
            $realip = getenv(<span class="hljs-string">'REMOTE_ADDR');
        }
    }

    preg_match(<span class="hljs-string">"/[\d\.]{7,15}/", $realip, $onlineip);
    $realip = !<span class="hljs-keyword">empty($onlineip[<span class="hljs-number">0]) ? $onlineip[<span class="hljs-number">0] : <span class="hljs-string">'0.0.0.0';

    <span class="hljs-keyword">return $realip;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="php限制ip访问-只允许指定ip访问-允许号通配符过滤ip">PHP限制IP访问 只允许指定IP访问 允许*号通配符过滤IP</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/** 
 * 检测访问的ip是否为规定的允许的ip 
 * Enter description here ... 
 */  
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">check_ip<span class="hljs-params">(){  
    $ALLOWED_IP=<span class="hljs-keyword">array(<span class="hljs-string">'192.168.2.*',<span class="hljs-string">'127.0.0.1',<span class="hljs-string">'192.168.2.49');  
    $IP=getIP();  
    $check_ip_arr= explode(<span class="hljs-string">'.',$IP);<span class="hljs-comment">//要检测的ip拆分成数组  
    <span class="hljs-comment">#限制IP  
    <span class="hljs-keyword">if(!in_array($IP,$ALLOWED_IP)) {  
        <span class="hljs-keyword">foreach ($ALLOWED_IP <span class="hljs-keyword">as $val){  
            <span class="hljs-keyword">if(strpos($val,<span class="hljs-string">'*')!==<span class="hljs-keyword">false){<span class="hljs-comment">//发现有*号替代符  
                 $arr=<span class="hljs-keyword">array();<span class="hljs-comment">//  
                 $arr=explode(<span class="hljs-string">'.', $val);  
                 $bl=<span class="hljs-keyword">true;<span class="hljs-comment">//用于记录循环检测中是否有匹配成功的  
                 <span class="hljs-keyword">for($i=<span class="hljs-number">0;$i&lt;<span class="hljs-number">4;$i++){  
                    <span class="hljs-keyword">if($arr[$i]!=<span class="hljs-string">'*'){<span class="hljs-comment">//不等于*  就要进来检测，如果为*符号替代符就不检查  
                        <span class="hljs-keyword">if($arr[$i]!=$check_ip_arr[$i]){  
                            $bl=<span class="hljs-keyword">false;  
                            <span class="hljs-keyword">break;<span class="hljs-comment">//终止检查本个ip 继续检查下一个ip  
                        }  
                    }  
                 }<span class="hljs-comment">//end for   
                 <span class="hljs-keyword">if($bl){<span class="hljs-comment">//如果是true则找到有一个匹配成功的就返回  
                    <span class="hljs-keyword">return;  
                    <span class="hljs-keyword">die;  
                 }  
            }  
        }<span class="hljs-comment">//end foreach  
        header(<span class="hljs-string">'HTTP/1.1 403 Forbidden');  
        <span class="hljs-keyword">echo <span class="hljs-string">"Access forbidden";  
        <span class="hljs-keyword">die;  
    }  
}  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取地址路径里0到第一个线的部分">获取地址路径里0到第一个\线的部分</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">f_dirname<span class="hljs-params">($f_path){
    <span class="hljs-keyword">return substr($f_path,<span class="hljs-number">0,strrpos($f_path,<span class="hljs-string">'\\'));
}</span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取当前文件所在的文件路径">获取当前文件所在的文件路径</h1>
<pre><code><code class="hljs">define(<span class="hljs-string">'CUR_API_PATH', rtrim(str_replace(<span class="hljs-string">'\\', <span class="hljs-string">'/', dirname(<span class="hljs-keyword">__FILE__)),<span class="hljs-string">'/').<span class="hljs-string">'/');</span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取随机字符串">获取随机字符串</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 随机字符
 * <span class="hljs-doctag">@param int $length 长度
 * <span class="hljs-doctag">@param string $type 类型
 * <span class="hljs-doctag">@param int $convert 转换大小写 1大写 0小写
 * <span class="hljs-doctag">@return string
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">random<span class="hljs-params">($length=<span class="hljs-number">10, $type=<span class="hljs-string">'letter', $convert=<span class="hljs-number">0)
{
    $config = <span class="hljs-keyword">array(
        <span class="hljs-string">'number'=&gt;<span class="hljs-string">'1234567890',
        <span class="hljs-string">'letter'=&gt;<span class="hljs-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
        <span class="hljs-string">'string'=&gt;<span class="hljs-string">'abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789',
        <span class="hljs-string">'all'=&gt;<span class="hljs-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'
    );

    <span class="hljs-keyword">if(!<span class="hljs-keyword">isset($config[$type])) $type = <span class="hljs-string">'letter';
    $string = $config[$type];

    $code = <span class="hljs-string">'';
    $strlen = strlen($string) <span class="hljs-number">-1;
    <span class="hljs-keyword">for($i = <span class="hljs-number">0; $i &lt; $length; $i++){
        $code .= $string{mt_rand(<span class="hljs-number">0, $strlen)};
    }
    <span class="hljs-keyword">if(!<span class="hljs-keyword">empty($convert)){
        $code = ($convert &gt; <span class="hljs-number">0)? strtoupper($code) : strtolower($code);
    }
    <span class="hljs-keyword">return $code;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="中文字符串反转">中文字符串反转</h1>
<p><img src="./images/PHP常用的自定义函数1.jpg" alt="" /></p>
<hr />
<h1 id="检查目标文件夹是否存在如果不存在则自动创建该目录">检查目标文件夹是否存在，如果不存在则自动创建该目录</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 检查目标文件夹是否存在，如果不存在则自动创建该目录
 *
 * <span class="hljs-doctag">@access      public
 * <span class="hljs-doctag">@param       string      folder     目录路径。不能使用相对于网站根目录的URL
 *
 * <span class="hljs-doctag">@return      bool
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">make_dir<span class="hljs-params">($folder)
{
    $reval = <span class="hljs-keyword">false;

    <span class="hljs-keyword">if (!file_exists($folder))
    {
        <span class="hljs-comment">/* 如果目录不存在则尝试创建该目录 */
        @umask(<span class="hljs-number">0);

        <span class="hljs-comment">/* 将目录路径拆分成数组 */
        preg_match_all(<span class="hljs-string">'/([^\/]*)\/?/i', $folder, $atmp);

        <span class="hljs-comment">/* 如果第一个字符为/则当作物理路径处理 */
        $base = ($atmp[<span class="hljs-number">0][<span class="hljs-number">0] == <span class="hljs-string">'/') ? <span class="hljs-string">'/' : <span class="hljs-string">'';

        <span class="hljs-comment">/* 遍历包含路径信息的数组 */
        <span class="hljs-keyword">foreach ($atmp[<span class="hljs-number">1] <span class="hljs-keyword">AS $val)
        {
            <span class="hljs-keyword">if (<span class="hljs-string">'' != $val)
            {
                $base .= $val;

                <span class="hljs-keyword">if (<span class="hljs-string">'..' == $val || <span class="hljs-string">'.' == $val)
                {
                    <span class="hljs-comment">/* 如果目录为.或者..则直接补/继续下一个循环 */
                    $base .= <span class="hljs-string">'/';

                    <span class="hljs-keyword">continue;
                }
            }
            <span class="hljs-keyword">else
            {
                <span class="hljs-keyword">continue;
            }

            $base .= <span class="hljs-string">'/';

            <span class="hljs-keyword">if (!file_exists($base))
            {
                <span class="hljs-comment">/* 尝试创建目录，如果创建失败则继续循环 */
                <span class="hljs-keyword">if (@mkdir(rtrim($base, <span class="hljs-string">'/'), <span class="hljs-number">0777))
                {
                    @chmod($base, <span class="hljs-number">0777);
                    $reval = <span class="hljs-keyword">true;
                }
            }
        }
    }
    <span class="hljs-keyword">else
    {
        <span class="hljs-comment">/* 路径已经存在。返回该路径是不是一个目录 */
        $reval = is_dir($folder);
    }

    clearstatcache();

    <span class="hljs-keyword">return $reval;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="默认获得文件修改时间">默认获得文件修改时间</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">filetime<span class="hljs-params">($way,$char=<span class="hljs-string">'m'){
    date_default_timezone_set(<span class="hljs-string">'PRC');
    <span class="hljs-keyword">switch($char){
        <span class="hljs-keyword">case <span class="hljs-string">'c':$localtime = date(<span class="hljs-string">'Y-m-d H:i:s',filectime($way));
        <span class="hljs-keyword">break;
        <span class="hljs-keyword">case <span class="hljs-string">'m':$localtime = date(<span class="hljs-string">'Y-m-d H:i:s',filemtime($way));
        <span class="hljs-keyword">break;
        <span class="hljs-keyword">case <span class="hljs-string">'a':$localtime = date(<span class="hljs-string">'Y-m-d H:i:s',fileatime($way));
        <span class="hljs-keyword">break;
    }
    <span class="hljs-keyword">return $localtime;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="判断后缀类型">判断后缀类型</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">suffixtype<span class="hljs-params">($f_path){
    $info = pathinfo($f_path);
    $f_type = <span class="hljs-string">'file';
    <span class="hljs-keyword">switch(strtolower(@$info[<span class="hljs-string">"extension"])){
        <span class="hljs-keyword">case <span class="hljs-string">'jpg':<span class="hljs-keyword">case <span class="hljs-string">'jpeg':<span class="hljs-keyword">case <span class="hljs-string">'gif':
        <span class="hljs-keyword">case <span class="hljs-string">'png':<span class="hljs-keyword">case <span class="hljs-string">'bmp':$f_type = <span class="hljs-string">'image';<span class="hljs-keyword">break;
        <span class="hljs-keyword">case <span class="hljs-string">'pl':<span class="hljs-keyword">case <span class="hljs-string">'c':<span class="hljs-keyword">case <span class="hljs-string">'cpp':<span class="hljs-keyword">case <span class="hljs-string">'log':<span class="hljs-keyword">case <span class="hljs-string">'asp':<span class="hljs-keyword">case <span class="hljs-string">'php':<span class="hljs-keyword">case <span class="hljs-string">'jsp':<span class="hljs-keyword">case <span class="hljs-string">'txt':<span class="hljs-keyword">case <span class="hljs-string">'xml':<span class="hljs-keyword">case <span class="hljs-string">'html':<span class="hljs-keyword">case <span class="hljs-string">'htm':<span class="hljs-keyword">case <span class="hljs-string">'phtml':<span class="hljs-keyword">case <span class="hljs-string">'jhtml':<span class="hljs-keyword">case <span class="hljs-string">'java':<span class="hljs-keyword">case <span class="hljs-string">'cfg':<span class="hljs-keyword">case <span class="hljs-string">'ini':
        <span class="hljs-keyword">case <span class="hljs-string">'text':<span class="hljs-keyword">case <span class="hljs-string">'bat':$f_type = <span class="hljs-string">'text';<span class="hljs-keyword">break;
    }
    <span class="hljs-keyword">return $f_type;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="检查文件类型">检查文件类型</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 检查文件类型
 *
 * <span class="hljs-doctag">@access      public
 * <span class="hljs-doctag">@param       string      filename            文件名
 * <span class="hljs-doctag">@param       string      realname            真实文件名
 * <span class="hljs-doctag">@param       string      limit_ext_types     允许的文件类型
 * <span class="hljs-doctag">@return      string
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">check_file_type<span class="hljs-params">($filename, $realname = <span class="hljs-string">'', $limit_ext_types = <span class="hljs-string">'')
{
    <span class="hljs-keyword">if ($realname)
    {
        $extname = strtolower(substr($realname, strrpos($realname, <span class="hljs-string">'.') + <span class="hljs-number">1));
    }
    <span class="hljs-keyword">else
    {
        $extname = strtolower(substr($filename, strrpos($filename, <span class="hljs-string">'.') + <span class="hljs-number">1));
    }

    <span class="hljs-keyword">if ($limit_ext_types &amp;&amp; stristr($limit_ext_types, <span class="hljs-string">'|' . $extname . <span class="hljs-string">'|') === <span class="hljs-keyword">false)
    {
        <span class="hljs-keyword">return <span class="hljs-string">'';
    }

    $str = $format = <span class="hljs-string">'';

    $file = @fopen($filename, <span class="hljs-string">'rb');
    <span class="hljs-keyword">if ($file)
    {
        $str = @fread($file, <span class="hljs-number">0x400); <span class="hljs-comment">// 读取前 1024 个字节
        @fclose($file);
    }
    <span class="hljs-keyword">else
    {
        <span class="hljs-keyword">if (stristr($filename, ROOT_PATH) === <span class="hljs-keyword">false)
        {
            <span class="hljs-keyword">if ($extname == <span class="hljs-string">'jpg' || $extname == <span class="hljs-string">'jpeg' || $extname == <span class="hljs-string">'gif' || $extname == <span class="hljs-string">'png' || $extname == <span class="hljs-string">'doc' ||
                $extname == <span class="hljs-string">'xls' || $extname == <span class="hljs-string">'txt'  || $extname == <span class="hljs-string">'zip' || $extname == <span class="hljs-string">'rar' || $extname == <span class="hljs-string">'ppt' ||
                $extname == <span class="hljs-string">'pdf' || $extname == <span class="hljs-string">'rm'   || $extname == <span class="hljs-string">'mid' || $extname == <span class="hljs-string">'wav' || $extname == <span class="hljs-string">'bmp' ||
                $extname == <span class="hljs-string">'swf' || $extname == <span class="hljs-string">'chm'  || $extname == <span class="hljs-string">'sql' || $extname == <span class="hljs-string">'cert'|| $extname == <span class="hljs-string">'pptx' || 
                $extname == <span class="hljs-string">'xlsx' || $extname == <span class="hljs-string">'docx')
            {
                $format = $extname;
            }
        }
        <span class="hljs-keyword">else
        {
            <span class="hljs-keyword">return <span class="hljs-string">'';
        }
    }

    <span class="hljs-keyword">if ($format == <span class="hljs-string">'' &amp;&amp; strlen($str) &gt;= <span class="hljs-number">2 )
    {
        <span class="hljs-keyword">if (substr($str, <span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">'MThd' &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'mid';
        }
        <span class="hljs-keyword">elseif (substr($str, <span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">'RIFF' &amp;&amp; $extname == <span class="hljs-string">'wav')
        {
            $format = <span class="hljs-string">'wav';
        }
        <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">3) == <span class="hljs-string">"\xFF\xD8\xFF")
        {
            $format = <span class="hljs-string">'jpg';
        }
        <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">'GIF8' &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'gif';
        }
        <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">8) == <span class="hljs-string">"\x89\x50\x4E\x47\x0D\x0A\x1A\x0A")
        {
            $format = <span class="hljs-string">'png';
        }
        <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">2) == <span class="hljs-string">'BM' &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'bmp';
        }
        <span class="hljs-keyword">elseif ((substr($str ,<span class="hljs-number">0, <span class="hljs-number">3) == <span class="hljs-string">'CWS' || substr($str ,<span class="hljs-number">0, <span class="hljs-number">3) == <span class="hljs-string">'FWS') &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'swf';
        }
        <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">"\xD0\xCF\x11\xE0")
        {   <span class="hljs-comment">// D0CF11E == DOCFILE == Microsoft Office Document
            <span class="hljs-keyword">if (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">4) == <span class="hljs-string">"\xEC\xA5\xC1\x00" || $extname == <span class="hljs-string">'doc')
            {
                $format = <span class="hljs-string">'doc';
            }
            <span class="hljs-keyword">elseif (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">2) == <span class="hljs-string">"\x09\x08" || $extname == <span class="hljs-string">'xls')
            {
                $format = <span class="hljs-string">'xls';
            } <span class="hljs-keyword">elseif (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">4) == <span class="hljs-string">"\xFD\xFF\xFF\xFF" || $extname == <span class="hljs-string">'ppt')
            {
                $format = <span class="hljs-string">'ppt';
            }
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">"PK\x03\x04")
        {
            <span class="hljs-keyword">if (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">4) == <span class="hljs-string">"\xEC\xA5\xC1\x00" || $extname == <span class="hljs-string">'docx')
            {
                $format = <span class="hljs-string">'docx';
            }
            <span class="hljs-keyword">elseif (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">2) == <span class="hljs-string">"\x09\x08" || $extname == <span class="hljs-string">'xlsx')
            {
                $format = <span class="hljs-string">'xlsx';
            } <span class="hljs-keyword">elseif (substr($str,<span class="hljs-number">0x200,<span class="hljs-number">4) == <span class="hljs-string">"\xFD\xFF\xFF\xFF" || $extname == <span class="hljs-string">'pptx')
            {
                $format = <span class="hljs-string">'pptx';
            }<span class="hljs-keyword">else
            {
                $format = <span class="hljs-string">'zip';
            }
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">'Rar!' &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'rar';
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">"\x25PDF")
        {
            $format = <span class="hljs-string">'pdf';
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">3) == <span class="hljs-string">"\x30\x82\x0A")
        {
            $format = <span class="hljs-string">'cert';
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">'ITSF' &amp;&amp; $extname != <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'chm';
        } <span class="hljs-keyword">elseif (substr($str ,<span class="hljs-number">0, <span class="hljs-number">4) == <span class="hljs-string">"\x2ERMF")
        {
            $format = <span class="hljs-string">'rm';
        } <span class="hljs-keyword">elseif ($extname == <span class="hljs-string">'sql')
        {
            $format = <span class="hljs-string">'sql';
        } <span class="hljs-keyword">elseif ($extname == <span class="hljs-string">'txt')
        {
            $format = <span class="hljs-string">'txt';
        }
    }

    <span class="hljs-keyword">if ($limit_ext_types &amp;&amp; stristr($limit_ext_types, <span class="hljs-string">'|' . $format . <span class="hljs-string">'|') === <span class="hljs-keyword">false)
    {
        $format = <span class="hljs-string">'';
    }

    <span class="hljs-keyword">return $format;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="获取文件后缀名并判断是否在定义的数组中">获取文件后缀名,并判断是否在定义的数组中</h1>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * 获取文件后缀名,并判断是否合法
 *
 * <span class="hljs-doctag">@param string $file_name //是一个文件的路径
 * <span class="hljs-doctag">@param array $allow_type //需要的文件类型数组
 * <span class="hljs-doctag">@return blob
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">get_file_suffix<span class="hljs-params">($file_name, $allow_type = array<span class="hljs-params">())
{
    $file_suffix = strtolower(array_pop(explode(<span class="hljs-string">'.', $file_name)));
    <span class="hljs-keyword">if (<span class="hljs-keyword">empty($allow_type))
    {
        <span class="hljs-keyword">return $file_suffix;
    }
    <span class="hljs-keyword">else
    {
        <span class="hljs-keyword">if (in_array($file_suffix, $allow_type))
        {
            <span class="hljs-keyword">return <span class="hljs-keyword">true;
        }
        <span class="hljs-keyword">else
        {
            <span class="hljs-keyword">return <span class="hljs-keyword">false;
        }
    }
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="判断路径是文件还是目录">判断路径是文件还是目录</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">f_type<span class="hljs-params">($f_path){
    <span class="hljs-keyword">return is_dir($f_path)?<span class="hljs-string">'dir':suffixtype($f_path);
}</span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="计算文件或目录字节大小">计算文件或目录字节大小</h1>
<pre><code><code class="hljs"><span class="hljs-comment">//计算文件或目录字节大小
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">bytesize_calc<span class="hljs-params">($f_path){
    <span class="hljs-keyword">if(!is_dir($f_path)){
        <span class="hljs-keyword">return sprintf(<span class="hljs-string">"%u", filesize($f_path));}
    $bytesize = <span class="hljs-number">0;
    $f_arr = scandir($f_path);
    $size = count($f_arr);
    <span class="hljs-keyword">for($i=<span class="hljs-number">0;$i&lt;$size;$i++){
        <span class="hljs-keyword">if(<span class="hljs-string">'.'==$f_arr[$i]||<span class="hljs-string">'..'==$f_arr[$i])<span class="hljs-keyword">continue;
        $file_or_dir = $f_path.<span class="hljs-string">'/'.$f_arr[$i];
        $bytesize += bytesize_calc($file_or_dir);
    }
    <span class="hljs-keyword">return $bytesize;
}
<span class="hljs-comment">//获得文件大小
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">f_size<span class="hljs-params">($f_path){
    <span class="hljs-keyword">return size_formate(bytesize_calc($f_path));
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="接收异步过来的get消息">接收异步过来的get消息</h1>
<pre><code><code class="hljs">    $sms_result_data = $_GET;   <span class="hljs-comment">//用这种
    $param = request()-&gt;param(); <span class="hljs-comment">//thinkphp5接收消息
    $sms_result_data1 = file_get_contents(<span class="hljs-string">"php://input");</span></span></span></code></code></pre>
<hr />
<h1 id="curl之get请求">curl之get请求</h1>
<pre><code><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">_curl_get<span class="hljs-params">($urldata)
{
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL,$urldata);
    curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1);
    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword">false);<span class="hljs-comment">//不验证SSL证书。
    $data = curl_exec($ch);
    curl_close($ch);
    <span class="hljs-keyword">if ($data)
        <span class="hljs-keyword">return $data;
    <span class="hljs-keyword">else
        <span class="hljs-keyword">return <span class="hljs-keyword">false;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="curl之post请求">curl之post请求</h1>
<p><strong>如果是有图片要上传加下面用这行代码</strong></p>
<blockquote>
<p>curl_file_create(ROOT_PATH.'public'.$value["goods_img"]);</p>
</blockquote>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * [post description]
 * <span class="hljs-doctag">@param  [type]  $url       [请求的url]
 * <span class="hljs-doctag">@param  string  $post_data [请求的数据]
 * <span class="hljs-doctag">@param  integer $timeout   [请求超时时间]
 * <span class="hljs-doctag">@return [type]  $Mix     [混合数据json|array|obj]
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">post<span class="hljs-params">($url, $post_data = <span class="hljs-string">'', $timeout = <span class="hljs-number">3000)
{
    header(<span class="hljs-string">"Content-type:text/html;charset=utf-8");
    $ch = curl_init();
    curl_setopt ($ch, CURLOPT_URL, $url);
    curl_setopt ($ch, CURLOPT_POST, <span class="hljs-number">1);
    curl_setopt ($ch, CURLOPT_POSTFIELDS, $post_data);
    curl_setopt ($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1);
    curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, $timeout);
    curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-keyword">false);
    $file_contents = curl_exec($ch);
    curl_close($ch); 
    <span class="hljs-keyword">if ($content){
        <span class="hljs-keyword">return $file_contents;
    }<span class="hljs-keyword">else{
        <span class="hljs-keyword">return <span class="hljs-keyword">false;
    }       
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="curl之post_get请求">curl之post_get请求</h1>
<p><strong>如果是有图片要上传加下面用这行代码</strong></p>
<blockquote>
<p>curl_file_create(ROOT_PATH.'public'.$value["goods_img"]);</p>
</blockquote>
<ol>
<li>方法一</li>
</ol>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * [_curl_post_get description]
 * 如果$data为空转为get请求.https不验证证书
 * <span class="hljs-doctag">@param  [type]  $url     [url]
 * <span class="hljs-doctag">@param  array   $data    [要传的数据]
 * <span class="hljs-doctag">@param  integer $timeout [设置请求超时的时间]
 * <span class="hljs-doctag">@return [type]  $Mix     [混合数据json|array|obj]
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">_curl_post<span class="hljs-params">($url, $data = <span class="hljs-string">'',$timeout = <span class="hljs-number">3000) {
    header(<span class="hljs-string">"Content-type:text/html;charset=utf-8");
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);  <span class="hljs-comment">//请求的url
    curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-keyword">false);  <span class="hljs-comment">////是否携带head头信息 ture / error
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1);  <span class="hljs-comment">//返回数据还是打印数据 0,直接输出 1,返回
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout); <span class="hljs-comment">//设置请求超时的时间
    <span class="hljs-comment">// https请求 不验证证书和hosts方法:
    <span class="hljs-keyword">if (strlen($url) &gt; <span class="hljs-number">5 &amp;&amp; strtolower(substr($url, <span class="hljs-number">0, <span class="hljs-number">5)) == <span class="hljs-string">"https")
    <span class="hljs-comment">//if (1 == strpos("$".$url, "https://")) //效果同上面
    {
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword">false); 
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword">false);
    }
    <span class="hljs-keyword">if(!<span class="hljs-keyword">empty($post_data)){
        curl_setopt($ch, CURLOPT_POST,<span class="hljs-number">1); <span class="hljs-comment">//设置post方式请求,如果不写默认为get方式
        curl_setopt($ch, CURLOPT_POSTFIELDS,$data); <span class="hljs-comment">//要传递的参数
    }       

    <span class="hljs-comment">//发送请求 并接收数据赋值给$data
    $data = curl_exec($ch);  
    <span class="hljs-comment">//关闭请求资源
    curl_close($ch);   
    $content = iconv(<span class="hljs-string">'gb2312', <span class="hljs-string">'utf-8//IGNORE',$data); <span class="hljs-comment">//修改字符编码

    <span class="hljs-keyword">if ($content)
        <span class="hljs-keyword">return $content;
    <span class="hljs-keyword">else
        <span class="hljs-keyword">return <span class="hljs-keyword">false;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>方法二</li>
</ol>
<pre><code><code class="hljs"><span class="hljs-comment">/**
 * curl访问
 * <span class="hljs-doctag">@author rainfer &lt;81818832<span class="hljs-doctag">@qq.com&gt;
 * <span class="hljs-doctag">@param  string $url
 * <span class="hljs-doctag">@param string $type
 * <span class="hljs-doctag">@param boolean $data
 * <span class="hljs-doctag">@param string $err_msg
 * <span class="hljs-doctag">@param int $timeout
 * <span class="hljs-doctag">@param array $cert_info
 * <span class="hljs-doctag">@return string
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">go_curl<span class="hljs-params">($url, $type, $data = false, &amp;$err_msg = null, $timeout = <span class="hljs-number">20, $cert_info = array<span class="hljs-params">())
{
    $type = strtoupper($type);
    <span class="hljs-keyword">if ($type == <span class="hljs-string">'GET' &amp;&amp; is_array($data)) {
        $data = http_build_query($data);
    }
    $option = <span class="hljs-keyword">array();
    <span class="hljs-keyword">if ( $type == <span class="hljs-string">'POST' ) {
        $option[CURLOPT_POST] = <span class="hljs-number">1;
    }
    <span class="hljs-keyword">if ($data) {
        <span class="hljs-keyword">if ($type == <span class="hljs-string">'POST') {
            $option[CURLOPT_POSTFIELDS] = $data;
        } <span class="hljs-keyword">elseif ($type == <span class="hljs-string">'GET') {
            $url = strpos($url, <span class="hljs-string">'?') !== <span class="hljs-keyword">false ? $url.<span class="hljs-string">'&amp;'.$data :  $url.<span class="hljs-string">'?'.$data;
        }
    }
    $option[CURLOPT_URL]            = $url;
    $option[CURLOPT_FOLLOWLOCATION] = <span class="hljs-keyword">TRUE;
    $option[CURLOPT_MAXREDIRS]      = <span class="hljs-number">4;
    $option[CURLOPT_RETURNTRANSFER] = <span class="hljs-keyword">TRUE;
    $option[CURLOPT_TIMEOUT]        = $timeout;
    <span class="hljs-comment">//设置证书信息
    <span class="hljs-keyword">if(!<span class="hljs-keyword">empty($cert_info) &amp;&amp; !<span class="hljs-keyword">empty($cert_info[<span class="hljs-string">'cert_file'])) {
        $option[CURLOPT_SSLCERT]       = $cert_info[<span class="hljs-string">'cert_file'];
        $option[CURLOPT_SSLCERTPASSWD] = $cert_info[<span class="hljs-string">'cert_pass'];
        $option[CURLOPT_SSLCERTTYPE]   = $cert_info[<span class="hljs-string">'cert_type'];
    }
    <span class="hljs-comment">//设置CA
    <span class="hljs-keyword">if(!<span class="hljs-keyword">empty($cert_info[<span class="hljs-string">'ca_file'])) {
        <span class="hljs-comment">// 对认证证书来源的检查，0表示阻止对证书的合法性的检查。1需要设置CURLOPT_CAINFO
        $option[CURLOPT_SSL_VERIFYPEER] = <span class="hljs-number">1;
        $option[CURLOPT_CAINFO] = $cert_info[<span class="hljs-string">'ca_file'];
    } <span class="hljs-keyword">else {
        <span class="hljs-comment">// 对认证证书来源的检查，0表示阻止对证书的合法性的检查。1需要设置CURLOPT_CAINFO
        $option[CURLOPT_SSL_VERIFYPEER] = <span class="hljs-number">0;
    }
    $ch = curl_init();
    curl_setopt_array($ch, $option);
    $response = curl_exec($ch);
    $curl_no  = curl_errno($ch);
    $curl_err = curl_error($ch);
    curl_close($ch);
    <span class="hljs-comment">// error_log
    <span class="hljs-keyword">if($curl_no &gt; <span class="hljs-number">0) {
        <span class="hljs-keyword">if($err_msg !== <span class="hljs-keyword">null) {
            $err_msg = <span class="hljs-string">'('.$curl_no.<span class="hljs-string">')'.$curl_err;
        }
    }
    <span class="hljs-keyword">return $response;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>方法三</li>
</ol>
<pre><code><code class="hljs"><span class="hljs-comment">//curl模拟post发送请求
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">curl_sent<span class="hljs-params">($url, $postFields = null)
{
    $header = <span class="hljs-keyword">array(
            <span class="hljs-comment">// 'Content-Type: application/json',
            <span class="hljs-string">'Content-Type: application/x-www-form-urlencoded'
    );
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
    curl_setopt($ch, CURLOPT_FAILONERROR, <span class="hljs-keyword">false);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword">true);
    <span class="hljs-comment">// https 请求
    <span class="hljs-keyword">if (strlen($url) &gt; <span class="hljs-number">5 &amp;&amp; strtolower(substr($url, <span class="hljs-number">0, <span class="hljs-number">5)) == <span class="hljs-string">"https")
    {
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword">false);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword">false);
    }

    <span class="hljs-keyword">if (is_array($postFields) &amp;&amp; <span class="hljs-number">0 &lt; count($postFields))
    {
        curl_setopt($ch, CURLOPT_POST, <span class="hljs-keyword">true);
        $postMultipart = <span class="hljs-keyword">false;
        <span class="hljs-keyword">foreach ($postFields <span class="hljs-keyword">as $k =&gt; $v)
        {
            <span class="hljs-keyword">if (<span class="hljs-string">'@' == substr($v, <span class="hljs-number">0, <span class="hljs-number">1))
            {
                $postMultipart = <span class="hljs-keyword">true;
                <span class="hljs-keyword">break;
            }
        }
        <span class="hljs-keyword">unset($k, $v);
        <span class="hljs-keyword">if ($postMultipart) {
            curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields);
        } <span class="hljs-keyword">else {
            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($postFields));
        }
    }
    $reponse = curl_exec($ch);

    <span class="hljs-keyword">if (curl_errno($ch))
    {
        <span class="hljs-keyword">throw <span class="hljs-keyword">new JosSdkException(curl_error($ch), <span class="hljs-number">0);
    } <span class="hljs-keyword">else {
        $httpStatusCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        <span class="hljs-keyword">if (<span class="hljs-number">200 !== $httpStatusCode)
        {
            <span class="hljs-keyword">throw <span class="hljs-keyword">new JosSdkException($reponse, $httpStatusCode);
        }
    }
    curl_close($ch);
    <span class="hljs-keyword">return $reponse;
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>方法四**:</p>
<pre><code><code class="hljs">    <span class="hljs-keyword">public $connectTimeout = <span class="hljs-number">0;

    <span class="hljs-keyword">public $readTimeout = <span class="hljs-number">0;
    <span class="hljs-keyword">public <span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">curl<span class="hljs-params">($url, $postFields = null)
    {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_FAILONERROR, <span class="hljs-keyword">false);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword">true);
        <span class="hljs-keyword">if (<span class="hljs-keyword">$this-&gt;readTimeout) {
            curl_setopt($ch, CURLOPT_TIMEOUT, <span class="hljs-keyword">$this-&gt;readTimeout);
        }
        <span class="hljs-keyword">if (<span class="hljs-keyword">$this-&gt;connectTimeout) {
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, <span class="hljs-keyword">$this-&gt;connectTimeout);
        }
        <span class="hljs-comment">//https 请求
        <span class="hljs-keyword">if(strlen($url) &gt; <span class="hljs-number">5 &amp;&amp; strtolower(substr($url,<span class="hljs-number">0,<span class="hljs-number">5)) == <span class="hljs-string">"https" ) {
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword">false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword">false);
        }

        <span class="hljs-keyword">if (is_array($postFields) &amp;&amp; <span class="hljs-number">0 &lt; count($postFields))
        {
            $postBodyString = <span class="hljs-string">"";
            $postMultipart = <span class="hljs-keyword">false;
            <span class="hljs-keyword">foreach ($postFields <span class="hljs-keyword">as $k =&gt; $v)
            {
                <span class="hljs-keyword">if(<span class="hljs-string">"@" != substr($v, <span class="hljs-number">0, <span class="hljs-number">1))<span class="hljs-comment">//判断是不是文件上传
                {
                    $postBodyString .= <span class="hljs-string">"$k=" . urlencode($v) . <span class="hljs-string">"&amp;"; 
                }
                <span class="hljs-keyword">else<span class="hljs-comment">//文件上传用multipart/form-data，否则用www-form-urlencoded
                {
                    $postMultipart = <span class="hljs-keyword">true;
                }
            }
            <span class="hljs-keyword">unset($k, $v);
            curl_setopt($ch, CURLOPT_POST, <span class="hljs-keyword">true);
            <span class="hljs-keyword">if ($postMultipart)
            {
                curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields);
            }
            <span class="hljs-keyword">else
            {
                curl_setopt($ch, CURLOPT_POSTFIELDS, substr($postBodyString,<span class="hljs-number">0,<span class="hljs-number">-1));
            }
        }
        $reponse = curl_exec($ch);
        $reponse = iconv(<span class="hljs-string">'gb2312', <span class="hljs-string">'utf-8//IGNORE',$reponse); <span class="hljs-comment">//修改字符编码
        create_log(<span class="hljs-string">'第'.<span class="hljs-keyword">__LINE__.<span class="hljs-string">'行', <span class="hljs-string">'wdm', <span class="hljs-string">'jdomnic', <span class="hljs-string">'curl');
        create_log($reponse, <span class="hljs-string">'wdm', <span class="hljs-string">'jdomnic', <span class="hljs-string">'curl');
        <span class="hljs-keyword">if (curl_errno($ch))
        {
            <span class="hljs-keyword">throw <span class="hljs-keyword">new <span class="hljs-keyword">Exception(curl_error($ch),<span class="hljs-number">0);
        }
        <span class="hljs-keyword">else
        {
            $httpStatusCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            <span class="hljs-keyword">if (<span class="hljs-number">200 !== $httpStatusCode)
            {
                <span class="hljs-keyword">throw <span class="hljs-keyword">new <span class="hljs-keyword">Exception($reponse,$httpStatusCode);
            }
        }
        curl_close($ch);
        <span class="hljs-keyword">return $reponse;
    }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="判断数组类型参数是否含有空元素值">判断数组类型参数是否含有空元素值</h1>
<pre><code><code class="hljs"><span class="hljs-comment">//$param array
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">is_arraynull<span class="hljs-params">($param){
    <span class="hljs-keyword">if(!is_array($param)){
        <span class="hljs-keyword">return <span class="hljs-string">'0';
    }<span class="hljs-keyword">else{
        <span class="hljs-keyword">foreach ($param <span class="hljs-keyword">as $key =&gt; $value) {
            <span class="hljs-keyword">if($value!=<span class="hljs-string">''){
                $ret = is_arraynull($value);
            }<span class="hljs-keyword">else{
                <span class="hljs-keyword">return  <span class="hljs-number">1;
            }
        }
    }
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<hr />
<h1 id="判断是否传入必要参数">判断是否传入必要参数</h1>
<pre><code><code class="hljs">  <span class="hljs-comment">/**
   * 判断是否传入必要参数
   * <span class="hljs-doctag">@param  [type] $inter_param [description]
   * <span class="hljs-doctag">@param  [type] $agency      [description]
   * <span class="hljs-doctag">@param  [type] $merchant    [description]
   * <span class="hljs-doctag">@return [type]              [description]
   */
  <span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">judge_parameter<span class="hljs-params">($param){
            <span class="hljs-keyword">if(!<span class="hljs-keyword">isset($param[<span class="hljs-string">'inter_param']) || !<span class="hljs-keyword">isset($param[<span class="hljs-string">'agency']) || !<span class="hljs-keyword">isset($param[<span class="hljs-string">'merchant'])){
                <span class="hljs-keyword">return <span class="hljs-keyword">false;
            }
            <span class="hljs-keyword">if(<span class="hljs-keyword">empty($param[<span class="hljs-string">'inter_param']) || <span class="hljs-keyword">empty($param[<span class="hljs-string">'agency']) || <span class="hljs-keyword">empty($param[<span class="hljs-string">'merchant'])){
                <span class="hljs-keyword">return <span class="hljs-keyword">false;
            }
            <span class="hljs-keyword">return <span class="hljs-keyword">true;
  }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>

<src id="MySignature">转自[Haima的博客] http://www.cnblogs.com/haima/

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
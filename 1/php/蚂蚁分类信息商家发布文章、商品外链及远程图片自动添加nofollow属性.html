<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修蚂蚁分类信息商家发布文章、商品外链及远程图片自动添加nofollow属性' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>蚂蚁分类信息商家发布文章、商品外链及远程图片自动添加nofollow属性</center></div><div class='banquan'>原文出处:本文由博客园博主0516buycn提供。<br/>
原文连接:https://www.cnblogs.com/0516buycn/p/11042127.html</div><br>
    <p>蚂蚁商户发布文章、商品是可以添加外链或者直接用外部图片，但是这对分类网站运营不利。 所以要对外链进行过滤，演示网站<a title="保洁" href="http://www.cleaning8.com" target="_blank">保洁</a>，蚂蚁分类的源码。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下面就说下怎么处理自动给外链自动加上nofollow属性。</p>
<p>&nbsp;</p>
<p>1、添加过滤外链函数</p>
<p>打开/include/global.php 添加处理函数</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<src class="line number1 index0 alt2">1
<src class="line number2 index1 alt1">2
<src class="line number3 index2 alt2">3
<src class="line number4 index3 alt1">4
<src class="line number5 index4 alt2">5
<src class="line number6 index5 alt1">6
<src class="line number7 index6 alt2">7
<src class="line number8 index7 alt1">8
<src class="line number9 index8 alt2">9
<src class="line number10 index9 alt1">10
<src class="line number11 index10 alt2">11
<src class="line number12 index11 alt1">12
<src class="line number13 index12 alt2">13
<src class="line number14 index13 alt1">14
<src class="line number15 index14 alt2">15
</td>
<td class="code">
<src class="container">
<src class="line number1 index0 alt2"><code class="php keyword">function</code>&nbsp;<code class="php plain">tsNofollow(</code><code class="php variable">$content</code><code class="php plain">,</code><code class="php variable">$domain</code><code class="php plain">=</code><code class="php string">"https://www.0516fangchan.com"</code><code class="php plain">){</code>
<src class="line number2 index1 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">preg_match_all(</code><code class="php string">'/href="(.*?)"/'</code><code class="php plain">,</code><code class="php variable">$content</code><code class="php plain">,</code><code class="php variable">$matches</code><code class="php plain">);</code>
<src class="line number3 index2 alt2"><code class="php spaces">&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$matches</code><code class="php plain">){</code>
<src class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">foreach</code><code class="php plain">(</code><code class="php variable">$matches</code><code class="php plain">[1]&nbsp;</code><code class="php keyword">as</code>&nbsp;<code class="php variable">$val</code><code class="php plain">){</code>
<src class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(&nbsp;</code><code class="php functions">strpos</code><code class="php plain">(</code><code class="php variable">$val</code><code class="php plain">,</code><code class="php variable">$domain</code><code class="php plain">)===false&nbsp;)&nbsp;</code><code class="php variable">$content</code><code class="php plain">=</code><code class="php functions">str_replace</code><code class="php plain">(</code><code class="php string">'href="'</code><code class="php plain">.</code><code class="php variable">$val</code><code class="php plain">.</code><code class="php string">'"'</code><code class="php plain">,&nbsp;</code><code class="php string">'href="'</code><code class="php plain">.</code><code class="php variable">$val</code><code class="php plain">.</code><code class="php string">'"&nbsp;rel="external&nbsp;nofollow"&nbsp;'</code><code class="php plain">,</code><code class="php variable">$content</code><code class="php plain">);</code>
<src class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code>
<src class="line number7 index6 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">}</code>
<src class="line number8 index7 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">preg_match_all(</code><code class="php string">'/src="(.*?)"/'</code><code class="php plain">,</code><code class="php variable">$content</code><code class="php plain">,</code><code class="php variable">$matches</code><code class="php plain">);</code>
<src class="line number9 index8 alt2"><code class="php spaces">&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$matches</code><code class="php plain">){</code>
<src class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">foreach</code><code class="php plain">(</code><code class="php variable">$matches</code><code class="php plain">[1]&nbsp;</code><code class="php keyword">as</code>&nbsp;<code class="php variable">$val</code><code class="php plain">){</code>
<src class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(&nbsp;</code><code class="php functions">strpos</code><code class="php plain">(</code><code class="php variable">$val</code><code class="php plain">,</code><code class="php variable">$domain</code><code class="php plain">)===false&nbsp;)&nbsp;</code><code class="php variable">$content</code><code class="php plain">=</code><code class="php functions">str_replace</code><code class="php plain">(</code><code class="php string">'src="'</code><code class="php plain">.</code><code class="php variable">$val</code><code class="php plain">.</code><code class="php string">'"'</code><code class="php plain">,&nbsp;</code><code class="php string">'src="'</code><code class="php plain">.</code><code class="php variable">$val</code><code class="php plain">.</code><code class="php string">'"&nbsp;rel="external&nbsp;nofollow"&nbsp;'</code><code class="php plain">,</code><code class="php variable">$content</code><code class="php plain">);</code>
<src class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code>
<src class="line number13 index12 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">}</code>
<src class="line number14 index13 alt1"><code class="php spaces">&nbsp;</code><code class="php keyword">return</code>&nbsp;<code class="php variable">$content</code><code class="php plain">;</code>
<src class="line number15 index14 alt2"><code class="php plain">}</code>

</td>
</tr>
</tbody>
</table>
<p>*$domain 是不用过滤的域名，全部过滤就不用给默认值</p>
<p>&nbsp;</p>
<p>2、发布文章调用处理函数</p>
<p>打开/member/include/inc_document.php查找$content = isset($_POST['content'])在后面添加</p>
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<src class="line number1 index0 alt2">1
</td>
<td class="code">
<src class="container">
<src class="line number1 index0 alt2"><code class="php variable">$content</code>&nbsp;<code class="php plain">=&nbsp;addNofollow(</code><code class="php functions">stripslashes</code><code class="php plain">(</code><code class="php variable">$content</code><code class="php plain">));</code>

</td>
</tr>
</tbody>
</table>
<p>*注意必须要加stripslashes先处理文章的转义字符</p>
<p>&nbsp;</p>
<p>这样就处理完毕了，商品也是类似处理。</p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
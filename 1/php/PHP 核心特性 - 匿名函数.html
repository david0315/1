<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修PHP 核心特性 - 匿名函数' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>PHP 核心特性 - 匿名函数</center></div><div class='banquan'>原文出处:本文由博客园博主程序媛的明天提供。<br/>
原文连接:https://www.cnblogs.com/a609251438/p/11844920.html</div><br>
    <p>&nbsp;</p>
<h2 style="box-sizing: border-box; padding: 0px 0px 0.3em; font-family: Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif; line-height: 1.225; margin: 1.2em 0px 20px; font-size: 1.3em; position: relative; border-bottom: 1px solid #eeeeee; color: #636b6f;">提出</h2>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">在匿名函数出现之前，所有的函数都需要先命名才能使用</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">function</span> increment(<span style="color: #800080;">$value</span><span style="color: #000000;">)
</span><span style="color: #008080;">2</span> <span style="color: #000000;">{
</span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">$value</span> + 1<span style="color: #000000;">;
</span><span style="color: #008080;">4</span> <span style="color: #000000;">}
</span><span style="color: #008080;">5</span> 
<span style="color: #008080;">6</span> <span style="color: #008080;">array_map</span>('increment', [1, 2, 3]);</code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"><span style="color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">有的时候函数可能只需要使用一次，这时候使用匿名函数会使得代码更加简洁直观，同时也避免了函数在其他地方被使用</span></code></code></pre>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008080;">array_map</span>(<span style="color: #0000ff;">function</span>(<span style="color: #800080;">$value</span><span style="color: #000000;">){
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">$value</span> + 1<span style="color: #000000;">;
</span><span style="color: #008080;">3</span> }, [1, 2, 3]);</code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<src style="box-sizing: border-box; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;" data-unique="02dd7e">&nbsp;
<h2 style="box-sizing: border-box; padding: 0px 0px 0.3em; font-family: Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif; line-height: 1.225; margin: 1.2em 0px 20px; font-size: 1.3em; position: relative; border-bottom: 1px solid #eeeeee; color: #636b6f;">定义和使用</h2>
<blockquote style="box-sizing: border-box; line-height: 30px; font-size: 15px; padding: 1rem; color: #8796a8; border-left: none; background-color: #f5f8fc; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; margin: 20px 0px !important;">
<p style="box-sizing: border-box; margin: 0px; line-height: 30px;">PHP 将闭包和匿名函数视为同等概念（本文统称为匿名函数），本质上都是<span style="box-sizing: border-box; font-weight: bold;">伪装成函数的对象</span>。</p>
</blockquote>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">匿名函数的本质是对象，因此跟对象一样可将匿名函数赋值给某一变量</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #800080;">$greet</span> = <span style="color: #0000ff;">function</span>(<span style="color: #0000ff;">string</span> <span style="color: #800080;">$name</span><span style="color: #000000;">){
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">echo</span> "hello {<span style="color: #800080;">$name</span>}"<span style="color: #000000;">;
</span><span style="color: #008080;">3</span> <span style="color: #000000;">}
</span><span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span> <span style="color: #800080;">$greet</span>("jack") <span style="color: #008000;">//</span><span style="color: #008000;"> hello jack</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">所有的匿名函数都是&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">Closure</code>&nbsp;对象的实例</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$greet</span> instanceof Closure <span style="color: #008000;">//</span><span style="color: #008000;"> true</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">对象并没有什么父作用域可言，所以需要使用&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">use</code>&nbsp;来手动声明使用的变量，</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #800080;">$num</span> = 1<span style="color: #000000;">;
</span><span style="color: #008080;">2</span> <span style="color: #800080;">$func</span> = <span style="color: #0000ff;">function</span>() <span style="color: #0000ff;">use</span>(<span style="color: #800080;">$num</span><span style="color: #000000;">){
</span><span style="color: #008080;">3</span>     <span style="color: #800080;">$num</span> = <span style="color: #800080;">$num</span> + 1<span style="color: #000000;">;
</span><span style="color: #008080;">4</span>     <span style="color: #0000ff;">echo</span> <span style="color: #800080;">$num</span><span style="color: #000000;">;
</span><span style="color: #008080;">5</span> <span style="color: #000000;">}
</span><span style="color: #008080;">6</span> <span style="color: #800080;">$func</span>();  <span style="color: #008000;">//</span><span style="color: #008000;"> 2</span>
<span style="color: #008080;">7</span> <span style="color: #0000ff;">echo</span> <span style="color: #800080;">$num</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> 还是 1</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">如果要让匿名函数中的变量生效，需要使用引用传值</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #800080;">$num</span> = 1<span style="color: #000000;">;
</span><span style="color: #008080;">2</span> <span style="color: #800080;">$func</span> = <span style="color: #0000ff;">function</span>() <span style="color: #0000ff;">use</span>(&amp;<span style="color: #800080;">$num</span><span style="color: #000000;">){
</span><span style="color: #008080;">3</span>     <span style="color: #800080;">$num</span> = <span style="color: #800080;">$num</span> + 1<span style="color: #000000;">;
</span><span style="color: #008080;">4</span>     <span style="color: #0000ff;">echo</span> <span style="color: #800080;">$num</span><span style="color: #000000;">;
</span><span style="color: #008080;">5</span> <span style="color: #000000;">}
</span><span style="color: #008080;">6</span> <span style="color: #800080;">$func</span>();  <span style="color: #008000;">//</span><span style="color: #008000;"> 2</span>
<span style="color: #008080;">7</span> <span style="color: #0000ff;">echo</span> <span style="color: #800080;">$num</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> 2</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">从 PHP 5.4 开始，在类里面使用匿名函数时，匿名函数的&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">$this</code>&nbsp;将自动绑定到当前类</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Foo {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> bar()
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    {   
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">return</span> <span style="color: #800080;">$this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #800080;">$foo</span> = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Foo();
</span><span style="color: #008080;">11</span> <span style="color: #800080;">$obj</span> = <span style="color: #800080;">$foo</span>-&gt;bar(); <span style="color: #008000;">//</span><span style="color: #008000;"> Closure()</span>
<span style="color: #008080;">12</span> <span style="color: #800080;">$obj</span>();   <span style="color: #008000;">//</span><span style="color: #008000;"> Foo</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">如果不想让自动绑定生效，可使用静态匿名函数</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Foo {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> bar()
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    {   
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">return</span> <span style="color: #800080;">$this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 9</span> <span style="color: #800080;">$foo</span> = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Foo();
</span><span style="color: #008080;">10</span> <span style="color: #800080;">$obj</span> = <span style="color: #800080;">$foo</span>-&gt;bar(); <span style="color: #008000;">//</span><span style="color: #008000;"> Closure()</span>
<span style="color: #008080;">11</span> <span style="color: #800080;">$obj</span>();   <span style="color: #008000;">//</span><span style="color: #008000;"> Using $this when not in object context</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<src style="box-sizing: border-box; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;" data-unique="c5beec">&nbsp;
<h2 style="box-sizing: border-box; padding: 0px 0px 0.3em; font-family: Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif; line-height: 1.225; margin: 1.2em 0px 20px; font-size: 1.3em; position: relative; border-bottom: 1px solid #eeeeee; color: #636b6f;">匿名函数的本质</h2>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">匿名函数的本质是&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">Closure</code>&nbsp;对象，包括了以下五个方法</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">Closure {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> __construct ( void )
</span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> bind ( Closure <span style="color: #800080;">$closure</span> , <span style="color: #0000ff;">object</span> <span style="color: #800080;">$newthis</span> [, <span style="color: #0000ff;">mixed</span> <span style="color: #800080;">$newscope</span> = "static" ] ) :<span style="color: #000000;"> Closure
</span><span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> bindTo ( <span style="color: #0000ff;">object</span> <span style="color: #800080;">$newthis</span> [, <span style="color: #0000ff;">mixed</span> <span style="color: #800080;">$newscope</span> = "static" ] ) :<span style="color: #000000;"> Closure
</span><span style="color: #008080;">5</span>     <span style="color: #0000ff;">public</span> call ( <span style="color: #0000ff;">object</span> <span style="color: #800080;">$newthis</span> [, <span style="color: #0000ff;">mixed</span> $... ] ) : <span style="color: #0000ff;">mixed</span>
<span style="color: #008080;">6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> fromCallable ( callable <span style="color: #800080;">$callable</span> ) : Closure</code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">
<span class="token punctuation" style="box-sizing: border-box; color: #fefefe;">}</span></code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">__construct</code>&nbsp;- 防止匿名函数被实例化</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$closure</span> = <span style="color: #0000ff;">new</span><span style="color: #000000;"> \Closure();
</span><span style="color: #008000;">//</span><span style="color: #008000;"> PHP Error:  Instantiation of 'Closure' is not allowed</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">Closure::bindTo</code>&nbsp;- 复制当前匿名函数对象，绑定指定的&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">$this</code>&nbsp;对象和类作用域。通俗的说，就是手动将匿名函数与指定对象绑定，利用这点，可以扩展对象的功能。</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 定义商品类</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Good {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">private</span> <span style="color: #800080;">$price</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">function</span> __construct(<span style="color: #0000ff;">float</span> <span style="color: #800080;">$price</span><span style="color: #000000;">)
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 7</span>         <span style="color: #800080;">$this</span>-&gt;price = <span style="color: #800080;">$price</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">}
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 定义一个匿名函数，计算商品的促销价</span>
<span style="color: #008080;">12</span> <span style="color: #800080;">$addDiscount</span> = <span style="color: #0000ff;">function</span>(<span style="color: #0000ff;">float</span> <span style="color: #800080;">$discount</span> = 0.8<span style="color: #000000;">){
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">$this</span>-&gt;price * <span style="color: #800080;">$discount</span><span style="color: #000000;">;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">}
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> <span style="color: #800080;">$good</span> = <span style="color: #0000ff;">new</span> Good(100<span style="color: #000000;">);
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 将匿名函数绑定到 $good 实例，同时指定作用域为 Good</span>
<span style="color: #008080;">19</span> <span style="color: #800080;">$count</span> = <span style="color: #800080;">$addDiscount</span>-&gt;bindTo(<span style="color: #800080;">$good</span>, Good::<span style="color: #0000ff;">class</span><span style="color: #000000;">); 
</span><span style="color: #008080;">20</span> <span style="color: #800080;">$count</span>(); <span style="color: #008000;">//</span><span style="color: #008000;"> 80
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span> <span style="color: #008000;">// 将匿名函数绑定到 $good 实例，但是不指定作用域，将无法访问 $good 的私有属性</span>
<span style="color: #008080;">23</span> <span style="color: #800080;">$count</span> = <span style="color: #800080;">$addDiscount</span>-&gt;bindTo(<span style="color: #800080;">$good</span><span style="color: #000000;">); 
</span><span style="color: #008080;">24</span> <span style="color: #800080;">$count</span>(); <span style="color: #008000;">//</span><span style="color: #008000;"> 报错</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">Closure::bind</code>&nbsp;-&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">bindTo</code>&nbsp;方法的静态版本，有两种用法：</p>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">用法一：实现与&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">bindTo</code>&nbsp;方法同样的效果</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #800080;">$count</span> = \Closure::bind(<span style="color: #800080;">$addDiscount</span>, <span style="color: #800080;">$good</span>, Good::<span style="color: #0000ff;">class</span>); </code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">用法二：将匿名函数与类（而不是对象）绑定，记得要将第二个参数设置为&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">null</code></p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 商品库存为 10</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Good {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">static</span> <span style="color: #800080;">$num</span> = 10<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 每次销售后返回当前库存</span>
<span style="color: #008080;"> 7</span> <span style="color: #800080;">$sell</span> = <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">return</span>"当前库存为". --<span style="color: #0000ff;">static</span>::<span style="color: #800080;">$num</span><span style="color: #000000;"> ;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">};
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 将静态匿名函数绑定到 Good 类中</span>
<span style="color: #008080;">12</span> <span style="color: #800080;">$sold</span> = \Closure::bind(<span style="color: #800080;">$sell</span>, <span style="color: #0000ff;">null</span>, Good::<span style="color: #0000ff;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #800080;">$sold</span>(); <span style="color: #008000;">//</span><span style="color: #008000;"> 当前库存为 9</span>
<span style="color: #008080;">15</span> <span style="color: #800080;">$sold</span>(); <span style="color: #008000;">//</span><span style="color: #008000;"> 当前库存为 8</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">call</code>&nbsp;- PHP 7 新增的&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">call</code>&nbsp;方法可以实现绑定并调用匿名函数，除了语法更加简洁外，性能也更高</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> call 版本</span>
<span style="color: #008080;">2</span> <span style="color: #800080;">$addDiscount</span>-&gt;call(<span style="color: #800080;">$good</span>, 0.5);  <span style="color: #008000;">//</span><span style="color: #008000;"> 绑定并传入参数 0.5，结果为 50
</span><span style="color: #008080;">3</span> 
<span style="color: #008080;">4</span> <span style="color: #008000;">// bindTo 版本</span>
<span style="color: #008080;">5</span> <span style="color: #800080;">$count</span> = <span style="color: #800080;">$addDiscount</span>-&gt;bindTo(<span style="color: #800080;">$good</span>, Good::<span style="color: #0000ff;">class</span><span style="color: #000000;">); 
</span><span style="color: #008080;">6</span> <span style="color: #800080;">$count</span>(0.5); <span style="color: #008000;">//</span><span style="color: #008000;"> 50</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">fromCallable</code>&nbsp;- 将给定的&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">callable</code>&nbsp;函数转化成匿名函数</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Good {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">private</span> <span style="color: #800080;">$price</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">function</span> __construct(<span style="color: #0000ff;">float</span> <span style="color: #800080;">$price</span><span style="color: #000000;">)
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 6</span>         <span style="color: #800080;">$this</span>-&gt;price = <span style="color: #800080;">$price</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #0000ff;">function</span> addDiscount(<span style="color: #0000ff;">float</span> <span style="color: #800080;">$discount</span> = 0.8<span style="color: #000000;">){
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">$this</span>-&gt;price * <span style="color: #800080;">$discount</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">}
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #800080;">$closure</span> = \Closure::fromCallable('addDiscount'<span style="color: #000000;">);
</span><span style="color: #008080;">15</span> <span style="color: #800080;">$good</span> = <span style="color: #0000ff;">new</span> Good(100<span style="color: #000000;">);
</span><span style="color: #008080;">16</span> <span style="color: #800080;">$count</span> = <span style="color: #800080;">$closure</span>-&gt;bindTo(<span style="color: #800080;">$good</span><span style="color: #000000;">);  
</span><span style="color: #008080;">17</span> <span style="color: #800080;">$count</span> = <span style="color: #800080;">$closure</span>-&gt;bindTo(<span style="color: #800080;">$good</span>, Good::<span style="color: #0000ff;">class</span>);   <span style="color: #008000;">//</span><span style="color: #008000;"> 报错，不能重复绑定作用域</span>
<span style="color: #008080;">18</span> <span style="color: #800080;">$count</span>(); <span style="color: #008000;">//</span><span style="color: #008000;"> 报错，无法访问私有属性</span></code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;"><code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">fromCallable</code>&nbsp;等价于</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #800080;">$reflexion</span> = <span style="color: #0000ff;">new</span> ReflectionFunction('addDiscount'<span style="color: #000000;">);
</span><span style="color: #008080;">2</span> <span style="color: #800080;">$closure</span> = <span style="color: #800080;">$reflexion</span>-&gt;getClosure();</code></pre>

<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>
<p style="box-sizing: border-box; margin-top: 0px; margin-right: 0px; margin-left: 0px; line-height: 30px; color: #636b6f; font-family: Helvetica, Arial, 'PingFang SC', 'Noto Sans', Roboto, 'Microsoft Yahei', sans-serif; font-size: 15px;">这里有一点需要特别注意的是，无论是&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">fromCallable</code>&nbsp;转化成的闭包，还是使用反射得到的闭包，在使用&nbsp;<code style="box-sizing: border-box; font-family: monaco, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; background: #f9fafa; margin: 5px; color: #858080; border-radius: 4px; border: 1px solid #e4e4e4; max-width: 740px; overflow-x: auto; padding: 1px 2px;">bindTo</code>时，如果第二个参数指定绑定类，会报错</p>
<pre><code><code class="  language-php" style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<src class="cnblogs_code">
<pre><code>Cannot rebind scope of closure created by ReflectionFunctionAbstract::getClosure()</code></pre>

<pre><code><code class="  language-php" style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;"></code></code></pre>
<p>&nbsp;</p>
<pre><code><code class="  language-php" style="box-sizing: border-box; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; font-size: 14px; background: transparent; margin: 0px; border-radius: 4px; border: 0px; max-width: inherit; overflow: initial; padding: 0px; white-space: pre-wrap; word-spacing: normal; word-break: normal; overflow-wrap: break-word; line-height: 24px; tab-size: 4; hyphens: none; display: block;">&nbsp;</code></code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修php对接网易云信视频直播' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>php对接网易云信视频直播</center></div><div class='banquan'>原文出处:本文由博客园博主阿伦php提供。<br/>
原文连接:https://www.cnblogs.com/phpclass/p/10735514.html</div><br>
    <pre><code>&lt;?php<br />/**<br /> * Created by PhpStorm.<br /> * User: lhl<br /> * Date: 2019/4/10<br /> * Time: 17:31<br /> */<br /><br />namespace app\api\controller;<br /><br /><br />class Video<br />{<br />    private $Nonce;<br />    private $CurTime;<br />    private $CheckSum;<br />    const HEX_DIGITS = "0123456789abcdef";<br />    public function __construct()<br />    {<br />        $this-&gt;AppKey = '自己网易云信的appkey';<br />        $this-&gt;AppSecret = '自己网易云信的appsecret';<br />    }<br /><br />    /**生成验证码**/<br />    public<br />    function checkSumBuilder()<br />    {<br />        //此部分生成随机字符串<br />        $hex_digits = self::HEX_DIGITS;<br />        $this-&gt;Nonce;<br />        for ($i = 0; $i &lt; 128; $i++) {<br />//随机字符串最大128个字符，也可以小于该数<br />            $this-&gt;Nonce .= $hex_digits[rand(0, 15)];<br />        }<br />        $this-&gt;CurTime = (string)(time());//当前时间戳，以秒为单位<br />        $join_string = $this-&gt;AppSecret . $this-&gt;Nonce . $this-&gt;CurTime;<br />        $this-&gt;CheckSum = sha1($join_string);<br />    }<br /><br />    /*****file_get_contents()post请求******/<br />    public<br />    function postDataCurl($url = 'https://vcloud.163.com/app/channellist', $data = array())<br />    {<br />        $this-&gt;checkSumBuilder();//发送请求前需先生成checkSum<br /><br />        if (!empty($data)) {<br />            $data = json_encode($data);<br />        } else {<br />            $data = "";<br />        }<br /><br />        $options = array(<br />            'http' =&gt; array(<br />                'method' =&gt; 'POST',<br />                'header' =&gt; "Content-Type: application/json;charset=utf-8\r\n" . "AppKey:" . $this-&gt;AppKey . "\r\n" . "Nonce:" . $this-&gt;Nonce . "\r\n" .<br />                    "CurTime:" . $this-&gt;CurTime . "\r\n" . "CheckSum:" . $this-&gt;CheckSum . "",<br />                'content' =&gt; $data,<br />                'timeout' =&gt; 500,<br />            )<br />        );<br />        $context = stream_context_create($options);<br /><br />        $result = file_get_contents($url, false, $context);<br /><br />        return json_decode($result, true);<br />    }<br /><br /><br />    /***创建频道***/<br />    public function channel_add($name, $type = 0)<br />    {<br />        $url = "https://vcloud.163.com/app/channel/create";<br />        $data = $this-&gt;postDataCurl($url, array("name" =&gt; $name, "type" =&gt; $type));<br />//        var_dump($data);<br />        return json($data);<br />    }<br /><br /><br />    /****修改频道*****/<br />    public function channel_update($name, $cid, $type = 0)<br />    {<br />        $url = "https://vcloud.163.com/app/channel/update";<br />        return $data = $this-&gt;postDataCurl($url, array("name" =&gt; $name, "cid" =&gt; $cid, "type" =&gt; $type));<br />    }<br /><br /><br />    /****删除频道******/<br />    public function channel_delete($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/channel/delete";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br /><br />    /****获取频道状态******/<br />    public function channel_get($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/channelstats";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br /><br />    /***<br />     * &nbsp; &nbsp; 获取频道列表<br />     * &nbsp; &nbsp; records int 单页记录数，默认值为10&nbsp; &nbsp; 否<br />     * &nbsp; &nbsp; pnum&nbsp; &nbsp; int 要取第几页，默认值为1 否<br />     * &nbsp; &nbsp; ofield&nbsp; String&nbsp; 排序的域，支持的排序域为：ctime（默认）&nbsp; 否<br />     * &nbsp; &nbsp; sort&nbsp; &nbsp; int 升序还是降序，1升序，0降序，默认为desc&nbsp; 否<br />     * &nbsp; &nbsp; **/<br />    public function channel_list($option = array("records" =&gt; 10, "pnum" =&gt; 1, "ofield" =&gt; "ctime", "sort" =&gt; 1))<br />    {<br />        $url = "https://vcloud.163.com/app/channellist";<br />        return $data = $this-&gt;postDataCurl($url, $option);<br />    }<br /><br /><br />    /**重新获取推流地址***/<br />    public function channel_reset($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/address";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br /><br />    /*****<br />     * &nbsp; &nbsp; 设置频道为录制状态<br />     * &nbsp; &nbsp; cid String&nbsp; 频道ID&nbsp; &nbsp; 是<br />     * &nbsp; &nbsp; needRecord&nbsp; int 1-开启录制； 0-关闭录制&nbsp; 是<br />     * &nbsp; &nbsp; format&nbsp; int 1-flv； 0-mp4&nbsp; &nbsp; 是<br />     * &nbsp; &nbsp; duration&nbsp; &nbsp; int 录制切片时长(分钟)，默认120分钟&nbsp; 否<br />     * &nbsp; &nbsp; filename&nbsp; &nbsp; String&nbsp; 录制后文件名，格式为filename_YYYYMMDD-HHmmssYYYYMMDD-HHmmss,&nbsp;<br />     * &nbsp; &nbsp; 文件名录制起始时间（年月日时分秒) -录制结束时间（年月日时分秒)&nbsp; &nbsp;否<br />     * &nbsp; &nbsp; ****/<br />    public function channel_setRecord($cid, $option = array())<br />    {<br />        $url = "https://vcloud.163.com/app/channel/setAlwaysRecord";<br />        return $data = $this-&gt;postDataCurl($url, $option);<br />    }<br /><br /><br />    /****禁用频道*****/<br />    public function channel_pause($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/channel/pause";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br /><br />    /****批量禁用频道****/<br />    public function channel_pauselist($cidList)<br />    {<br />        $url = "https://vcloud.163.com/app/channellist/pause";<br />        return $data = $this-&gt;postDataCurl($url, array("cidList" =&gt; $cidList));<br />    }<br /><br />    /****恢复频道*****/<br />    public function channel_resume($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/channel/resume";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br /><br />    /****批量恢复频道****/<br />    public function channel_resumelist($cidList)<br />    {<br />        $url = "https://vcloud.163.com/app/channellist/resume";<br />        return $data = $this-&gt;postDataCurl($url, array("cidList" =&gt; $cidList));<br />    }<br /><br /><br />    /****获取录制视频文件列表*****/<br />    public function channel_videolist($cid)<br />    {<br />        $url = "https://vcloud.163.com/app/videolist";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid));<br />    }<br /><br />    /****获取某一时间范围的录制视频文件列表*****/<br />    public function app_vodvideolist($cid, $beginTime, $endTime)<br />    {<br />        $url = "https://vcloud.163.com/app/vodvideolist";<br />        return $data = $this-&gt;postDataCurl($url, array("cid" =&gt; $cid, "beginTime" =&gt; $beginTime,                "endTime" =&gt; $endTime));<br />    }<br /><br /><br />    /****设置视频录制回调地址*****/<br />    public function record_setcallback($recordClk)<br />    {<br />        $url = "https://vcloud.163.com/app/record/setcallback";<br />        return $data = $this-&gt;postDataCurl($url, array("recordClk" =&gt; $recordClk));<br />    }<br /><br /><br />    /****设置回调的加签秘钥*****/<br />    public function callback_setSignKey($signKey)<br />    {<br />        $url = "https://vcloud.163.com/app/callback/setSignKey";<br />        return $data = $this-&gt;postDataCurl($url, array("signKey" =&gt; $signKey));<br />    }<br />    /****录制文件合并*****/<br />    public function video_merge($outputName, $vidList)<br />    {<br />        $url = "https://vcloud.163.com/app/video/merge";<br />        return $data = $this-&gt;postDataCurl($url, array("outputName" =&gt; $outputName, "vidList" =&gt; $vidList));<br />    }<br />}</code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修如何使用代理IP进行数据抓取，PHP爬虫抓取亚马逊商品数据' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>如何使用代理IP进行数据抓取，PHP爬虫抓取亚马逊商品数据</center></div><div class='banquan'>原文出处:本文由博客园博主yiniuyun提供。<br/>
原文连接:https://www.cnblogs.com/xiaotaomI/p/11760171.html</div><br>
    <p class="p">&nbsp;</p>
<p class="p"><span style="font-family: 宋体;">什么是代理？什么情况下会用到代理</span>IP<span style="font-family: 宋体;">？</span></p>
<p class="p"><span style="font-family: 宋体;">代理服务器（</span>Proxy Server<span style="font-family: 宋体;">），其功能就是代用户去取得网络信息，然后返回给用户。形象的说：它是网络信息的中转站。通过代理</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">访问目标站，可以隐藏用户的真实</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">。</span></p>
<p class="p"><span style="font-family: 宋体;">比如你要抓取一个网站数据，该网站有</span>100<span style="font-family: 宋体;">万条内容，他们做了</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">限制，每个</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">每小时只能抓</span><span style="font-family: sans-serif;">1000</span><span style="font-family: 宋体;">条，如果单个</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">去抓因为受限，需要</span><span style="font-family: sans-serif;">40</span><span style="font-family: 宋体;">天左右才能采集完，如果用了代理</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">，不停的切换</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">，就可以突破每小时</span><span style="font-family: sans-serif;">1000</span><span style="font-family: 宋体;">条的频率限制，从而提高效率。</span></p>
<p class="p">&nbsp;</p>
<p class="p"><span style="font-family: 宋体;">其他想切换</span>IP<span style="font-family: 宋体;">或者隐藏身份的场景也会用到代理</span><span style="font-family: sans-serif;">IP</span><span style="font-family: 宋体;">，比如</span><span style="font-family: sans-serif;">SEO</span><span style="font-family: 宋体;">等。</span></p>
<p class="p">&nbsp;</p>
<p class="p"><span style="font-family: 宋体;">代理</span>IP<span style="font-family: 宋体;">有开放代理也有私密代理，开放代理是全网扫描而来的，不稳定，不适合爬虫，如果自己随便用用还好。用爬虫抓数据，最好使用私密代理。私密代理网上有很多提供商，稳定性参差不齐，现在我们公司使用的是&ldquo;亿牛云&rdquo;提供的私密代理。</span></p>
<p class="p"><span style="font-family: 宋体;">我们公司有个项目是抓取亚马逊数据来进行分析销量、评论等，用</span>PHP<span style="font-family: 宋体;">进行抓取，抓取亚马逊要特别注意</span><span style="font-family: sans-serif;">header</span><span style="font-family: 宋体;">头，否则输出的数据就是空了。我们之前是使用的其他家代理的</span><span style="font-family: sans-serif;">api</span><span style="font-family: 宋体;">模式的，但是自己管理</span><span style="font-family: sans-serif;">ip</span><span style="font-family: 宋体;">池觉得很麻烦，所以选择了亿牛云提供的爬虫代理，动态转发模式的，不需要我们自己管理</span><span style="font-family: sans-serif;">ip</span><span style="font-family: 宋体;">池，直接进行数据采集，这很方便也节约了很多时间。</span></p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;= "https://www.amazon.com/dp/B01H2S9F6C";</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$urls&nbsp;= "https://httpbin.org/ip";</p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;define("PROXY_SERVER", "tcp://t.16yun.cn:31111");</p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;define("PROXY_USER", "16YUN123");</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;define("PROXY_PASS", "123456");</p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$proxyAuth&nbsp;= base64_encode(PROXY_USER&nbsp;. ":"&nbsp;. PROXY_PASS);</p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tunnel&nbsp;= rand(1,10000);</p>
<p class="pre">&nbsp;</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$headers&nbsp;= implode("\r\n", [</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Proxy-Authorization: Basic {$proxyAuth}",</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Proxy-Tunnel: ${tunnel}",</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sniServer&nbsp;= parse_url($urls, PHP_URL_HOST);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options&nbsp;= [</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http"&nbsp;=&gt; [</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"proxy"&nbsp;&nbsp;=&gt; PROXY_SERVER,</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"header"&nbsp;=&gt; $headers,</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"method"&nbsp;=&gt; "GET",</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'request_fulluri'&nbsp;=&gt; true,</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ssl'&nbsp;=&gt; array(</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'SNI_enabled'&nbsp;=&gt; true, // Disable SNI for https over http proxies</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'SNI_server_name'&nbsp;=&gt; $sniServer</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print($url);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context&nbsp;= stream_context_create($options);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;= file_get_contents($url, false, $context);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump($result);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print($urls);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context&nbsp;= stream_context_create($options);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;= file_get_contents($urls, false, $context);</p>
<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_dump($result);?&gt;</p>
<p class="p">&nbsp;</p>
<p class="p">&nbsp;</p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修聚合数据接口调用实例' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>聚合数据接口调用实例</center></div><div class='banquan'>原文出处:本文由博客园博主IUser提供。<br/>
原文连接:https://www.cnblogs.com/w-m-y/p/11981428.html</div><br>
    <p>聚合数据接口调用实例</p>
<p><em id="__mceDel">//控制器</em></p>
<pre><code>class SignController extends Controller<br />{<br />const SIGNARRAY=['1'=&gt;'白羊座',2=&gt;'金牛座',3=&gt;'双子座',4=&gt;'巨蟹座',5=&gt;'狮子座',6=&gt;'处女座',7=&gt;'天秤座',8=&gt;'天蝎座',9=&gt;'射手座',10=&gt;'魔羯座',11=&gt;'水瓶座',12=&gt;'双鱼座'];<br />   public function index()<br />　　{<br />       return view('admin.sign.index');<br />   }<br /><br />   public function getData(Request $request)<br />　　{<br />       $appkey="你的安排appKey";<br />       $url="http://web.juhe.cn:8080/constellation/getAll";<br />       $sign=trim(self::SIGNARRAY[$request-&gt;get('sign')]);<br />       $range=trim($request-&gt;get('range'));<br />       $params = array(<br />           "key" =&gt; $appkey,//应用APPKEY(应用详细页查询)<br />           "consName" =&gt; $sign,//星座名称，如:白羊座<br />           "type" =&gt; $range,//运势类型：today,tomorrow,week,nextweek,month,year<br />       );<br />       $paramstring = http_build_query($params);<br />       $content=$this-&gt;juhecurl($url,$paramstring);<br />       $result = json_decode($content,true);<br />       if($result){<br />           if($result['error_code']=='0'){<br />               $data=<br />                   '请求时间：'.$result['datetime'].'&lt;br/&gt;'.<br />                   '星座：'.$result['name'].'&lt;br/&gt;'.<br />                   '综合指数：'.$result['all'].'&lt;br/&gt;'.<br />                   '幸运色：'.$result['color'].'&lt;br/&gt;'.<br />                   '健康指数：'.$result['health'].'&lt;br/&gt;'.<br />                   '爱情指数：'.$result['love'].'&lt;br/&gt;'.<br />                   '财运指数：'.$result['money'].'&lt;br/&gt;'.<br />                   '幸运数字：'.$result['number'].'&lt;br/&gt;'.<br />                   '速配星座：'.$result['QFriend'].'&lt;br/&gt;'.<br />                   '工作指数：'.$result['work'].'&lt;br/&gt;'.<br />                   '今日概述：'.$result['summary'].'&lt;br/&gt;'<br />               ;<br />               return response()-&gt;json(['status'=&gt;'ok','msg'=&gt;'请求成功','data'=&gt;$data]);<br />           }else{<br />                echo $result['error_code'].":".$result['reason'];<br />           }<br />       }else{<br />           return response()-&gt;json(['status'=&gt;'error','msg'=&gt;'请求失败','data'=&gt;$result]);<br />       }<br />   }<br /><br /><br /><br />/**<br /> * 请求接口返回内容<br /> * @param  string $url [请求的URL地址]<br /> * @param  string $params [请求的参数]<br /> * @param  int $ipost [是否采用POST形式]<br /> * @return  string<br /> */<br />    public function juhecurl($url,$params=false,$ispost=0)<br />　　{<br />            $httpInfo = array();<br />            $ch = curl_init();<br /><br />        curl_setopt( $ch, CURLOPT_HTTP_VERSION , CURL_HTTP_VERSION_1_1 );//设置curl http传输协议强制使用http/1.1<br />        curl_setopt( $ch, CURLOPT_USERAGENT , 'JuheData' );//在HTTP请求中包含一个"User-Agent: "头的字符串。<br />        curl_setopt( $ch, CURLOPT_CONNECTTIMEOUT , 60 );//在发起连接前等待的时间，如果设置为0，则无限等待。<br />        curl_setopt( $ch, CURLOPT_TIMEOUT , 60);//设置cURL允许执行的最长秒数。<br />        curl_setopt( $ch, CURLOPT_RETURNTRANSFER , true );//将curl_exec()获取的信息以文件流的形式返回不输出<br />        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);//启用之后会将服务器返回的Location：放在header中递归<br />    //的形式返回给服务器。<br /><br />        if( $ispost )<br />        {<br />            //发送post请求<br />            curl_setopt( $ch , CURLOPT_POST , true );//启用后会发送一个常规的post请求，类型为<br />            //application/x-www-form-urlencoded,就想表单提交的一样<br />            curl_setopt( $ch , CURLOPT_POSTFIELDS , $params );//全部数据使用http协议中的POST操作来发送。<br />            curl_setopt( $ch , CURLOPT_URL , $url );//访问那个url<br />        }<br />        else<br />        {<br />            //发送get请求<br />            if($params){<br />                curl_setopt( $ch , CURLOPT_URL , $url.'?'.$params );<br />            }else{<br />                curl_setopt( $ch , CURLOPT_URL , $url);<br />            }<br />        }<br />        $response = curl_exec( $ch );//执行一个连接<br />        if ($response === FALSE) {<br />            //echo "cURL Error: " . curl_error($ch);<br />            return false;<br />        }<br />        $httpCode = curl_getinfo( $ch , CURLINFO_HTTP_CODE );//获取一个CURL连接资源句柄的信息<br />        $httpInfo = array_merge( $httpInfo , curl_getinfo( $ch ) );<br />        curl_close( $ch );<br />        return $response;<br />    }<br />}<br /><br /><br /><br /><br /></code></pre>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>
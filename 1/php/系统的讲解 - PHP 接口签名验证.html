<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修系统的讲解 - PHP 接口签名验证' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>系统的讲解 - PHP 接口签名验证</center></div><div class='banquan'>原文出处:本文由博客园博主it-world提供。<br/>
原文连接:https://www.cnblogs.com/it-3327/p/11820330.html</div><br>
    <p>概览<br /><br />工作中，我们时刻都会和接口打交道，有的是调取他人的接口，有的是为他人提供接口，在这过程中肯定都离不开签名验证。<br /><br />在设计签名验证的时候，一定要满足以下几点：<br /><br />&nbsp;&nbsp;&nbsp; 可变性：每次的签名必须是不一样的。<br /><br />&nbsp;&nbsp;&nbsp; 时效性：每次请求的时效性，过期作废。<br /><br />&nbsp;&nbsp;&nbsp; 唯一性：每次的签名是唯一的。<br /><br />&nbsp;&nbsp;&nbsp; 完整性：能够对传入数据进行验证，防止篡改。<br /><br />下面主要分享一些工作中常用的加解密的方法。<br />常用验证<br /><br />举例：/api/login?username=xxx&amp;password=xxx&amp;sign=xxx<br /><br />发送方和接收方约定一个加密的盐值，进行生成签名。<br /><br />示例代码：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证0.jpg" alt="" width="1080" height="727" /><br /><br />上面使用到了 MD5 方法，MD5 属于单向散列加密。<br />单向散列加密<br />定义<br /><br />把任意长的输入串变化成固定长的输出串，并且由输出串难以得到输入串，这种方法称为单项散列加密。<br />常用算法<br /><br />&nbsp;&nbsp;&nbsp; MD5<br /><br />&nbsp;&nbsp;&nbsp; SHA<br /><br />&nbsp;&nbsp;&nbsp; MAC<br /><br />&nbsp;&nbsp;&nbsp; CRC<br /><br />优点<br /><br />以 MD5 为例。<br /><br />&nbsp;&nbsp;&nbsp; 方便存储：加密后都是固定大小（32位）的字符串，能够分配固定大小的空间存储。<br /><br />&nbsp;&nbsp;&nbsp; 损耗低：加密/加密对于性能的损耗微乎其微。<br /><br />&nbsp;&nbsp;&nbsp; 文件加密：只需要32位字符串就能对一个巨大的文件验证其完整性。<br /><br />&nbsp;&nbsp;&nbsp; 不可逆：大多数的情况下不可逆，具有良好的安全性。<br /><br />缺点<br /><br />&nbsp;&nbsp;&nbsp; 存在暴力破解的可能性，最好通过加盐值的方式提高安全性。<br /><br />应用场景<br /><br />&nbsp;&nbsp;&nbsp; 用于敏感数据，比如用户密码，请求参数，文件加密等。<br /><br />推荐密码的存储方式<br /><br />password_hash() 使用足够强度的单向散列算法创建密码的哈希（hash）。<br /><br />示例代码：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证1.jpg" alt="" width="1080" height="651" /><br /><br />PHP 手册地址：<br /><br />http://php.net/manual/zh/function.password-hash.php<br />对称加密<br />定义<br /><br />同一个密钥可以同时用作数据的加密和解密，这种方法称为对称加密。<br />常用算法<br /><br />&nbsp;&nbsp;&nbsp; DES<br /><br />&nbsp;&nbsp;&nbsp; AES<br /><br />AES 是 DES 的升级版，密钥长度更长，选择更多，也更灵活，安全性更高，速度更快。<br />优点<br /><br />算法公开、计算量小、加密速度快、加密效率高。<br />缺点<br /><br />发送方和接收方必须商定好密钥，然后使双方都能保存好密钥，密钥管理成为双方的负担。<br />应用场景<br /><br />相对大一点的数据量或关键数据的加密。<br />AES<br /><br />AES 加密类库在网上很容易找得到，请注意类库中的 mcrypt_encrypt 和 mcrypt_decrypt 方法！<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证2.jpg" alt="" width="1080" height="270" /><br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证3.jpg" alt="" width="1080" height="299" /><br />在 PHP7.2 版本中已经被弃用了，在新版本中使用 openssl_encrypt 和 openssl_decrypt 两个方法。<br />这里我还准备了一分学习图和资料，如下：</p>
<p><img src="./images/系统的讲解 - PHP 接口签名验证4.jpg" alt="" /></p>
<p>链接：<a href="https://pan.baidu.com/s/1v5gm7n0L7TGyejCmQrMh2g" target="_blank">https://pan.baidu.com/s/1v5gm7n0L7TGyejCmQrMh2g</a>&nbsp;提取码：x2p5<br /><br />免费分享，但是X度限制严重，如若链接失效点击链接或搜索加群 群号<a href="https://jq.qq.com/?_wv=1027&amp;k=5Qtjg0V" target="_blank">518475424</a>。</p>
<p><br />示例代码（类库）：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证5.jpg" alt="" width="1080" height="1319" /><br /><br />示例代码：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证6.jpg" alt="" width="1080" height="544" /><br /><br />运行结果：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证7.jpg" alt="" width="858" height="236" /><br />非对称加密<br />定义<br /><br />需要两个密钥来进行加密和解密，这两个秘钥分别是公钥（public key）和私钥（private key），这种方法称为非对称加密。<br />常用算法<br /><br />&nbsp;&nbsp;&nbsp; RSA<br /><br />优点<br /><br />与对称加密相比，安全性更好，加解密需要不同的密钥，公钥和私钥都可进行相互的加解密。<br />缺点<br /><br />加密和解密花费时间长、速度慢，只适合对少量数据进行加密。<br />应用场景<br /><br />适合于对安全性要求很高的场景，适合加密少量数据，比如支付数据、登录数据等。<br />RSA 与 RSA2<br />算法名称&nbsp;&nbsp; &nbsp;标准名称&nbsp;&nbsp; &nbsp;备注<br />RSA2&nbsp;&nbsp; &nbsp;SHA256WithRSA&nbsp;&nbsp; &nbsp;强制要求RSA密钥的长度至少为2048<br />RSA&nbsp;&nbsp; &nbsp;SHA1WithRSA&nbsp;&nbsp; &nbsp;对RSA密钥的长度不限制，推荐使用2048位以上<br /><br />RSA2 比 RSA 有更强的安全能力。<br /><br />蚂蚁金服，新浪微博 都在使用 RSA2 算法。<br /><br />创建公钥和私钥：<br /><br /></p>
<src class="cnblogs_Highlighter">
<pre><code>    openssl genrsa -out private_key.pem 2048    
    openssl rsa -in private_key.pem -pubout -out public_key.pem
</code></pre>

<p>&nbsp;</p>
<p><br /><br />执行上面命令，会生成 private_key.pem 和 public_key.pem 两个文件。<br /><br />示例代码（类库）：<br /><img src="./images/系统的讲解 - PHP 接口签名验证8.jpg" alt="" width="1080" height="2249" /><br /><br />示例代码：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证9.jpg" alt="" width="1080" height="965" /><br /><br />运行结果：<br /><br />部分数据截图如下：<br /><br /><img src="./images/系统的讲解 - PHP 接口签名验证10.jpg" alt="" width="1080" height="205" /><br />JS-RSA<br /><br />JSEncrypt ：用于执行OpenSSL RSA加密、解密和密钥生成的Javascript库。<br /><br />Git源：https://github.com/travist/jsencrypt<br /><br />应用场景：<br /><br />我们在做 WEB 的登录功能时一般是通过 Form 提交或 Ajax 方式提交到服务器进行验证的。<br /><br />为了防止抓包，登录密码肯定要先进行一次加密（RSA），再提交到服务器进行验证。<br /><br />一些大公司都在使用，比如淘宝、京东、新浪 等。<br /><br />示例代码就不提供了，Git上提供的代码是非常完善的。<br />密钥安全管理<br /><br />这些加密技术，能够达到安全加密效果的前提是 密钥的保密性。<br /><br />实际工作中，不同环境的密钥都应该不同（开发环境、预发布环境、正式环境）。<br /><br />那么，应该如何安全保存密钥呢？<br />环境变量<br /><br />将密钥设置到环境变量中，每次从环境变量中加载。<br />配置中心<br /><br />将密钥存放到配置中心，统一进行管理。<br />密钥过期策略<br /><br />设置密钥有效期，比如一个月进行重置一次。<br /><br />在这里希望大佬提供新的思路 ~<br />接口调试工具<br />Postman<br /><br />一款功能强大的网页调试与发送网页 HTTP 请求的 Chrome插件。<br /><br />这个不用多介绍，大家肯定都使用过。<br />SocketLog<br /><br />Git源：https://github.com/luofei614/SocketLog<br /><br />解决的痛点：<br /><br /><br />&nbsp;&nbsp;&nbsp; 正在运行的API有Bug，不能在文件中使用var_dump进行调试，因为会影响到client的调用。将日志写到文件中，查看也不是很方便。<br /><br /><br /><br />&nbsp;&nbsp;&nbsp; 我们在二次开发一个新系统的时候，想查看执行了哪些Sql语句及程序的warning，notice等错误信息。<br /><br /><br />SocketLog，可以解决以上问题，它通过WebSocket将调试日志输出到浏览器的console中。<br /><br />使用方法<br /><br />&nbsp;&nbsp;&nbsp; 安装、配置Chrome插件<br /><br />&nbsp;&nbsp;&nbsp; SocketLog服务端安装<br /><br />&nbsp;&nbsp;&nbsp; PHP中用SocketLog调试<br /><br />&nbsp;&nbsp;&nbsp; 配置日志类型和相关参数<br /><br />在线接口文档<br /><br />接口开发完毕，需要给请求方提供接口文档，文档的编写现在大部分都使用Markdown格式。<br /><br />也有一些开源的系统，可以下载并安装到自己的服务器上。<br /><br />也有一些在线的系统，可以在线使用同时也支持离线导出。<br /><br />根据自己的情况，选择适合自己的文档平台吧。<br /><br />常用的接口文档平台：<br /><br />&nbsp;&nbsp;&nbsp; eolinker<br /><br />&nbsp;&nbsp;&nbsp; Apizza<br /><br />&nbsp;&nbsp;&nbsp; Yapi<br /><br />&nbsp;&nbsp;&nbsp; RAP2<br /><br />&nbsp;&nbsp;&nbsp; DOClever<br /><br />扩展<br /><br />一、在 HTTP 和 RPC 的选择上，可能会有一些疑问，RPC框架配置比较复杂，明明用HTTP能实现为什么要选择RPC？<br /><br />下面简单的介绍下 HTTP 与 RPC 的区别。<br /><br />传输协议：<br /><br />&nbsp;&nbsp;&nbsp; HTTP 基于 HTTP 协议。<br /><br />&nbsp;&nbsp;&nbsp; RPC 即可以 HTTP 协议，也可以 TCP 协议。<br /><br />HTTP 也是 RPC 实现的一种方式。<br /><br />性能消耗：<br /><br />&nbsp;&nbsp;&nbsp; HTTP 大部分基于 JSON 实现的，序列化需要时间和性能。<br /><br />&nbsp;&nbsp;&nbsp; RPC 可以基于二进制进行传输，消耗性能少一点。<br /><br />推荐一个像 JSON ，但比 JSON 传输更快占用更少的新型序列化类库 MessagePack。<br /><br />官网地址：https://msgpack.org/<br /><br />还有一些服务治理、负载均衡配置的区别。<br /><br />使用场景：<br /><br />比如浏览器接口、APP接口、第三方接口，推荐使用 HTTP。<br /><br />比如集团内部的服务调用，推荐使用 RPC。<br /><br />RPC 比 HTTP 性能消耗低，传输效率高，服务治理也方便。<br /><br />推荐使用的 RPC 框架：Thrift。<br /><br />二、动态令牌<br /><br />简单介绍下几种动态令牌，感兴趣的可以深入了解下。<br /><br />OTP：One-Time Password 一次性密码。<br /><br />HOTP：HMAC-based One-Time Password 基于HMAC算法加密的一次性密码。<br /><br />TOTP：Time-based One-Time Password 基于时间戳算法的一次性密码。<br /><br />使用场景：<br /><br />&nbsp;&nbsp;&nbsp; 公司VPN登录双因素验证<br /><br />&nbsp;&nbsp;&nbsp; 服务器登录动态密码验证<br /><br />&nbsp;&nbsp;&nbsp; 网银、网络游戏的实体动态口令牌<br /><br />&nbsp;&nbsp;&nbsp; 银行转账动态密码<br /><br />&nbsp;&nbsp;&nbsp; ...<br /><br />小结<br /><br />本文讲了设计签名验证需要满足的一些条件：可变性、时效性、唯一性、完整性。<br /><br />还讲了一些加密方法：单向散列加密、对称加密、非对称加密，同时分析了各种加密方法的优缺点，大家可以根据自己的业务特点进行自由选择。<br /><br />提供了 Aes、Rsa 相关代码示例。<br /><br />分享了可以编写接口文档的在线系统。<br /><br />分享了开发过程中使用的接口调试工具。<br /><br />扩展中分析了 HTTP 和 RPC 的区别，动态令牌的介绍等。<br /><br /></p>

</div></div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>